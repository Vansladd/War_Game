<!DOCTYPE html>
<html>
	<head>
		<title>Lobby Page</title>
	</head>
    <body>
        <p>Lobby Room</p>
        <div id="lobbies"></div>
    </body>

</html>

<script>
    async function display_lobbies(json) {

        document.getElementById("lobbies").innerHTML = ""; //refresh the lobbies
        for(i = 0; i < json["lobbies"].length; i++){
            document.getElementById("lobbies").innerHTML+= "<p>Room " + json["lobbies"][i]["roomid"] + "</p>"; //displays the room number
            document.getElementById("lobbies").innerHTML+= "<p>Player1_id: " + json["lobbies"][i]["player1_id"].toString() + "</p>"; //displays the user in the room
            document.getElementById("lobbies").innerHTML+= "<p>Player2_id: " + json["lobbies"][i]["player2_id"].toString() + "</p>"; //displays the user in the room
            // document.getElementById("lobbies").innerHTML+= "<p>Starting Money: " + json["starting_money"][i].toString() + "</p>"; //adds the starting money in the room
            document.getElementById("lobbies").innerHTML+= '<a href="##TP_CGI_URL##?action=WAR_GAME_Waiting_Room&user_id=##TP_user_id##&room_id=' + json["lobbies"][i]["roomid"] + '">Join<a>'; //creates link to lobby
            document.getElementById("lobbies").innerHTML+= "<br><br>"
        }
    }
    
    function get_lobbies() {
        fetch('##TP_CGI_URL##?action=WAR_GAME_Lobbies_JSON') //gets json from url
        .then(response => response.text())
        .then(text => display_lobbies(JSON.parse(text)))
    }

    get_lobbies();
    setInterval(get_lobbies, 1000000); //updates data every one second

</script>