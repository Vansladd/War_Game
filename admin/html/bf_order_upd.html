<html>
<!-- $Id: bf_order_upd.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>OpenBet Betfair Selection Order Result</title>
##TP_PLAY JS_WriteSelect.html##
<script language=javascript>
function fs(b,t)
{

	if (!t=="GoAudit") {

		var size = parseFloat(b.form.BFSize.value);
		var limit = parseFloat(b.form.BFSizeLimit.value);

		if (!stk_chk(b,size,limit)) {
			return;
		}
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function stk_chk(b, size, limit)
{

	var price = parseFloat(b.form.BFPrice.value);
	var type = b.form.BFOrderType.value;

	if (isNaN(size)) {
		alert('Enter a valid size');
		return false;
	}

	if (type == 'B') {
		var exp = size;
	} else {
		var exp = size*price;
	}

	if (exp > limit) {
		  alert('Order size too large, limit '+limit);
		  return false;
	} else if (size < ##TP_TCL {OT_CfgGet BF_MIN_SIZE 2}##) {
		  alert('Order size too small, must be ##TP_TCL {OT_CfgGet BF_MIN_SIZE 2}##+');
		  return false;
	}

	return true;
}

</script>
</head>

<body>
##TP_PLAY error_rpt.html##

##TP_IF {[tpGetVar NoBFOrder]} ##
	No Order Details Found <input type=button value="Close" onClick="window.close()">
##TP_ELSE##

<form action="##TP_CGI_URL##" method="POST">
<input type=hidden name=action value="ADMIN::BETFAIR_ORDER::DoBFOrderUpd">
<input type=hidden name=SubmitName>
<input type=hidden name=OcId value="##TP_OcId##">
<input type=hidden name=BFBetId value="##TP_BFBetId##">
<input type=hidden name=BFOrderId value="##TP_BFOrderId##">
<input type=hidden name=BFPriceOrig value="##TP_BFPrice##">
<input type=hidden name=BFSizeOrig value="##TP_BFSize##">
<input type=hidden name=BFStatus value="##TP_BFStatus##">
<input type=hidden name=BFSizeMat value="##TP_BFSizeMat##">
<input type=hidden name=BFOrderType value="##TP_BFType##">

##TP_IF {[op_allowed BFLargeOrder]}##
	<input type=hidden name=BFSizeLimit value="##TP_BFLargeOrder##">
##TP_ELSEIF {[op_allowed BFSmallOrder]}##
	<input type=hidden name=BFSizeLimit value="##TP_BFSmallOrder##">
##TP_ELSE##
	<input type=hidden name=BFSizeLimit value="0">
##TP_ENDIF##

<!-- in case order has just been placed -->
##TP_BFResCode## ##TP_BFSuccess##

<table cellspacing=0 cellpadding=3 border=0 width="400">
<tr>
	<th colspan=9 class=title>Betfair Selection
	##TP_IF {[tpGetVar BFOrderType]=="B"}## Back ##TP_ELSE## Lay Order ##TP_ENDIF## - ##TP_OcDesc##
</th>
</tr>
<tr>
	<th class=colhead>Betfair<br>Order Id</th>
	<th class=colhead>Betfair<br>Bet Id</th>
	<th class=colhead>Status</th>
	<th class=colhead>Settled</th>
	<th class=colhead>Price</th>
	<th class=colhead>Average<br>Price Matched</th>
	<th class=colhead>Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
	<th class=colhead>Size<br>Matched</th>
	<th class=colhead>Returns</th>
</tr>
<tr>
	<td>##TP_BFOrderId##</td>
	<td>
		##TP_IF {([tpBindGet BFStatus] == "B" || [tpBindGet BFStatus] == "N") && [op_allowed BFOrder]}##
			<input name=NewBFBetId type=text size=10 value="##TP_BFBetId##">
		##TP_ELSE##
			##TP_BFBetId##
		##TP_ENDIF##
	</td>
	<td>
		##TP_IF {([tpBindGet BFStatus] == "B" || [tpBindGet BFStatus] == "N") && [op_allowed BFOrder]}##
		<select name="Status">
			<script>
				write_select('##TP_Status##','X','Not Placed','U','Placed')
			</script>
		</select>
		##TP_ELSE##
			##TP_BFStatus##
		##TP_ENDIF##
	</td>
	<td>##TP_BFSettled##</td>
	<td>##TP_IF {([tpBindGet BFStatus] == "U" || [tpBindGet BFStatus] == "P") && [op_allowed BFOrder] && [OT_CfgGet BF_ORDER_UPDATE 0] == 1}##
			<input name=BFPrice type=text size=8 value="##TP_BFPrice##">
		##TP_ELSE##
			##TP_BFPrice##
		##TP_ENDIF##
	</td>
	<td>##TP_BFAvgPrice##</td>
	<td nowrap>##TP_IF {([tpBindGet BFStatus] == "U" || [tpBindGet BFStatus] == "P") && [op_allowed BFOrder] && [OT_CfgGet BF_ORDER_UPDATE 0] == 1}##
		<input name=BFSize type=text size=8 value="##TP_BFSize##">
		##TP_ELSE##
			##TP_BFSize##
		##TP_ENDIF##
	</td>
	<td>##TP_BFSizeMat##</td>
	<td>##TP_BFProfit##</td>
</tr>
<tr>
	<th class=buttons colspan=9>

		##TP_IF {([tpBindGet BFStatus] == "U" || [tpBindGet BFStatus] == "P") && [op_allowed BFOrder]}##
			##TP_IF {[tpBindGet BFNumOrders]!="0"}##
					##TP_IF {[OT_CfgGet BF_ORDER_UPDATE 0] == 1}##
						<input type=button value="Update Order " onClick="fs(this,'BFUpdOrder')">
					##TP_ENDIF##
				##TP_IF {[op_allowed BFCancelOrder]}##
					<input type=button value="Cancel Order" onClick="fs(this,'BFCanOrder')">
				##TP_ENDIF##
			##TP_ENDIF##
		##TP_ENDIF##
		##TP_IF {([tpBindGet BFStatus] == "B" || [tpBindGet BFStatus] == "N") && [op_allowed BFOrder]}##
			<input type=button value="Update Order" onClick="fs(this,'BFUpdOrderBasic')">
		##TP_ENDIF##

		<input type=button value="Close" onClick="window.close()">
		<input type=button value="Show All Orders" onClick="fs(this,'BFOrdersList')">
	</th>
</tr>
##TP_IF {[tpGetVar PERM_ViewAudit 0]}##
<th class=buttons colspan=9>
	<input type="button" class="btn_def" value="View Audit History" onClick="return fs(this,'GoAudit')">
	<input type="hidden" name="AuditInfo" value="BetfairOrder">
</th>
##TP_ENDIF##
</table>

##TP_ENDIF## <!-- no order -->
</form>
</body>
</html>
