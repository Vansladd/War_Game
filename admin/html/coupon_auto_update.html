<html>
<!-- $Id: coupon_auto_update.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Coupon - Auto Update Settings</title>
##TP_PLAY header_cal.html##
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>
function validate(f)
{
	return true;
}
function fs(b,t)
{
	if (t == "DoAutoUpdate") {
		var auto_update_form = document.forms.coupon_auto_update;
		auto_update = auto_update_form.auto_update.value;
		start_date = auto_update_form.start_date.value;
		end_date = auto_update_form.end_date.value;

		if (auto_update == "Y" && start_date != "" && end_date != "") {
			if (start_date > end_date) {
				var error_div = document.getElementById("error_div");
				error_div.innerHTML = '<h3 class="infono">End date must be equal to or later than the start date.</h3>';
				return false;
			}
		}
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
function back(b,t)
{
	b.form.action.value=t;
	b.form.submit();
	return true;
}
function displayCalendars() {
	new Calendar(document.forms.coupon_auto_update.start_date,null,true,"lo");
	new Calendar(document.forms.coupon_auto_update.end_date,null,true,"lo");
}
function go_dd_popup() {
	popup = window.open("##TP_CGI_URL##?action=ADMIN::BESTBETS::go_bbet_dd",
		"popup",
		"toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,height=400,width=400");
	popup.focus();
}
function set_vals(level, id, name)
{
	if (id == -1)
		return false;

	var openerForm = document.forms.coupon_auto_update;
	openerForm.Id.value=id;
	openerForm.Level.value=level;
	openerForm.action.value="ADMIN::COUPON::DoAddRow";

	// Check if the user is adding a row that includes an already existing row
	var existing_rows = "";
	if (level == "CATEGORY") {
		var coupon_classes = openerForm.CouponClasses.value.split(",");
		var coupon_types = openerForm.CouponTypes.value.split(",");
		for (i = 0; i < coupon_classes.length; i++) {

			var class_categories = coupon_classes[i].split(" ");
			var category_id = class_categories[0];
			var class_name = class_categories[1];

			if (category_id == id) {
				existing_rows = existing_rows + " " + class_name;
			}
		}
		for (i = 0; i < coupon_types.length; i++) {

			var class_types = coupon_types[i].split(" ");
			var category_id = class_types[0];
			var class_id = class_types[1];
			var type_name = class_types[2];

			if (category_id == id) {
				existing_rows = existing_rows + " " + type_name;
			}
		}
	} else if (level == "CLASS") {
		var coupon_types = openerForm.CouponTypes.value.split(",");
		for (i = 0; i < coupon_types.length; i++) {

			var class_types = coupon_types[i].split(" ");
			var category_id = class_types[0];
			var class_id = class_types[1];
			var type_name = class_types[2];

			if (class_id == id) {
				existing_rows = existing_rows + " " + type_name;
			}
		}
	}

	// If so, confirm that the existing row will be deleted
	if (existing_rows != "") {
		if (confirm("The row(s) for" + existing_rows + " will be deleted if you continue. Do you want to continue?"))
			openerForm.submit();
		else
			return false;
	}

	// Submit the form to add the row
	openerForm.submit();

	return true;
}
</script>
</head>
<body onload="displayCalendars();">
##TP_PLAY error_rpt.html##
##TP_PLAY msg_rpt.html##
<div id="error_div"></div>
<div name="auto_update_form">
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	<th colspan=9 class=title>
	Coupon Auto Update Settings
	</th>
</tr>
<form action="##TP_CGI_URL##" method="get" onSubmit="return validate(this);" name=coupon_auto_update>
<input type="hidden" name="action" value="ADMIN::COUPON::DoAutoUpdate">
<input type="hidden" name="SubmitName" value="">
<tr>
	<td align=right>Auto Update:</td>
	<td>
		<select name="auto_update">
		<option value="Y" ##TP_IF {[tpBindGet IsAutoUpdated] == "Y"}##selected="selected"##TP_ENDIF##>Yes</option>
		<option value="N" ##TP_IF {[tpBindGet IsAutoUpdated] == "N"}##selected="selected"##TP_ENDIF##>No</option>
		</select>
	</td>
</tr>
<tr>
	<td align=right>Begin updating from:<br>&nbsp;</td>
	<td>
		<input type="text" name="start_date" value="##TP_AutoUpdate_Start##" size=19><br>
		Date/time format: YYYY-MM-DD hh:mm:ss
	</td>
</tr>
<tr>
	<td align=right>End updating at:<br>&nbsp;</td>
	<td>
		<input type="text" name="end_date" value="##TP_AutoUpdate_End##" size=19><br>
		Date/time format: YYYY-MM-DD hh:mm:ss
	</td>
</tr>
<tr>
	<td align=right>Market:</td>
	<td>
		<select name="market_name">
		<option value="">--</option>
		##TP_LOOP market_idx {[tpGetVar NumMarkets]}##
			<option value="##TP_MarketName##" ##TP_Selected##>##TP_MarketName##</option>
		##TP_ENDLOOP##
		</select>
	</td>
</tr>
</div>
##TP_IF {[tpBindGet IsAutoUpdated] == "Y"}##
##TP_IF {[ADMIN::COUPON::_ac_get_total rowAdd] > 0}##
	<div class="ACError" style="color: red">
		##TP_TCL {tpBufWrite [ADMIN::COUPON::_ac_get rowAdd]}##
	</div>
##TP_ENDIF##
<div name="auto_update_table">
<tr>
<table>
<tr>
	<th>Category</th>
	<th>Class</th>
	<th>Event Type</th>
</tr>
	##TP_LOOP classes_idx {[tpGetVar NumRows]}##
		<tr>
		<td>##TP_Category##</td>
		<td>##TP_Class##</td>
		<td>##TP_Type##</td>
		<td><a href="##TP_CGI_URL##?action=ADMIN::COUPON::DoRemoveRow&ac_source_id=##TP_ACSourceId##&AutoCouponId=##TP_AutoCouponId##&CouponId=##TP_CouponId##&Category=##TP_CouponCategory##&ClassId=##TP_CouponClassId##">Remove</a></td>
		</tr>
	##TP_ENDLOOP##
<tr>
<td colspan=3 align=right><input type="button" class="btn_def" value="Add" onClick="go_dd_popup()"></td>
<input type="hidden" name="Id" value="">
<input type="hidden" name="Level" value="">
<input type="hidden" name="AutoCouponId" value="##TP_AutoCouponId##">
<input type="hidden" name="IsBBuster" value="##TP_IsBBuster##">
<input type="hidden" name="CouponDesc" value="##TP_CouponDesc##">
<input type="hidden" name="CouponClasses" value="##TP_CouponClasses##">
<input type="hidden" name="CouponTypes" value="##TP_CouponTypes##">
</tr>
</table>
</tr>
##TP_ENDIF##
<tr><td>&nbsp;<br></td></tr>
<tr>
<table>
<input type="hidden" name="CouponId" value="##TP_CouponId##">
<input type="hidden" name="ClassId" value="##TP_CouponClassId##">
<input type="hidden" name="Category" value="##TP_CouponCategory##">
<td><input type="button" class="btn_def" value="Update" onClick="return fs(this,'DoAutoUpdate')"></td>
<td><input type="button" class="btn_def" value="Back" onClick="return back(this, 'ADMIN::COUPON::GoCoupon');"></td>
</table>
</tr>
</form>
</table>
</div>
</body>
</html>
