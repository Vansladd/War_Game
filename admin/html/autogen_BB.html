<html>
<!-- $Id: autogen_BB.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Basketball Event Generation</title>
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>

var errorList = "";

function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function validate(f)
{
	errorList = "";

	var fm = document.forms["DoEventBB"];

	var selectedHome = fm.elements["EvHomeTeamId"].selectedIndex;
	var home         = fm.elements["EvHomeTeamId"].options[selectedHome].value;
	var selectedAway = fm.elements["EvAwayTeamId"].selectedIndex;
	var away         = fm.elements["EvAwayTeamId"].options[selectedAway].value;

	if (home == away) {
		add_err("Home and away teams cannot be the same.");
	}
	if (errorList != "") {
		alert("There are some errors in the form:\n\n" + errorList);
		return false;
	}
    return true;
}

function fs(b,t)
{
	var valid = true;
	if (t != "Back") {
		valid = validate(b);
	}
	if (valid==true) {
		b.disabled=true;
		b.value="Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();
		return true;
	}
}

function init()
{
	var fm = document.forms["DoEventBB"];

	fm.elements["EvHomeTeamId"].selectedIndex=##TP_HOME_TEAM_IDX##;
	fm.elements["EvAwayTeamId"].selectedIndex=##TP_AWAY_TEAM_IDX##;
}

//calculate overround for generated mkt.
//at the moment only WH is implemented
//Please update this if you are adding another
//generated mkt.
function calculateOverround(mkt_sort) {

	var res = 0.0;

	switch (mkt_sort) {
		case "WH" :
			var LPInputs = new Array('WHHomeLP','WHAwayLP');
			break;
		default :
			var LPInputs = new Array();
	}

	for ( var i=0; i < LPInputs.length ; i++ ) {
		eval('var oc_lp = parsePrice(document.forms["DoEventBB"].' + LPInputs[i] + '.value);');

		if (oc_lp[0] != '' && oc_lp[0] != 'ERR' && oc_lp[1]!= '' ) {
			res +=  ( oc_lp[1] / ( parseFloat(oc_lp[0]) + parseFloat(oc_lp[1])) );
		}
	}

	return 100*res;
}


function doWarningOverround(button,onConfirm) {

	var confirmWH = true;

	##TP_IF {[tpGetVar MKT_WH 0]}##

	var genWH = document.forms["DoEventFB"].WHautogen.checked;

	if (genWH) {

		var overroundWH = calculateOverround('WH');

		if (parseFloat(overroundWH) < 100 ) {

			var overroundWH_disp = overroundWH.toFixed(2);
			confirmWH = confirm('You have inputted prices that will result in an underround of ' + overroundWH_disp + '%  for the Western Handicap market. \n Do you wish to continue?');
		}
	}

	##TP_ENDIF##

	if (confirmWH ) {

	 	return fs(button,onConfirm);

	}
}

</script>

</head>
<body onload="init();">
##TP_PLAY error_rpt.html##
<table border=0 cellspacing=0 cellpadding=2>
<form name=DoEventBB method=get action="##TP_CGI_URL##">
<input type=hidden name=ClassSort value="BB">
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::AUTOGEN::DoEvBB>
<input type=hidden name=TypeId value="##TP_TypeId##">
<input type=hidden name=EvId   value="##TP_EvId##">
<input type=hidden name="MktGrpList" value="##TP_MktGrpList##">
<tr>
	<th class=title colspan=2>
	Basketball Event Auto-Generation:&nbsp;
    ##TP_ClassName##,&nbsp;##TP_TypeName##
	</th>
</tr>
<tr>
	<td class=caption>Home vs Away</td>
	<td nowrap>
	##TP_IF {[string first SHORTCUT [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
		<input type=text size=2 name=EvShortcut value="##TP_EvShortcut##">
	##TP_ENDIF##
	<select name=EvHomeTeamId>
		##TP_LOOP c_idx {$TEAMARRAY(entries)}##
			<option value="##TP_TEAM_ID##">##TP_TEAM_NAME##</option>
		##TP_ENDLOOP##
	</select>
	<select name=EvAwayTeamId>
		##TP_LOOP c_idx {$TEAMARRAY(entries)}##
			<option value="##TP_TEAM_ID##">##TP_TEAM_NAME##</option>
		##TP_ENDLOOP##
	</select>
	</td>
</tr>
##TP_IF {[tpGetVar NumEvTags 0]>0}##
	<tr>
		<td class=caption>Flags</td>
		<td>
		<table cellspacing=0 cellpadding=0 border=0>
		##TP_LOOP ev_tag_idx {[expr {4*(([tpGetVar NumEvTags]+3)/4)}]}##
			##TP_IF {[tpGetVar ev_tag_idx]%4 == 0}##
				<tr>
			##TP_ENDIF##
			##TP_IF {[tpGetVar ev_tag_idx]<[tpGetVar NumEvTags]}##
				<td>
				<input type=checkbox name="EVTAG_##TP_EvTagCode##" ##TP_EvTagSel##>
				##TP_EvTagName##
				</td>
			##TP_ELSE##
				<td>&nbsp;</td>
			##TP_ENDIF##
			##TP_IF {([tpGetVar ev_tag_idx]+1)%4 == 0}##
				</tr>
			##TP_ENDIF##
		##TP_ENDLOOP##
		</table>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[string first VENUE [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
	<tr>
		<td class=caption>Venue</td>
		<td>
		<input type=text name=EvVenue value="##TP_EvVenue##" size=60>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[string first COUNTRY [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
	<tr>
		<td class=caption>Country</td>
		<td>
		<input type=text name=EvCountry value="##TP_EvCountry##" size=60>
		</td>
	</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Start Time</td>
	<td>
	<input name=EvStartTime type=text size=19 value="##TP_EvStartTime##">
	</td>
</tr>
<tr>
	<td class=caption>Stake limits</td>
	<td>Bet Min&nbsp;
	<input name=EvMinBet type=text size=8 value="##TP_EvMinBet##">
	&nbsp;&nbsp;
	Bet Max&nbsp;
	<input name=EvMaxBet type=text size=8 value="##TP_EvMaxBet##">
	</td>
</tr>
##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
	<tr>
		<td class=caption>Channels</td>
		<td>
		##TP_PLAY chan_sel.html##
		</td>
	</tr>
	<tr>
		<td class=caption>Fastkey</td>
		<td>
		<input type=text name=EvFastkey size=1 value="##TP_EvFastkey##">
		</td>
	</tr>
##TP_ENDIF##
<tr>
	<td colspan=2>&nbsp;</td>
</tr>
<tr class=subtitle>
	<th colspan=2 align=left>Market Selection Prices</th>
</tr>
##TP_IF {[tpGetVar MKT_WH 0]}##
	<tr>
		<td class=caption>##TP_DESC_WH##</td>
		<td colspan>&nbsp;Auto-generate?&nbsp;
		<input type="checkbox" name="WHautogen" value="1" ##TP_CHECKED_WH##>
		</td>
	</tr>
	<tr>
		<td class=caption>&nbsp;</td>
		<td>&nbsp;Handicap&nbsp;
		<input type=text name=MktHcapValue size=5 value="##TP_MktHcapValue##">
		##TP_IF {[OT_CfgGetTrue FUNC_HCAP_SIDE]}##
			<b>&nbsp;added to&nbsp;</b>
			<select name="MktHcapSide">
			<script>
			write_select('##TP_MktHcapSide##','H','Home','A','Away')
			</script>
			</select>
			<b>side</b>
		##TP_ELSE##
			<b>(added to home side)</b>
		##TP_ENDIF##
		</td>
	</tr>
	<tr>
		<td class=caption>&nbsp;</td>
		<td>&nbsp;Home&nbsp;<input type=text size=8 name=WHHomeLP value="##TP_WHHomeLP##">
		&nbsp;Away&nbsp;<input type=text size=8 name=WHAwayLP value="##TP_WHAwayLP##"></td>
	</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_OE 0]}##
	<tr>
    	<td class=caption>##TP_DESC_OE##</td>
    	<td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="OEautogen" value="1" ##TP_CHECKED_OE##>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_HL 0]}##
	<tr>
    	<td class=caption>##TP_DESC_HL##</td>
    	<td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="HLautogen" value="1" ##TP_CHECKED_HL##>
		&nbsp;&nbsp;&nbsp;
		Over/Under&nbsp;<input type=text size=6 name="HL_hcap_value" value="##TP_HL_hcap_value##">
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet OPENBET_CUST ""] == "BlueSQ"} ##
         <tr>
                <td class=caption>Calendar</td>
                <td><input type=checkbox name="Calendar" ##TP_CALENDAR##></td>
        </tr>
##TP_ENDIF##
<tr>
    <th colspan=2 class=buttons>
    <table border=0 cellspacing=0 cellpadding=0 width=100%>
    <tr>
        <th width=75% class=buttons>
        <input type=button class="btn_def" value="Add Event" onClick="##TP_IF {[OT_CfgGet ENABLE_OVERROUND_WARNING 0 ]}##return doWarningOverround(this,'EvAddBB') ##TP_ELSE## return fs(this,'EvAddBB')##TP_ENDIF##">
        <input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
        </th>
    </tr>
    </table>
    </th>
</tr>
</form>
</table>
</body>
</html>

