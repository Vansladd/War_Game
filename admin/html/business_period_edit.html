##TP_COMMENT {<!--
    $Id: business_period_edit.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $
    Copyright (c) 2009 Orbis Technology Ltd. All rights reserved.
//-->}##
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
	<title>Edit Business Period</title>

	<script language="Javascript" type="text/javascript">
	/* <![CDATA[ */

	// form submitting actions
	function fs(b,t) {

		if(!validate_date(document.editbp.bp_date_from)) return false;
		if(!validate_date(document.editbp.bp_date_to)) return false;
	
		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();
		return true;
	}

	// Data validation before submitting
	// Checks if is a informix date or dd/mm/yy date
	// Checks if the date is a really existing date (i.e no 30 Feb 2001)

	// return true also if date is empty
	function validate_date(date){

		if (date == "") return true;

		var informix_re = /[0-9]{4}-[0-9]{2}-[0-9]{2}/
		var display_re = /[0-9]{2}\/[0-9]{2}\/[0-9]{2}/
		var date_components = false;
		var day = null, month = null, year = null;

		if (date.value.match(informix_re) != null) {
			// informix date yyyy-mm-dd
			date_components = date.value.split('-');
			day   = date_components.pop();
			month = date_components.pop();
			year  = date_components.pop();

		} else if (date.value.match(display_re) != null){
			// dd/mm/yy date
			date_components = date.value.split('/');
			// reverse order
			year   = date_components.pop();
			month = date_components.pop();
			day  = date_components.pop();
			year = "20"+year;
		} else {
			alert ("Date not well formed");
			return false;
		} 
		
		if (!check_date_validity(month,day,year)) {
			alert("Date "+day+"/"+month+"/"+year+" is not valid");
		} else {
			return true;
		}
	} 

	// Checks if the date really exists. We do this by creating a Date object
	// and checking if the returned month is the same as the passed one, as well
	// as the year
	function check_date_validity(mm,dd,yyyy) {
		if (mm == null || dd == null || yyyy == null) return false;
		var d = new Date(mm + "/" + dd + "/" + yyyy);
		return d.getMonth() + 1 == mm && d.getDate() == dd && d.getFullYear() == yyyy;
	}

    /* ]]> */
    </script>

<body>
##TP_COMMENT {<!-- Business Periods Edit New Form //-->}##
    <table border="0" cellspacing="0" cellpadding="3">
        <form action="##TP_CGI_URL##" method="get" id="editBPForm" name="editbp">
            <tr>
                <th colspan="2" class="title">Edit Business Period</th> 
            </tr>
            <tr>
                <td class="caption"><label>Date From</label></td>
                <td><input type="text" name="bp_date_from" value="##TP_PeriodDateFrom##"/></td>
            </tr>
            <tr>
                <td class="caption"><label>Date To</label></td>
                <td><input type="text" name="bp_date_to" value="##TP_PeriodDateTo##"/></td>
            </tr>
            <tr>
                <th class="buttons" colspan="2">
                    <input type="button" class="btn_def" value="Edit Business Period" onClick="return fs(this,'BPDoEdit')"/>
                    <input type="hidden" name="SubmitName" value=""/>
                    <input type="hidden" name="EditID" value="##TP_PeriodID##"/>
                    <input type="hidden" name="action" value="ADMIN::BUSINESSPERIOD::DoBusinessPeriodSetup"/>
                </th>
            </tr>
        </form>
    </table>

##TP_COMMENT {<!-- END Business Periods Add New Form //-->}##

##TP_COMMENT {<!-- Operator Error Highlight //-->}##
    ##TP_IF {[tpGetVar ErrorFlag 0]}##
    <div class="error_hili">
        <h3>Error</h3>
        <label>##TP_ErrorMsg##</label>
    </div>
    ##TP_ENDIF##
##TP_COMMENT {<!-- END Operator Error Highlight //-->}##

##TP_COMMENT {<!-- Operator Info Highlight //-->}##
##TP_IF {[tpGetVar InfoFlag 0]}##
    <div class="info_hili">
        <h3>Info</h3>
        <label>##TP_InfoMsg##</label>
    </div>
##TP_ENDIF##
##TP_COMMENT {<!-- END Operator Info Highlight //-->}##

</body>
</html>
