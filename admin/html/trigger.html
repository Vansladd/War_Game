<html>

##TP_COMMENT $Id: trigger.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $##

<head>

<meta http-equiv="Content-" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">

<title>Freebet Trigger</title>

##TP_PLAY JS_WriteSelect.html##

<script>

<!--

	var Types = new Object();
	var TypeIdx = new Array();

	##TP_COMMENT
		Need some javascript to control the Introductory Source dropdowns
		Set up the arrays which will fill the dropdowns
	##

	##TP_LOOP type_idx 0 { [tpGetVar numTypes] }##

		Types["##TP_typeName##"] = new Object();
		Types["##TP_typeName##"].desc = "##TP_typeDesc##";
		Types["##TP_typeName##"].content = new Array();
		TypeIdx[TypeIdx.length] = "##TP_typeName##";

		##TP_LOOP source_idx 0 {$ITArray([tpGetVar type_idx],0,count)}##

			var source = new Object();
			source.id = "##TP_sourceName##";
			source.name = "##TP_sourceDesc##";
			arr = Types["##TP_typeName##"].content;
			arr[arr.length] = source;

		##TP_ENDLOOP##

	##TP_ENDLOOP##


	function fs(b,t)
	{
		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();

		return true;
	}

	function select_change()
	{
		document.trigger_select.action.value="ADMIN::FREEBETS::GoTriggerSelect";
		document.trigger_select.submit();
	}

	function shift_focus() {
		document.trigger_select.Back.focus();
	}

	function go_dd_popup() {
		popup = window.open(
			"##TP_CGI_URL##?action=ADMIN::BESTBETS::go_bbet_dd&bet_level=CATEGORY",
			"popup",
			"toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,height=480,width=400"
		);
		popup.focus();
	}

	function set_vals_3(level, id, type, name) {

		f = document.trigger_select;
		if (!f) {
			alert("unable to find form");
			return;
		}

		f.level.value = level;
		f.key.value   = id;
		f.name.value  = name;
		f.type.value  = type;

	}

	function set_vals(level, id, name) {

		document.location =
			"##TP_CGI_URL##?action=ADMIN::FREEBETS::DoTriggerLevel"
				+ "&TriggerID=##TP_TriggerID##"
				+ "&Level=" + level
				+ "&ID=" + id
				+ "&Submit=Insert";

	}

	function filter_types(s) {

		opt = s.options[s.selectedIndex].value;
		tform = s.form;
		choice = tform.ISsource.options;

		##TP_COMMENT blank the second dropdown##
		while(tform.ISsource.length > 0)
		{
			choice[0] = null;
		}

		##TP_COMMENT refill the array with the new choices##
		content = Types[opt].content;

		for(i = 0; i < content.length; i++)
		{
			newOpt = new Option();
			newOpt.value = content[i].id;
			newOpt.text = content[i].name;
			choice[choice.length] = newOpt;
		}

	}

//-->
</script>
</head>

<body>
##TP_PLAY error_rpt.html##
##TP_PLAY msg_rpt.html##

<form name="trigger_select" action="##TP_CGI_URL##" method=get >
<table border=0 cellspacing=0 cellpadding=2>
	<tr>
		<th colspan=2 class=title>Trigger Details</th>
	</tr>
	<tr>
		<td class=caption>Type</td>
  	##TP_IF {[tpGetVar PERM_ModifyFreeBets] !="" && [tpGetVar opAdd]}##
		<td>
			<select name=SelTrigCode onChange="select_change();">
				<script>
	    		write_select("##TP_SelTrigCode##"
						##TP_LOOP t_idx {[tpGetVar num_trigs]}##
	    				,"##TP_TrigCode##","##TP_TrigCode## - ##TP_TrigName##"
						##TP_ENDLOOP##
					);
				</script>
			</select>
		</td>
		##TP_ELSE##
		<td>##TP_Name##&nbsp;</td>
		<input type=hidden value=SelTriggerCode=##TP_SelTriggerCode##>
		##TP_ENDIF##
	</tr>


	<tr>
		<td class=caption>Rank</td>
  	##TP_IF {[tpGetVar PERM_ModifyFreeBets] !=""}##
		<td><input type=text name="Rank" value="##TP_Rank##" size=3 maxlength=3></td>
		##TP_ELSE##
		<td>##TP_Rank##&nbsp;</td>
		<input type=hidden name="Rank" value="##TP_Rank##" size=3 maxlength=3>
		##TP_ENDIF##
	</tr>

	##TP_IF {[tpGetVar XGAMEBET]}##
	<tr>
		<td class=caption>Game Type</td>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] !=""}##
		<td>
			<select name=GameSort>
				<script>
					write_select("##TP_DBGameSort##","","Any"
						##TP_LOOP xgame_idx {[tpGetVar num_sorts]}##
							,"##TP_GameSort##","##TP_GameName##"
						##TP_ENDLOOP##
					);
				</script>
			</select>
		</td>
		##TP_ELSE##
		<td>##TP_GameName##&nbsp;</td>
		<input type=hidden name=GameSort value=##TP_DBGameSort##>
		##TP_ENDIF##
	</tr>
	##TP_ENDIF##

	<!--Affiliate-->
	##TP_IF {[tpGetVar OffStarted] != 1 && [tpGetVar PERM_ModifyFreeBets] !=""}##
	<tr>
		<td class=caption>Affiliate</td>
   		<td><input type=radio name=AffOption value="" ##TP_ALL_NONE_CHECKED##>N/A</td>
	</tr>
	<tr>
		<td></td>
		<td><input type=radio name=AffOption value="All" ##TP_ALL_CHECKED##>All</td>
	</tr>
	<tr>
		<td></td>
		<td><input type=radio name=AffOption value="None" ##TP_NONE_CHECKED##>None</td>
	</tr>
	<tr>
		<td></td>
		<td><input type=radio name=AffOption value="Single" ##TP_SINGLE_CHECKED##>Single Affiliate
			<select name="Affiliate">
				<script>
						write_select("##TP_SelAff##"
							##TP_LOOP aff_idx {[tpGetVar num_aff]}##
								,"##TP_AffCode##","##TP_AffName##"
							##TP_ENDLOOP##
						);
				</script>
			</select>
		</td>
	</tr>
	<tr>
	<tr>
		<td></td>
		<td><input type=radio name=AffOption value="Group" ##TP_GROUP_CHECKED##>Affiliate Group
			<select name="AffiliateGrp">
				<script>
						write_select("##TP_SelAffGrp##"
							##TP_LOOP aff_grp_idx {[tpGetVar num_aff_grp]}##
								,"##TP_AffGrpCode##","##TP_AffGrpName##"
							##TP_ENDLOOP##
						);
				</script>
			</select>
		</td>
	</tr>
	##TP_ELSE##
	<tr>
		<td class=caption>Affiliate</td>
		<td>##TP_AFF_OPTION##
		##TP_IF {[tpGetVar AFF_OPTION] == "single"}##
		<script>
			write_which("##TP_SelAff##"
				##TP_LOOP aff_idx {[tpGetVar num_aff]}##
				,"##TP_AffCode##","##TP_AffName##"
				##TP_ENDLOOP##
			);
		</script>
		##TP_ELSEIF {[tpGetVar AFF_OPTION] == "group"}##
		<script>
			write_which("##TP_SelAffGrp##"
				##TP_LOOP aff_grp_idx {[tpGetVar num_aff_grp]}##
				,"##TP_AffGrpCode##","##TP_AffGrpName##"
				##TP_ENDLOOP##
			);
		</script>
		##TP_ENDIF##
		</td>
	</tr>
	##TP_ENDIF##

	<!-- new currency handling -->
	##TP_LOOP cc_idx {[tpGetVar NUM_TRIGGER_CCYS]}##
	<tr>
		<td class=caption>##TP_TRIGGER_CCY_CODE##</td>
		##TP_IF {([tpGetVar TrigCode] == "REG") || ([tpGetVar TrigCode] == "VOUCHER") || ([tpGetVar TrigCode] == "REFERRAL") || ([tpGetVar TrigCode] == "REFEREE") || [tpGetVar TrigCode] == "UPLOAD"}##
			  <!-- REG and VOUCHER triggers don't have a currency amount -->
			  <input type=hidden name="Value_##TP_TRIGGER_CCY_CODE##" value="">
	    ##TP_ELSE##
		    ##TP_IF {[tpGetVar PERM_ModifyFreeBets] != ""}##
			  <td>
				<input type=text name="Value_##TP_TRIGGER_CCY_CODE##" value="##TP_TRIGGER_CCY_AMOUNT##" size=6 maxlength=6>
			  </td>
			##TP_ELSE##
			  <td>
				##TP_TRIGGER_CCY_AMOUNT##
			  </td>
			  <input type=hidden name="Value_##TP_TRIGGER_CCY_CODE##" value=##TP_TRIGGER_CCY_AMOUNT##>
		    ##TP_ENDIF##
        ##TP_ENDIF##
		</td>
	</tr>

	##TP_ENDLOOP##
	<!-- new currency handling -->

	<!-- check whether trigger is the voucher trigger -->
	##TP_IF {[tpGetVar TrigCode] == "VOUCHER"}##

	<tr>
		<td class=caption>Voucher Type</td>

		<td>
			<select name=SelVoucherCode>
				<script>
	    		write_select("##TP_SelVoucherCode##"
						##TP_LOOP v_idx {[tpGetVar num_vouchers]}##
	    				,"##TP_VoucherCode##","##TP_VoucherCode## - ##TP_VoucherName##"
						##TP_ENDLOOP##
					);
				</script>
			</select>
		</td>
		##TP_ELSE##
		<td>##TP_SelVoucherCode##&nbsp;</td>
		<input type=hidden name=SelVoucherCode value="##TP_SelVoucherCode##" size=10>
		##TP_ENDIF##
	</tr>


	<!-- check whether trigger is the referee trigger -->
	##TP_IF {[tpGetVar TrigCode] == "REFEREE"}##

	<tr>
		<td class=caption>Linked Referral Offer</td>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] !="" && [tpGetVar OffStarted] != 1}##
		<td>
			<select name=SelRefOfferId>
				<script>
	    		write_select("##TP_SelRefOfferId##"
						##TP_LOOP r_idx {[tpGetVar num_ref_offers]}##
	    				,"##TP_RefOfferId##","##TP_RefOfferId## - ##TP_RefOfferName##"
						##TP_ENDLOOP##
					);
				</script>
			</select>
		</td>
		##TP_ELSE##
		<td>##TP_SelRefOfferId## - ##TP_SelRefOfferName##&nbsp;</td>
		<input type=hidden name=SelRefOfferId value="##TP_SelRefOfferId##" size=10>
		##TP_ENDIF##
	</tr>

	##TP_ENDIF##

	##TP_IF { [tpGetVar TrigCode] == "PROMO" }##

	<tr>
		<td class="caption">Promotional Code</td>
		<td>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] !="" && [tpGetVar OffStarted] != 1}##
			<input type="text" name="promo_code" value="##TP_PromoCode##">
		##TP_ELSE##
			##TP_PromoCode##
		##TP_ENDIF##
		</td>
	</tr>

	##TP_ENDIF##

	<!-- check if the trigger is the Introductory Sources trigger -->
	##TP_IF {[tpGetVar TrigCode] == "INTRO"}##
		<tr>
			<td class="caption">Introductory Sources Offer</td>
			##TP_IF {[tpGetVar PERM_ModifyFreeBets] !="" && [tpGetVar OffStarted] != 1}##
				##TP_COMMENT modifiable in this case##
				<td>
					<select name="IStype" onChange="javascript:filter_types(this);">
						<script>
						write_select("##TP_Type##"
									##TP_LOOP type_idx 0 {[tpGetVar numTypes]}##
									,"##TP_typeName##","##TP_typeDesc##"
									##TP_ENDLOOP##
								);
						</script>
					</select>
				</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td>
					##TP_COMMENT we need type_idx to reset to 0 now##
					<select name="ISsource">
						##TP_TCL {tpSetVar type_idx [tpGetVar selectedType]}##
						<script>
							write_select("##TP_Source##"
								##TP_LOOP source_idx 0 {$ITArray([tpGetVar type_idx],0,count)}##
								,"##TP_sourceName##","##TP_sourceDesc##"
								##TP_ENDLOOP##
							);
						</script>
					</select>
				</td>
			##TP_ELSE##
			##TP_COMMENT not modifiable##
				<td><input type="hidden" name="IStype" value="##TP_Type##">##TP_TypeName##</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td><input type="hidden" name="ISsource" value="##TP_Source##">##TP_SourceName##</td>
			##TP_ENDIF##
		</tr>
	##TP_ENDIF##

	<!-- check if the trigger is for 1st bet or 1st deposit -->
	##TP_IF {[OT_CfgGet ENABLE_FREEBETS_CHAN_STRICT 0] && ([tpGetVar TrigCode] == "FBET" || [tpGetVar TrigCode] == "BET1" || [tpGetVar TrigCode] == "DEP1" || [tpGetVar TrigCode] == "XGAMEBET1" || [tpGetVar TrigCode] == "SPORTSBET1")}##
		<tr>
			<td class="caption">Channel Strict</td>
			##TP_IF {[tpGetVar PERM_ModifyFreeBets] !="" && [tpGetVar OffStarted] != 1}##
				##TP_COMMENT modifiable in this case##
				<td>
					<select name=ChannelStrict>
						<script>
						write_select('##TP_ChannelStrict##','N','No','Y','Yes')
						</script>
					</select>
				</td>
			</tr>
			##TP_ELSE##
			##TP_COMMENT not modifiable##
				<td><input type="hidden" name="ChannelStrict" value="##TP_ChannelStrict##">##TP_ChannelStrict##</td>
			##TP_ENDIF##
		</tr>
	##TP_ELSE##
	##TP_COMMENT not modifiable##
	<input type="hidden" name="ChannelStrict" value="##TP_ChannelStrict##">
	##TP_ENDIF##

	<tr>
		<th colspan=2 class=buttons>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] !=""}##
		##TP_IF {[tpGetVar opAdd] == "1"}##
		<input type=button class="btn_def" value="Add Trigger" onClick="return fs(this,'TriggerAdd')">
		##TP_ELSE##
		<input type=button class="btn_def" value="Modify Trigger" onClick="return fs(this,'TriggerMod')">
		<input type=button class="btn_def" value="Delete Trigger" onClick="return fs(this, 'TriggerDel')">
		##TP_ENDIF##
		##TP_ENDIF##
		<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
		</th>
	</tr>

</table>

<input type=hidden name=SubmitName value="">
<input type=hidden name="action"   value="ADMIN::FREEBETS::DoTrigger">
<input type=hidden name=OfferID    value=##TP_OfferID##>
<input type=hidden name=TriggerID  value=##TP_TriggerID##>
<input type=hidden name="opAdd"    value="##TP_TCL {tpGetVar opAdd}##"\>

</form>

<!-- check whether trigger is the special bet trigger -->
##TP_IF {[tpGetVar TrigCode] == "BET" && ![tpGetVar opAdd]}##

<br>

<table border=0 cellspacing=0 cellpadding=2>

	<tr><th colspan="3" class="title">Trigger Levels</th></tr>

	<tr>
		<td class="caption" style="text-align: left">Level</td>
		<td class="caption" style="text-align: left">Name</td>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] !=""}##
		<td>&nbsp;</td>
		##TP_ENDIF##
	</tr>

	##TP_LOOP i { [tpGetVar num_levels 0] }##

	<tr>
		<td>##TP_bet_level##</td>
		<td>##TP_bet_name##</td>
		##TP_IF {[tpGetVar PERM_ModifyFreeBets] != ""}##
		<td>[<a href="##TP_CGI_URL##?action=ADMIN::FREEBETS::DoTriggerLevel&TriggerID=##TP_TriggerID##&Level=##TP_bet_level##&ID=##TP_bet_id##&Submit=Delete">
				Delete</a>]</td>
		##TP_ENDIF##

	</tr>

	##TP_ENDLOOP##

	##TP_IF {[tpGetVar num_levels 0] == 0 || [OT_CfgGet FREEBET_MULT_LEVEL 1]}##

	<tr>
		<td colspan="2">
		<td style="text-align: right">
			[<a href="javascript:go_dd_popup (); void (0);">
				Add</a>]
		</td>
	</tr>

	##TP_ENDIF##

</table>

##TP_ENDIF##

</body>

</html>
