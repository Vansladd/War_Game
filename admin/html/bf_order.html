<html>
<!-- $Id: bf_order.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>OpenBet Betfair Selection Order</title>

##TP_PLAY JS_WriteSelect.html##
<script language=javascript>
function fs(b,t)
{
	var size = parseFloat(b.form.BFSize.value);
	var limit = parseFloat(b.form.BFSizeLimit.value);

	if (!stk_chk(b,size,limit)) {
		return;
	}

	if (!confirm_order(b,size)) {
		return;
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function stk_chk(b, size, limit)
{

	var price = parseFloat(b.form.BFPrice.value);
	var type = b.form.BFOrderType.value;

	if (isNaN(size)) {
		alert('Enter a valid size');
		return false;
	}

	if (type == 'B') {
		var exp = size;
	} else {
		var exp = size*(price-1);
	}

	if (exp > limit) {
		  alert('Order size too large, limit '+limit);
		  return false;
	} else if (size < ##TP_TCL {OT_CfgGet BF_MIN_SIZE 2}##) {
		  alert('Order size too small, must be ##TP_TCL {OT_CfgGet BF_MIN_SIZE 2}##+');
		  return false;
	}

	return true;
}

function confirm_order(b,size) {

	var price = parseFloat(b.form.BFPrice.value);
	var type = b.form.BFOrderType.value;

	if (type == 'B') {
		var exp = size;
	} else {
		var exp = size*(price-1);
	}

	return confirm(price+" @ "+size+ ", exposure: "+exp.toFixed(2));
}

</script>
</head>

<body>
##TP_PLAY error_rpt.html##

##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
<form action="##TP_CGI_URL##" method=%"POST">
<input type=hidden name=action value="ADMIN::BETFAIR_ORDER::DoBFPlaceOrder">
<input type=hidden name=SubmitName>
<input type=hidden name=OcId value="##TP_OcId##">
<input type=hidden name=OcDesc value="##TP_OcDesc##">
<input type=hidden name=BFExchId value="##TP_BFExchId##">
<input type=hidden name=BFEvMktId value="##TP_BFEvMktId##">
<input type=hidden name=BFEvOcId value="##TP_BFEvOcId##">
<input type=hidden name=BFAsianId value="##TP_BFAsianId##">
<input type=hidden name=BFOrderType value="##TP_BFOrderType##">

<input type=hidden name=ClassId value="##TP_ClassId##">

##TP_IF {[op_allowed BFLargeOrder]}##
	<input type=hidden name=BFSizeLimit value="##TP_BFLargeOrder##">
##TP_ELSEIF {[op_allowed BFSmallOrder]}##
	<input type=hidden name=BFSizeLimit value="##TP_BFSmallOrder##">
##TP_ELSE##
	<input type=hidden name=BFSizeLimit value="0">
##TP_ENDIF##
<table cellspacing=0 cellpadding=3 border=0>
<tr>
	<th colspan=4 class=title>
	##TP_IF {[tpGetVar BFOrderTypeV]=="B"}##
		Betfair Selection Back Order ##TP_OcDesc##
	##TP_ELSE##
		Betfair Selection Lay Order ##TP_OcDesc##
	##TP_ENDIF##
	</th>
</tr>
<tr>
	##TP_IF {[op_allowed BFOrder]}##
		<td class=caption>Price: </td>
			<td><select name="BFPrice">
				<script>
				write_select('##TP_BFDefPrice##'
					##TP_LOOP bf_price_idx {[tpGetVar BFNumPrices]}##
					,"##TP_BFPrice##","##TP_BFPrice##"
					##TP_ENDLOOP##
				);
				</script>
				</select></td>
		<td class=caption>Size: </td>
		<td><input type="text" name="BFSize" value="" size=10 maxlength="10"></td>
	##TP_ELSE##
		<td><b> User does not have Permission to Place an order </b></td>
	##TP_ENDIF##
</tr>
<tr>
	##TP_IF {[op_allowed BFOrder]}##
		<th class=buttons colspan=4>
			<input type=button value=Close  onClick="window.close()">
			<input type=button value=Submit  onClick="fs(this,'BFOrder')">
		</th>
	##TP_ENDIF##
</tr>
</table>
</form>
##TP_ENDIF##
</body>
</html>
