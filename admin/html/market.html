<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- $Id: market.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
##TP_IF {![tpGetVar FuncOffice 0]}##
	<style type="text/css">
		.infoyes {
			color: white;
		}
	</style>
##TP_ENDIF##
<title>Add Event Market</title>
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>

##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
	##TP_PLAY bf_market.js##
##TP_ENDIF##

var errorList = "";

##TP_IF {[tpBindGet MktMargin] != "---" && [tpBindGet MktMargin] != ""}##
var margin = ##TP_MktMargin##;
##TP_ELSE##
var margin = 101;
##TP_ENDIF##


function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function validate(f)
{
	return true;

	var desc          = strTrim(f.Desc.value, " ");
	var disporder     = strTrim(f.Disporder.value, " ");
	var group_menu    = f.OptGrp;
	var scheme_menu   = f.PricingScheme;
	var group         = group_menu.options[group_menu.selectedIndex].value;
	var scheme        = scheme_menu.options[scheme_menu.selectedIndex].value;
	var max_bet       = f.MaxBet.value;
	var min_bet       = f.MinBet.value;
	var max_tot_stake = f.MaxTotalStake.value;
	var odds_num      = f.OddsNum.value;
	var odds_denom    = f.OddsDenom.value;

	errorList = "";

	if (desc.length == 0) {
		add_err("Description cannot be empty");
	} else {
		if (!isSafeStr(desc)) {
			add_err("don't use these characters in descriptions: "
				+ "tab [ ] { } < > \" \\ $");
		}
	}
	if (group == "") {
		add_err("no market specified");
	}
	if (!isMoney(max_tot_stake, false)) {
		add_err("max total stake is invalid - must be a money quantity");
	}
	if ((min_bet.length > 0) && (!isMoney(min_bet, false))) {
		add_err("min bet is invalid - must be a money quantity");
	}
	if ((max_bet.length > 0) && (!isMoney(max_bet, false))) {
		add_err("max bet is invalid - must be a money quantity");
	}
	if ((min_bet.length > 0) && (max_bet.length > 0)) {
		if (isMoney(min_bet, false) && isMoney(max_bet, false)) {
			if (parseFloat(min_bet) > parseFloat(max_bet)) {
				add_err("min bet is bigger than max bet");
			}
		}
	}
	if (disporder.length > 0) {
		if (!isInt8(disporder, true)) {
			add_err("disporder must be an integer between +/-99999999");
		}
	}
	if (scheme == 'LP') {
		if (!isInt8(odds_num, false) || !isInt8(odds_denom, false)) {
			add_err("odds must be specified for live price");
		} else {
			odds_num   = parseInt(odds_num);
			odds_denom = parseInt(odds_denom);
			if ((parseFloat(odds_num) < 1) || (parseFloat(odds_denom) < 1)) {
				add_err("odds num/denom must be positive integers");
			}
		}
	}

	if (errorList != "") {
		alert("There are some errors in the form:\n\n" + errorList);
		return false;
	}

	return true;
}

function write_oc_tr(settled,result_conf,result,status,displayed)
{
	if (settled == 'Y') {
		document.write('<tr class=settled>');
	} else if (result_conf == 'Y') {
		document.write('<tr class=confirmed>');
	} else if (result != '-') {
		document.write('<tr class=resulted>');
	} else if (status == 'S') {
		document.write('<tr class=suspended>');
	} else if (displayed == 'N') {
		document.write('<tr class=hidden>');
	} else {
		document.write('<tr class=active>');
	}
}

function write_pool_tr(settled,result_conf,status,displayed,isvoid)
{
    if (settled == 'Y') {
		document.write('<tr class=settled>');
	} else if (result_conf == 'Y') {
		document.write('<tr class=confirmed>');
	} else if (isvoid == 'Y') {
		document.write('<tr class=resulted>');
	} else if (status != 'A') {
		document.write('<tr class=suspended>');
	} else if (displayed == 'N') {
		document.write('<tr class=hidden>');
	} else {
		document.write('<tr class=active>');
	}
}

function write_oc_result(type,result,score,place,w_dh_num,w_dh_den,p_dh_num,p_dh_den)
{
	var dh_str = "";

	if (w_dh_num != "" && w_dh_den != "") {
		dh_str += "W:"+w_dh_num+"/"+w_dh_den;
	}
	if (p_dh_num != "" && p_dh_den != "") {
		if (dh_str != "") {
			dh_str += ", ";
		}
		dh_str += "P:"+p_dh_num+"/"+p_dh_den;
	}

	if (result == "W") {
		document.write("Win");
		if (place != "") {
			document.write(' ('+place+')');
		}
		if (dh_str != "") {
			document.write(' '+dh_str);
		}
	} else if (result == "P") {
		document.write("Place");
		if (place != "") {
			document.write(' ('+place+')');
		}
		if (dh_str != "") {
			document.write(' '+dh_str);
		}
	} else if (result == "L") {
		document.write('Lose');
	} else if (result == "V") {
		document.write('Void');
	} else if (result == "N") {
		document.write('Continuous');
	} else if (result == "H") {
		document.write("Handicap");
		if (type == "H" || type == "A") {
			document.write (" ("+score+")");
		}
	} else if (result == "U") {
		document.write('Push');
	} else {
		document.write('-');
	}
}

function write_odds(n,d)
{
	if (n=="" || d == "") {
		document.write("(no price)");
	} else {
		if (n != d) {
			document.write("" + n + "/" + d);
		} else {
			document.write("evens");
		}
	}
}

var over_round = 0.0;

function write_oc_price(lp_avail,sp_avail,result,lp,sp)
{
	var show_sp = false

	if (sp_avail == "Y" && sp != "N/A") {
		document.write("SP");
		show_sp = true;
		if (result == "W" || result == "P") {
			document.write(": "+sp);
		}
	} else if (sp_avail == "Y" && sp == "N/A"){
		document.write("N/A");
		show_sp = true;
	}

	if (lp_avail == "Y" && lp != "N/A") {
		if (sp_avail == "Y") {
			document.write(", ");
		}
		document.write("LP: "+lp);
	} else if (lp_avail == "Y" && lp == "N/A" && !show_sp) {
		document.write("N/A");
	}
}

function round(num, dp) {
	var str = "";
	var splt = new Array();
	var i = 0;

	splt = strSplit(num, ".");
	if (splt.length == 2) {
		if (splt[0].length < 1) {
			splt[0] = 0;
		}
		if (splt[1].length <= Number(dp)) {
			str += splt[0]+"."+splt[1];
			for (i = splt[1].length; i < dp; i++) {
				str += "0";
			}
		} else {
   			str = splt[0]+"."+String(splt[1]).substring(0,dp);
			n = String(splt[1]).charAt(dp);
			if (n >= 5) {
				b = Number(splt[0])*Math.pow(10, Number(dp));
				b += Number(splt[1].substring(0, dp)) + 1;
				str = ""+b;
				str = str.substring(0, str.length-dp) +
					"." + str.substring(str.length-dp, str.length);
			}
		}
	} else if (splt.length == 1) {
		str = splt[0]+".";
		for (i = 0; i < dp; i++) {
			str += "0";
		}
	}
	return str;
}

function go_dbv()
{
	var url = "##TP_TCL {OT_CfgGet DBV_URL}##?action=go_market&ev_mkt_id="
		+ "##TP_MktId##" + "&sort=" + "##TP_MktSort##";
	window.open(
		url,
		"Liabiity_monitor",
		"toolbar=no,location=no,directories=no,menubar=no,resizable=yes,scrollbars=yes,width=600,height=500"
	);

	return false;
}

function fs(b,t)
{
	if (t == "DBV") {
		return go_dbv();
	}
	##TP_IF {![tpGetVar opAdd 0] && [OT_CfgGet BF_ACTIVE 0]}##
		if (t == "GoBFAudit") {
			b.form.AuditInfo.value = "BetfairMonitor";
			t = "GoAudit";
		}
	##TP_ENDIF##
	##TP_IF { [OT_CfgGet ENABLE_OVERROUND_WARNING  0 ] == 1 && [tpGetVar Settled 0] != 1}##
	if (t == "MktMod") {
		if (!checkOverround()) {
			return;
		}
	}
	##TP_ENDIF##

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function promptCloneMarket(b,t) {

	##TP_IF {[tpGetVar AllowDDDeletion 0]}##
		b.form.del_mkt.disabled = true;
	##TP_ENDIF##

	b.form.mod_mkt.disabled = true;

	var name = prompt("Please enter a new name for the cloned market","##TP_ESC esc_js####TP_MktName####TP_ESC##");

	if (name == null) {
		##TP_IF {[tpGetVar AllowDDDeletion 0]}##
			b.form.del_mkt.disabled = false;
		##TP_ENDIF##
		b.form.mod_mkt.disabled = false;
		return;
	}

	if (name != "##TP_MktName##" && name != '') {
		b.form.newMktName.value = name;
		return fs(b,t);
	}

	if (name == "##TP_MktName##") {
		alert('The names of the new market and the old market cannot be the same.');
		return promptCloneMarket(b,t);
	}

	if( name == '') {
		return promptCloneMarket(b,t);
	}

}

function blurb_popup (id, sort) {
	if (id == "") {
		alert("No Id specified, does the "+sort+" exist.\n"+
			"You must create it before you can add a blurb");
		return;
	}

	window.open("##TP_CGI_URL##?action=ADMIN::BLURB::do_blurb&ref_id="+id+"&sort="+sort,
		"Blurb",
		"toolbar=no,location=no,directories=no,menubar=no,resizable=yes,width=600,height=200");
}

/**
 * Display warning to user if turning "terms with bet" off.
 *
 * If 'E/W with bet' is not specified
 *
 * If it is specified (and an attempt is made to change it
 * from 'Yes' to 'No' then a warning should be displayed.)
 */
function checkEWWithBet() {
	var i = document.forms["NewEvMkt"].elements["MktEWWithBet"];

	// no need to check if this is a new market
	var opAdd = ##TP_IF {[tpGetVar opAdd 0]}##true##TP_ELSE##false##TP_ENDIF##;

	if (!opAdd) {
		var defaultValue = "##TP_MktEWWithBet##";
		var selectedValue = i.options[i.selectedIndex].value;

		if (defaultValue == "Y" && selectedValue == "N") {
			var c = confirm("Once bets have been placed, changing 'Terms with Bet' to 'No' may cause this market to missettle. Are you sure you wish to continue?");
			if (!c) {
				for (j=0; j < i.options.length; j++) {
					if (i.options[j].value == defaultValue) {
						i.selectedIndex = j;
					}
				}
			}
		}
	}
}

function check_name_length()
{
	var mkt_name = document.getElementById('mkt_name').value;
	if (mkt_name.length > 100) {
		alert('A market name cannot be longer than 100 characters long.\nYour market name has been truncated to 100 characters.');
		document.getElementById('mkt_name').value = mkt_name.substr(0,100);
	}
}


function checkOverround() {

	//check if action is to activate mkt
	var defaultMktStatus = '##TP_MktStatus##';
	var f = document.forms["NewEvMkt"];
	var newStatus = f.MktStatus.options[f.MktStatus.selectedIndex].value;
	var statuschange = defaultMktStatus + newStatus;

	if (parseFloat(margin) < 100 ) {

		var margin_disp = margin.toFixed(2);
		//QC 193 replace overround in the error msg by underround

		if (statuschange == 'AS') {
			var bool = confirm( 'You are trying to suspend this market. When you activate it, that action will result in an underround of ' + margin + '%. Do you wish to continue?');
		} else if (statuschange == 'SA') {
			var bool = confirm( 'You are trying to activate this market. That action will result in an underround of ' + margin + '%. Do you wish to continue?');
		} else {
			return 1
		}

		if (bool) {
			return 1;
		}
		else {

			var statuses = document.forms["NewEvMkt"].MktStatus;
			for (var i = 0; i < statuses.options.length;i++){
				if (statuses.options[i].value == '##TP_MktStatus##'){
					statuses.options[i].selected = true;
				}
			}
			return 0;
		}
	} else {
		return 1;
	}
}

</script>
</head>

<body>

##TP_PLAY error_rpt.html##
##TP_PLAY msg_rpt.html##

##TP_IF {[tpGetVar opAdd 0]}##
	##TP_TCL {tpSetVar Settled 0}##
##TP_ENDIF##
<form name="NewEvMkt" method=get action="##TP_CGI_URL##" onSubmit="return validate(this);">
<table border=0 cellspacing=0 cellpadding=2>
<tr>
	<th class=title colspan=2>
	##TP_EvDesc## market
	</th>
</tr>
<tr class=infoyes>
	<th colspan=2 align=center>
	Type of market : &nbsp;
	##TP_MktOcGrpName## &nbsp;
	(
	<script>
	write_which('##TP_MktSort##'
		##TP_LOOP mmkt_idx {[tpGetVar NumMMkts]}##
			,"##TP_MMktCode##","##TP_MMktDesc##"
		##TP_ENDLOOP##
	)
	</script>
	)
	<input type=hidden name="MktGrpId" value="##TP_MktGrpId##">
	<input type=hidden name="MktSort"  value="##TP_MktSort##">
	<input type=hidden name="MktType"  value="##TP_MktType##">
	</th>
</tr>

##TP_IF {[tpGetVar FuncShowDDId 0] && ![tpGetVar opAdd 0]}##
	<tr>
		<td class="caption">Market Identifier</td>
		<td>##TP_MktId##</td>
	</tr>
##TP_ENDIF##

<tr>

<td class=caption> Name </td>

<td>
<input name="mkt_name" id="mkt_name" type="text" value="##TP_MktName##" size=40 onchange="check_name_length();">
</td>
</tr>

<tr>
	<td class=caption>Status</td>
	<td>
	##TP_IF {![tpGetVar Settled 0]}##
		<select name="MktStatus" value="##TP_MktStatus##">
			<option value="A" ##TP_IF {[ tpBindGet MktStatus] == "A"}## selected ##TP_ENDIF##>
				Active
			</option>
			<option value="S" ##TP_IF {[ tpBindGet MktStatus] == "S"}## selected ##TP_ENDIF##>
				Suspended
			</option>
		</select>
		##TP_IF {[string first EXTKEY [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
			&nbsp;&nbsp;&nbsp;
			<b>External Link Key</b>&nbsp;
			<input type="text" name="MktExtKey" size=10 maxlength=10 value="##TP_MktExtKey##">
		##TP_ENDIF##
	##TP_ELSE##
		<script>
		write_which('##TP_MktStatus##','A','Active','S','Suspended')
		</script>
		<input type=hidden name=MktStatus value="##TP_MktStatus##">
		<input type=hidden name=MktExtKey value="##TP_MktExtKey##">
	##TP_ENDIF##
	</td>
</tr>
<tr>
	<td class=caption>Auto Traded</td>
	<td>
		<script>write_which('##TP_MktAutoTraded##','Y','Yes','N','No');</script>
	</td>
</tr>
<tr>
	<td class=caption>Display order</td>
	<td>
	<input name="MktDisporder" TYPE="text" size="6" value="##TP_MktDisporder##">
	&nbsp;&nbsp;&nbsp;
	<b>Displayed</b>
	&nbsp;
	<select name="MktDisplayed">
	<script>
	write_select('##TP_MktDisplayed##','Y','Yes','N','No')
	</script>
	</select>
	##TP_IF {![tpGetVar Settled 0]}##
		##TP_IF {[string first TAX_RATE [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
			&nbsp;&nbsp;&nbsp;
			<b>Tax rate</b>
			&nbsp;
			<input name=MktTaxRate type=text size=5 value="##TP_MktTaxRate##">
		##TP_ELSE##
			<input type=hidden name=MktTaxRate value="##TP_MktTaxRate##">
		##TP_ENDIF##
	##TP_ELSE##
		<input type=hidden name=MktTaxRate value="##TP_MktTaxRate##">
	##TP_ENDIF##
</tr>
<tr>
	<td class=caption>Feed Updateable</td>
	<td>
		<select name="MktFeedUpd">
		<script>
			write_select('##TP_MktFeedUpd##','-','N/A','Y','Yes','N','No','E','Event-Only (no EW)','P','No Price Update')
		</script>
		</select>
	<td/>
</tr>

<!-- Various pricing options available for non-hcap markets -->

##TP_IF {[tpGetVar MktType] == "-"}##
	##TP_IF {[string first [tpGetVar ClassSort] "HR/GR"]>=0}##
		<!-- Horse and dog events can have starting price & Fcast/Tcast -->
		<tr>
			<td class=caption>Pricing</td>
			<td>
			<b>Live:</b>
			##TP_IF {![tpGetVar Settled 0]}##
				<select name="MktLPAvail">
				<script>
				write_select('##TP_MktLPAvail##','Y','Yes','N','No')
				</script>
				</select>
			##TP_ELSE##
				<script>
				write_which('##TP_MktLPAvail##','Y','Yes','N','No')
				</script>
				<input type=hidden name=MktLPAvail value="##TP_MktLPAvail##">
			##TP_ENDIF##
			&nbsp;&nbsp;&nbsp;
			<b>SP:</b>
			##TP_IF {![tpGetVar Settled 0]}##
				<select name="MktSPAvail">
				<script>
				write_select('##TP_MktSPAvail##','N','No','Y','Yes')
				</script>
				</select>
			##TP_ELSE##
				<script>
				write_which('##TP_MktSPAvail##','Y','Yes','N','No')
				</script>
				<input type=hidden name=MktSPAvail value="##TP_MktSPAvail##">
			##TP_ENDIF##
			##TP_IF {[string first GP_AVAIL [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
				&nbsp;&nbsp;&nbsp;
				<b>GP:</b>
				##TP_IF {![tpGetVar Settled 0]}##
					<select name="MktGPAvail">
					<script>
					write_select('##TP_MktGPAvail##','N','No','Y','Yes')
					</script>
					</select>
				##TP_ELSE##
					<script>
					write_which('##TP_MktGPAvail##','Y','Yes','N','No')
					</script>
					<input type=hidden name=MktGPAvail value="##TP_MktGPAvail##">
				##TP_ENDIF##
			##TP_ENDIF##
			<!--- For horse racing, we'll eventually support pari-mutuel prices, --->
			<!--- this is more a statement of intent than a firm commitment      --->
			##TP_IF {[tpGetVar ClassSort]=="HR"}##
				##TP_IF {[OT_CfgGetTrue FUNC_USE_TOTE_DIV]}##
					&nbsp;&nbsp;&nbsp;
					<b>Dividend:</b>
					##TP_IF {![tpGetVar Settled 0]}##
						<select name="MktPMAvail">
						<script>
						write_select('##TP_MktPMAvail##','N','No','Y','Yes')
						</script>
						</select>
					##TP_ELSE##
						<script>
						write_which('##TP_MktPMAvail##','Y','Yes','N','No')
						</script>
						<input type="hidden" name="MktPMAvail" value="##TP_MktPMAvail##">
					##TP_ENDIF##
				##TP_ELSE##
					<input type="hidden" name="MktPMAvail" value="##TP_IF {[tpGetVar opAdd 0]}##N##TP_ELSE####TP_MktPMAvail####TP_ENDIF##">
				##TP_ENDIF##
			##TP_ELSE##
				<input type="hidden" name="MktPMAvail" value="N">
			##TP_ENDIF## <!-- Horse -->
			</td>
		</tr>
		##TP_IF {[OT_CfgGet FUNC_USE_FC_TC 0]}##
			<tr>
				<td class=caption>Bet types</td>
				<td>
				<b>Forecasts ?</b>&nbsp;
				##TP_IF {![tpGetVar Settled 0]}##
					<select name="MktFCAvail">
					<script>
					write_select('##TP_MktFCAvail##','N','No','Y','Yes')
					</script>
					</select>
				##TP_ELSE##
					<script>
					write_which('##TP_MktFCAvail##','N','No','Y','Yes')
					</script>
					<input type=hidden name=MktFCAvail value="##TP_MktFCAvail##">
				##TP_ENDIF##
				&nbsp;&nbsp;&nbsp;
				<b>Tricasts ?</b>&nbsp;
				##TP_IF {![tpGetVar Settled 0]}##
					<select name="MktTCAvail">
					<script>
					write_select('##TP_MktTCAvail##','N','No','Y','Yes')
					</script>
					</select>
				##TP_ELSE##
					<script>
					write_which('##TP_MktTCAvail##','N','No','Y','Yes')
					</script>
					<input type=hidden name=MktTCAvail value="##TP_MktTCAvail##">
				##TP_ENDIF##
				</td>
			</tr>
		##TP_ELSE##
			<input type=hidden name=MktFCAvail value=N>
			<input type=hidden name=MktTCAvail value=N>
		##TP_ENDIF##
	##TP_ELSEIF {[tpGetVar ClassSort] == "PL"}##
		<input type=hidden name=MktLPAvail value=N>
		<input type=hidden name=MktSPAvail value=N>
		<input type=hidden name=MktPMAvail value=Y>
		<input type=hidden name=MktFCAvail value=N>
		<input type=hidden name=MktTCAvail value=N>
	##TP_ELSE##
		<input type=hidden name=MktLPAvail value=Y>
		<input type=hidden name=MktSPAvail value=N>
		<input type=hidden name=MktPMAvail value=N>
		<input type=hidden name=MktFCAvail value=N>
		<input type=hidden name=MktTCAvail value=N>
	##TP_ENDIF##

	<!--- Each-way and place options, not available for some markets --->

	##TP_IF {[tpGetVar MktCanPlace 1]}##
		<tr>
			<td class=caption>Each-Way</td>
			<td>
			##TP_IF {![tpGetVar Settled 0] && [tpGetVar AllowDDCreation 0]}##
				<select name="MktEWAvail">
				<script>
				write_select('##TP_MktEWAvail##','N','No','Y','Yes')
				</script>
				</select>
				&nbsp;&nbsp;
				<b>Places:</b>
				<input name="MktEWPlaces" TYPE="text" size="4" value="##TP_MktEWPlaces##">
				&nbsp;&nbsp;
				<b>at</b>&nbsp;
				<input name="MktEWFacNum" TYPE="text" size="2" value="##TP_MktEWFacNum##">
				<b>/</b>
				<input name="MktEWFacDen" TYPE="text" size="2" value="##TP_MktEWFacDen##">
					&nbsp;&nbsp;
					<b>Terms with bet:</b>&nbsp;
					<select name="MktEWWithBet" onChange="checkEWWithBet();">
					<script>
					write_select('##TP_MktEWWithBet##','N','No','Y','Yes')
					</script>
					</select>
			##TP_ELSE##
				##TP_IF {[tpGetVar EWAvail 0]}##
					<b>Yes</b>: ##TP_MktEWPlaces## at
					##TP_MktEWFacNum##/##TP_MktEWFacDen## of to-win odds
                    &nbsp;&nbsp;<b>Terms with bet:</b>&nbsp;
                    <script>
                    write_which('##TP_MktEWWithBet##','N','No','Y','Yes')
                    </script>
				##TP_ELSE##
					<b>No</b>
				##TP_ENDIF##
				<input name=MktEWAvail   type=hidden value="##TP_MktEWAvail##">
				<input name=MktEWPlaces  type=hidden value="##TP_MktEWPlaces##">
				<input name=MktEWFacNum  type=hidden value="##TP_MktEWFacNum##">
				<input name=MktEWFacDen  type=hidden value="##TP_MktEWFacDen##">
				<input name=MktEWWithBet type=hidden value="##TP_MktEWWithBet##">
			##TP_ENDIF##
			</td>
		</tr>
		<tr>
			<td class=caption>Place</td>
			<td>
			##TP_IF {![tpGetVar Settled 0]}##
				<select name="MktPLAvail">
				<script>
				write_select('##TP_MktPLAvail##','N','No','Y','Yes')
				</script>
				</select>
			##TP_ELSE##
				<script>
				write_which('##TP_MktPLAvail##','N','No','Y','Yes')
				</script>
				<input type=hidden name=MktPLAvail value="##TP_MktPLAvail##">
			##TP_ENDIF##
			&nbsp;&nbsp; (each-way places and payout fraction must be specified)
			</td>
		</tr>
	##TP_ELSE##
		<!-- ClassSort not HR/GR -->
		<input type="hidden" name="MktLPAvail"   value="Y">
		<input type="hidden" name="MktSPAvail"   value="N">
		<input type="hidden" name="MktPMAvail"   value="N">
		<input type="hidden" name="MktEWAvail"   value="N">
		<input type="hidden" name="MktPLAvail"   value="N">
		<input type="hidden" name="MktEWWithBet" value="N">
		<input type="hidden" name="MktFCAvail"   value="N">
		<input type="hidden" name="MktTCAvail"   value="N">
	##TP_ENDIF##
##TP_ELSE##
	<input type="hidden" name="MktLPAvail"   value="Y">
	<input type="hidden" name="MktSPAvail"   value="N">
	<input type="hidden" name="MktPMAvail"   value="N">
	<input type="hidden" name="MktEWAvail"   value="N">
	<input type="hidden" name="MktEWWithBet" value="N">
	<input type="hidden" name="MktPLAvail"   value="N">
	<input type="hidden" name="MktFCAvail"   value="N">
	<input type="hidden" name="MktTCAvail"   value="N">

	##TP_IF {[string first [tpGetVar MktType] "AHULlM"] >= 0}##
		<!-- handle higher/lower (over/under) markets slightly differently -->
		##TP_IF {[string first [tpGetVar MktType] "AHM"] >= 0}##
			<!-- All handicaps except football over/under -->
			<tr>
				##TP_IF {![tpGetVar BettingOpen 0]}##
					<td class=caption>Handicap result</td>
					<td>
					<b>Home side won by a goal difference of</b>&nbsp;<b>##TP_MktMakeupValue##</b>
					<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
					<input type=hidden name=MktHcapValue   value="##TP_MktHcapValue##">
					<input type=hidden name=MktHcapSide    value="##TP_MktHcapSide##">
					<input type=hidden name=MktHcapStep    value="##TP_MktHcapStep##">
					</td>
				##TP_ELSE##
					<td class=caption>Handicap</td>
					<td>
					##TP_IF {[tpGetVar MktType] == "A"}##
						<select name=MktHcapValue>
						<script>
							write_select('##TP_MktHcapValue##',
								##TP_IF {![OT_CfgGetTrue FUNC_HCAP_SIDE]}##
									                   '-20','-5.0',
									'-19','-4.5/-5.0', '-18','-4.5',
									'-17','-4.0/-4.5', '-16','-4.0',
									'-15','-3.5/-4.0', '-14','-3.5',
									'-13','-3.0/-3.5', '-12','-3.0',
									'-11','-2.5/-3.0', '-10','-2.5',
 									 '-9','-2.0/-2.5',  '-8','-2.0',
 									 '-7','-1.5/-2.0',  '-6','-1.5',
 									 '-5','-1.0/-1.5',  '-4','-1.0',
 									 '-3','-0.5/-1.0',  '-2','-0.5',
					 			 	 '-1','-0.0/-0.5',
								##TP_ENDIF##
					 			 '0','0.0',  '1','0.0/0.5',
					 			 '2','0.5',  '3','0.5/1.0',
					 			 '4','1.0',  '5','1.0/1.5',
					 			 '6','1.5',  '7','1.5/2.0',
					 			 '8','2.0',  '9','2.0/2.5',
								'10','2.5', '11','2.5/3.0',
								'12','3.0', '13','3.0/3.5',
								'14','3.5', '15','3.5/4.0',
								'16','4.0', '17','4.0/4.5',
								'18','4.5', '19','4.5/5.0',
								'20','5.0')
						</script>
						</select>
					##TP_ELSE##
						<input type="text" name="MktHcapValue" size=10 value="##TP_MktHcapValue##">
					##TP_ENDIF##
					##TP_IF {[OT_CfgGetTrue FUNC_HCAP_SIDE]}##
						&nbsp;<b>added to</b>&nbsp;
						<select name="MktHcapSide">
						<script>
						write_select('##TP_MktHcapSide##','H','Home','A','Away')
						</script>
						</select>
						<b>side</b>
					##TP_ELSE##
						<b>(added to home side)</b>
					##TP_ENDIF##
					<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
					##TP_IF {[tpGetVar MktType] == "H"}##
						&nbsp;
						<b>Handicap step:</b>
						<input type=text name=MktHcapStep value="##TP_MktHcapStep##" size=3>
					##TP_ELSE##
						<input type=hidden name=MktHcapStep  value="##TP_MktHcapStep##">
					##TP_ENDIF##
					</td>
				##TP_ENDIF##
			</tr>
		##TP_ELSEIF {[tpGetVar MktType] == "L"}##
			<!-- Special handling for higher/lower market -->
			<tr>
				<td class=caption>Higher/Lower</td>
				<td>
				##TP_IF {[tpGetVar AfterEventStart 0]}##
					##TP_IF {![tpGetVar Settled 0]}##
						<input type=text name=MktMakeupValue value="##TP_MktMakeupValue##" size=4>
						<i>(total number to settle against)</i>
					##TP_ELSE##
						<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
						##TP_MktMakeupValue##
					##TP_ENDIF##
					<input type=hidden name=MktHcapValue value="##TP_MktHcapValue##">
				##TP_ELSE##
					<input type="text"   name="MktHcapValue"   value="##TP_MktHcapValue##" size=10>
					<input type="hidden" name="MktMakeupValue" value="##TP_MktMakeupValue##">
					&nbsp;
					<b>Handicap step:</b>
					<input type=text name=MktHcapStep value="##TP_MktHcapStep##" size=3>
				##TP_ENDIF##
				</td>
			</tr>
		##TP_ELSEIF {[tpGetVar MktType] == "l"}##
			<!-- Special handling for higher/lower market -->
			<tr>
				<td class=caption>Higher/Lower (split)</td>
				<td>
				##TP_IF {[tpGetVar AfterEventStart 0] && ![tpGetVar opAdd 0]}##
					##TP_IF {![tpGetVar Settled 0]}##
						<input type=text name=MktMakeupValue value="##TP_MktMakeupValue##" size=4>
						<i>(total number to settle against)</i>
					##TP_ELSE##
						<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
						##TP_MktMakeupValue##
					##TP_ENDIF##
					<input type=hidden name=MktHcapValue value="##TP_MktHcapValue##">
				##TP_ELSE##
					<input type="text"   name="MktHcapValue"   value="##TP_MktHcapValue##" size=15>
					<input type="hidden" name="MktMakeupValue" value="##TP_MktMakeupValue##">
					<input type="hidden" name="MktHcapStep"    value="##TP_MktHcapStep##">
				##TP_ENDIF##
				</td>
			</tr>
		##TP_ELSEIF {[tpGetVar MktType] == "U"}##
			<!-- Special handling for over/under market -->
			<tr>
				<td class=caption>Total goals</td>
				<td>
				##TP_IF {[tpGetVar AfterEventStart 0]}##
					##TP_IF {![tpGetVar Settled 0]}##
						<input type=text name=MktMakeupValue value="##TP_MktMakeupValue##" size=5>
						<i>(total number to settle against)</i>
					##TP_ELSE##
						<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
						##TP_MktMakeupValue##
					##TP_ENDIF##
					<input type=hidden name=MktHcapValue value="##TP_MktHcapValue##">
				##TP_ELSE##
					<input type="text"   name="MktHcapValue"   value="##TP_MktHcapValue##" size=4 >
					<input type="hidden" name="MktMakeupValue" value="##TP_MktMakeupValue##">
				##TP_ENDIF##
				</td>
			</tr>
		##TP_ENDIF##
		##TP_IF {[string first [tpGetVar MktType] "AHLl"] >= 0}##
			<tr>
				<td class=caption>Prices</td>
				<td>
				<b>Lowest</b>&nbsp;
				<input type=text name="MktAHPrcLo" value="##TP_MktAHPrcLo##" size=5>
				&nbsp;&nbsp;<b>Highest</b>&nbsp;
				<input type=text name="MktAHPrcHi" value="##TP_MktAHPrcHi##" size=5>
				</td>
			</tr>
			<tr>
				<td class=caption>Price Changing</td>
				<td>
				<select name="MktAPCStatus">
				<script type="text/javascript">
					write_select (
						'##TP_MktAPCStatus##',
						'-','No',
						'A','Yes: Active',
						'S','Yes: Inactive'
					)
				</script>
				</select>
				&nbsp;&nbsp;<b>Change by</b>&nbsp;
				<input type=text name="MktAHPrcChngAmt" value="##TP_MktAHPrcChngAmt##" size=5>
				</td>
			</tr>
			<tr>
				<td class=caption>Handicap refund deduction %</td>
				<td>
				<input type="text" name="MktHcapSteal" value="##TP_MktHcapSteal##" size=5>
				</td>
			</tr>
		##TP_ELSE##
			<input type=hidden name="MktHcapSide"     value="H">
			<input type=hidden name="MktAHPrcLo"      value="">
			<input type=hidden name="MktAHPrcHi"      value="">
			<input type=hidden name="MktAHPrcChngAmt" value="">
		##TP_ENDIF##
	##TP_ELSEIF {[tpGetVar MktType]=="S"}##
		<tr>
			<td class=caption>Current Makeup</td>
			##TP_IF {[tpGetVar Confirmed 0]}##
				<td>
				##TP_IF {[tpGetVar Settled 0]}##
				Market settled at:&nbsp;
				##TP_ELSE##
				Makeup confirmed at:&nbsp;
				##TP_ENDIF##
					<input type=hidden name=MktSpreadValue value="##TP_MktSpreadValue##">##TP_MktSpreadValue##
				</td>
			##TP_ELSE##
				<td>
				<input type="text" name="MktSpreadValue" size=10 value="##TP_MktSpreadValue##">
				</td>
			##TP_ENDIF##
		</tr>
		<tr>
			<td class=caption>
			Quoted spread
			</td>
			<td>
				<input size=10 type="text" name="MktSpreadLowerQuote" value="##TP_MktSpreadLowerQuote##">
				Lower quote
				&nbsp;
				<input size=10 type="text" name="MktSpreadUpperQuote" value="##TP_MktSpreadUpperQuote##">
				Upper quote
			</td>
		</tr>
		<tr>
			<td class=caption>Bet cutoff limits</td>
			<td>
				<input size=10 type="text" name="MktSpreadMinCap" value="##TP_MktSpreadMinCap##">
				Lower cutoff
				&nbsp;
				<input size=10 type="text" name="MktSpreadMaxCap" value="##TP_MktSpreadMaxCap##">
				Upper cutoff
				<br>
				<i>
				   (leave blank for no capping)
				</i>
			</td>
		</tr>
		<input type=hidden name="MktHcapSide"     value=H>
		<input type=hidden name="MktAHPrcLo"      value="">
		<input type=hidden name="MktAHPrcHi"      value="">
		<input type=hidden name="MktAHPrcChngAmt" value="">
	##TP_ELSEIF {[tpGetVar MktType]=="C"}##
	##TP_ELSEIF {[tpGetVar MktType]=="N"}##
	##TP_ELSEIF {[tpGetVar MktType]=="M"}##
	##TP_ELSE## <!-- none of -,H,A,S,C,U,L,l,N,M -->
		<tr>
			<td class=caption colspan=2>
			Unexpected ELSE branch in IF
			</td>
		</tr>
	##TP_ENDIF## <!-- MktSort -->
##TP_ENDIF## <!-- Handicap/Spread Bet -->

##TP_IF {[string first [tpGetVar MktType] "SC"] < 0}##
	<!-- Accumulator settings (not for Scorecast or Spread Bet) -->
	##TP_IF {![tpGetVar Settled 0]}##
		<tr>
			<td class=caption>Accumulators</td>
			<td>
			<b>Min:</b>&nbsp;
			<input type=text name=MktAccMin value="##TP_MktAccMin##" size=2>
			&nbsp;&nbsp;&nbsp;<b>Max:</b>&nbsp;
			<input type=text name=MktAccMax value="##TP_MktAccMax##" size=2>
			##TP_IF {[string first XMUL [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
				&nbsp;&nbsp;&nbsp;
				<b>and:</b>
				<select name="MktXmul">
				<script>
					write_select("##TP_MktXmul##",
						"-","Unrestricted",
						"C","This class only",
						"T","This type only")
				</script>
				</select>
			##TP_ENDIF##
			</td>
		</tr>
	##TP_ELSE##
		<input type=hidden name=MktAccMin value="##TP_MktAccMin##">
		<input type=hidden name=MktAccMax value="##TP_MktAccMax##">
	##TP_ENDIF##
##TP_ELSE## <!-- Market type doesn't allow accumulators -->
	<input type=hidden name=MktAccMin value="1">
	<input type=hidden name=MktAccMax value="1">
##TP_ENDIF## <!-- MktSort AH/WH -->
##TP_IF {[string first [tpGetVar MktType] "N"] >= 0}##
		<tr>
			<td class=caption>BIR index</td>
			<td>
			<input type=text name="MktBirIndex" value="##TP_MktBirIndex##" size=4>
			</td>
		</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_BIR_DELAY 0]}##
		<tr>
			<td class=caption>BIR delay</td>
			<td>
			<input type=text name="MktBirDelay" value="##TP_MktBirDelay##" size=4>&nbsp;##TP_IF {[tpGetVar displayBIRHierarchy 0]}## (##TP_BIRHierarchyVal## sec from ##TP_BIRHierarchy##) ##TP_ENDIF##
			<b>BIR</b>
			<select name="MktBetInRun">
				<script>
					write_select('##TP_MktBetInRun##','Y','Yes','N','No')
				</script>
			</select>
            ##TP_IF {[OT_CfgGet FUNC_BIR_MKT_EXPAND 0]}##
			&nbsp;&nbsp;&nbsp;<b>BIR Market Expanded?</b>
            <input type=checkbox name="MktBirExpand" value=1 ##TP_MktBirExpand##>
            ##TP_ENDIF##
			</td>
		</tr>
##TP_ELSE##
		<input type="hidden" name="MktBetInRun" value="##TP_MktBetInRun##">
		<input type="hidden" name="MktBirDelay" value="##TP_MktBirDelay##">
##TP_ENDIF##


##TP_IF {[tpGetVar ClassSort]=="HR"}##
##TP_IF {[OT_CfgGet FUNC_DISPLAY_TEMPLATE_MARKET]}##
		<tr>
		  <td class="caption">Market Display Template</td>
		  <td>
			<select name=SelTemplate>
			##TP_LOOP templ_idx {[tpGetVar NumberTemplates]}##
				<option value="##TP_templ_Id##" ##TP_templ_Selected##> ##TP_templ_Name##</option>
			##TP_ENDLOOP##
			</select>
		  </td>
		</tr>
##TP_ENDIF##
##TP_ENDIF##

##TP_IF {[OT_CfgGetTrue OFFER_MKT_APC]}##
	<!--- XXXXX Needs reworking --->
	<!--- Auto price changing - this is offered for all sports, because all  --->
	<!--- sports can have head-head markets (even racing: horse 1 v horse 2) --->
	<tr>
		<td class-=ra><b>APC</b></td>
		<td>
		<select name="MktAPCStatus">
		<script type="text/javascript">
			write_select (
				'##TP_MktAPCStatus##',
				'-','No',
				'A','Yes: Active',
				'S','Yes: Inactive'
			)
		</script>
		</select>
		&nbsp;&nbsp;
		Margin
		<input type=text name=MktAPCMargin  size=6 value="##TP_MktAPCMargin##">%
		&nbsp;&nbsp;
		Trigger
		<input type=text name=MktAPCTrigger size=10 value="##TP_MktAPCTrigger##">
		##TP_IF {![tpGetVar opAdd 0]}##
		&nbsp;Reset&nbsp;<input type="checkbox" name="MktAPCReset" value="Y">
		##TP_ENDIF##
		&nbsp;
		</td>
	</tr>
##TP_ELSE## <!-- Mkt APC -->
	##TP_IF {[string first [tpGetVar MktType] "AHS"] < 0}##
		<input type="hidden" name="MktAPCStatus"  value="">
	##TP_ENDIF##
	<input type="hidden" name="MktAPCMargin"  value="">
	<input type="hidden" name="MktAPCTrigger" value="">
	<input type="hidden" name="MktAPCReset"   value="">
##TP_ENDIF## <!-- Mkt APC -->

<!-- Market liability limit - trigger automatic selection suspensions -->
##TP_IF {(![tpGetVar Settled 0]) && ([string first [tpGetVar MktType] "AHULlSC"] < 0)}##
	<tr>
		<td class=caption>Liability limit</td>
		<td>
		##TP_IF {[OT_CfgGet DISPLAY_HIERARCHY_STAKE_LIMITS 0] == 1}##
			<input type="hidden" name="MktLiabLimitDefault"  size=10 value="##TP_MktLiabLimit##">
			<input type="text" name="MktLiabLimit"  size=10 value="">##TP_IF {[tpBindGet MktLiabLimit] !=""}##<i>&nbsp;(##TP_MktLiabLimit##)</i>##TP_ENDIF##
		##TP_ELSE##
			<input type="text" name="MktLiabLimit"  size=10 value="##TP_MktLiabLimit##">
		##TP_ENDIF##
		<i>(selection suspends when this limit is reached)</i>
		</td>
	</tr>
##TP_ELSE##
	<input type=hidden name=MktLiabLimit value="##TP_MktLiabLimit##">
##TP_ENDIF##

##TP_IF {[OT_CfgGet FUNC_LAY_TO_LOSE 0]}##
<!-- Lay to lose box -->
	<tr>
		<td class=caption>Lay to lose</td>
		<td>
			<table>
				<tr>
					<td align=right><b>Win LP:</b></td>
					<td><input type=text size=10 name="win_lp" value="##TP_MktWinLP##">
                    ##TP_IF {[tpGetVar WinLPAvail] != 1}##
                    <i>(##TP_TypeWinLP##)</i>
                    <input type=hidden name="t_win_lp" value="##TP_TypeWinLP##">
                    ##TP_ENDIF##</td>
					<td align=right><b>Win SP:</b></td>
					<td><input type=text size=10 name="win_sp" value="##TP_MktWinSP##">
                    ##TP_IF {[tpGetVar WinSPAvail] != 1}##
                    <i>(##TP_TypeWinSP##)</i>
                    <input type=hidden name="t_win_sp" value="##TP_TypeWinSP##">
                    ##TP_ENDIF##</td>
		    ##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
					<td align=right><b>Win EP:</b></td>
					<td><input type=text size=10 name="win_ep" value="##TP_MktWinEP##">
                    	##TP_IF {[tpGetVar WinEPAvail] != 1}##
                    	<i>(##TP_TypeWinEP##)</i>
                    	<input type=hidden name="t_win_ep" value="##TP_TypeWinEP##">
                    	##TP_ENDIF##</td>
		    ##TP_ENDIF##</td>
				</tr>
				<tr>
					<td align=right><b>Place LP:</b></td>
					<td><input type=text size=10 name="place_lp" value="##TP_MktPlaceLP##">
                    ##TP_IF {[tpGetVar PlaceLPAvail] != 1}##
                    <i>(##TP_TypePlaceLP##)</i>
                    <input type=hidden name="t_place_lp" value="##TP_TypePlaceLP##">
                    ##TP_ENDIF##</td></td>
					<td align=right><b>Place SP:</b></td>
					<td><input type=text size=10 name="place_sp" value="##TP_MktPlaceSP##">
                    ##TP_IF {[tpGetVar PlaceSPAvail] != 1}##
                    <i>(##TP_TypePlaceSP##)</i>
                    <input type=hidden name="t_place_sp" value="##TP_TypePlaceSP##">
                    ##TP_ENDIF##</td>
		    ##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
					<td align=right><b>Place EP:</b></td>
					<td><input type=text size=10 name="place_ep" value="##TP_MktPlaceEP##">
                    	##TP_IF {[tpGetVar PlaceEPAvail] != 1}##
                    	<i>(##TP_TypePlaceEP##)</i>
                    	<input type=hidden name="t_place_ep" value="##TP_TypePlaceEP##">
                    	##TP_ENDIF##</td>
		    ##TP_ENDIF##</td>
					<td><input type=button value="Generate/Update" onClick="return fs(this,'LaytoLose')"></td>
				</tr>
				<tr>
					<td align=right><b>Least Max Bet:</b></td>
					<td><input type=text size=10 name="InfMB" value="##TP_MktLeastMaxBet##">
                    ##TP_IF {[tpGetVar least_max_betAvail] != 1}##
                    <i>(0.00)</i>
                    ##TP_ENDIF##</td>
					<td align=right><b>Most Max Bet:</b></td>
					<td><input type=text size=10 name="SupMB" value="##TP_MktMostMaxBet##">
                    ##TP_IF {[tpGetVar most_max_betAvail] != 1}##
                    <i>(##TP_TypeMostMaxBet##)</i>
                    ##TP_ENDIF##</td>
				</tr>
			</table>
		</td>
	</tr>

	<tr>
	</tr>
##TP_ENDIF##

<!-- For horse racing only, provide ability to enter Rule 4 deductions -->
##TP_IF {![tpGetVar opAdd 0]}##
	##TP_IF {[lsearch [split [OT_CfgGet RULE4_CLASS_LIST HR] "|"] [tpGetVar ClassSort]]>= 0 && [tpGetVar MktType]=="-"}##
		<tr>
			<td class=caption>Rule 4</td>
			<td>
			&nbsp;&nbsp;&nbsp;
			<b>
			<input type=button class="btn_def" value="Edit Rule 4 Deductions" onClick="return fs(this,'EditRule4')">
			</b>
			</td>
		</tr>
	##TP_ENDIF## <!-- ClassSort==HR -->
	<!-- For Forecast/Tricast markets, allow entry of dividends -->
	##TP_IF {[tpGetVar FCorTC 0]}##
		<tr>
			<td class=caption>Dividends</td>
			<td>
			&nbsp;&nbsp;&nbsp;
			<b>
			<input type=button class="btn_def" value="Edit Dividends" onClick="return fs(this,'EditDivs')">
			</b>
			</td>
		</tr>
	##TP_ENDIF## <!-- FC/TC -->
	<input type="hidden" name="EvDesc"  value="##TP_EvDesc##">
	<input type="hidden" name="MktDesc" value="##TP_MktDesc##">
##TP_ENDIF## <!-- !opAdd -->

	<tr>
		<td class=caption>Betting</td>
		<td>
		<font color=#006666><i>Min Bet</i></font>
		<input name=MktMinBet type=text size=12 value="##TP_MktMinBet##">
		##TP_IF {[OT_CfgGet DISPLAY_HIERARCHY_STAKE_LIMITS 0] == 1}##
			<i>&nbsp;(##TP_EvMinBet##)</i>
		##TP_ENDIF##
		&nbsp;&nbsp;&nbsp;
		<font color=#006666><i>##TP_IF {[OT_CfgGet FUNC_VARIABLE_MAX_STAKES_BY_TIME 0] && ([lsearch [OT_CfgGet VAR_MAX_STAKE_CLASSES ""] [tpGetVar ClassId]] != -1)}##Standard ##TP_ENDIF##Max Bet</i></font>
		<input name=MktMaxBet type=text size=12 value="##TP_MktMaxBet##">
		##TP_IF {[OT_CfgGet DISPLAY_HIERARCHY_STAKE_LIMITS 0] == 1}##
			<i>&nbsp;(##TP_EvMaxBet##)</i>
		##TP_ENDIF##
		##TP_IF {[OT_CfgGet FUNC_MAX_WIN_MULTIPLES 0]}##
			<br />
			<font color=#006666><i>Max Multiple Bet</i></font>
			<input name="MktMaxMultipleBet" type="text" size=12 value="##TP_MktMaxMultipleBet##"><i>&nbsp;(##TP_FinalMaxMultipleBet##)</i>
		##TP_ELSE##
			<input name="MktMaxMultipleBet" type="hidden" value="##TP_MktMaxMultipleBet##">
		##TP_ENDIF##
		##TP_IF {[string first CUTOFF [OT_CfgGet FUNC_EVENT_FIELDS ""]] >= 0}##
			&nbsp;&nbsp;&nbsp;
			<font color=#006666><i>Bet Cutoff</i></font>
			<input name=MktBetCutoff type=text size=10 value="##TP_MktBetCutoff##">
			(hh:mm:ss)
		##TP_ENDIF##
		##TP_IF {[OT_CfgGet FUNC_VARIABLE_MAX_STAKES 0] && ([lsearch [OT_CfgGet VAR_MAX_STAKE_CLASSES ""] [tpGetVar ClassId]] != -1)}##
			<br />
			<font color=#006666><i>##TP_IF {[OT_CfgGet FUNC_VARIABLE_MAX_STAKES_BY_TIME 0]}##Standard ##TP_ENDIF##SP Max Bet</i></font>
			<input name="MktSPMaxBet" type="text" size="12" value="##TP_MktSPMaxBet##" />
			<br />
	    	##TP_IF {[OT_CfgGet FUNC_VARIABLE_MAX_STAKES_BY_TIME 0]}##
 			   	NB: MAX STAKES FOR THIS EVENT WILL VARY ACCORDING TO TIME AND PRICE
		    	<br />
	    	##TP_ENDIF##
	    ##TP_ELSE##
			<input type="hidden" name="MktSPMaxBet" value="##TP_MktSPMaxBet##" />
		##TP_ENDIF##
		</td>
	</tr>
	##TP_IF {[OT_CfgGet EW_FACTOR 0]}##
	##TP_IF {[tpGetVar ClassSort] == "HR" || [tpGetVar ClassSort] == "GR"}##
	<tr>
		<td class=caption>E/W Factor</td>
		<td>
			 <input name=MktEachWayFactor type=text size=12 value="##TP_MktEachWayFactor##">
		</td>
	</tr>
	##TP_ENDIF##
	##TP_ELSE##
	<input name="MktEachWayFactor" type="hidden" value="##TP_MktEachWayFactor##" />
	##TP_ENDIF##
	##TP_IF {[OT_CfgGet FUNC_MAX_WIN 0]}##
	<tr>
		<td class=caption/>
		<td>
			<font color=#006666><i>Max Potential Win</i></font>
			<input name=MktMaxPotWin type=text size=12 value="##TP_MktMaxPotWin##">
		</td>
	</tr>
	##TP_ELSE##
	  <input name="MktMaxPotWin" type="hidden" value="##TP_MktMaxPotWin##" />
	##TP_ENDIF##

##TP_IF {[string first BLURB [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
	<tr>
		<td align=right class=caption>
		Market blurb
		</td>
		<td>
		<textarea cols=60 rows=6 wrap=virtual name="MktBlurb">##TP_MktBlurb##</textarea><br>
		<i>(Only 250 characters are stored)</i>
		<br/>
		<a href='javascript:blurb_popup("##TP_MktId##", "EV_MKT")'>edit multi-lingual text</a>
		<span class="multiLingualMsg">(multi-lingual text will take precedence over the default text)</span>
		</td>
	</tr>
##TP_ENDIF##

##TP_IF {[string first ANTEPOST [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
<tr>
   <td class=caption>Antepost</td>
   <td>
    <select name="MktIsApMkt">
		<script>
		write_select('##TP_MktIsApMkt##','N','No','Y','Yes')
		</script>
	</select>
   </td>
</tr>
##TP_ELSE##
	<input type=hidden name=MktIsApMkt value="##TP_MktIsApMkt##">
##TP_ENDIF##

##TP_IF {[string first [tpGetVar ClassSort] "HR/GR"] >= 0 &&
         [string first EP_ACTIVE [OT_CfgGet FUNC_MKT_FIELDS ""]] >= 0}##
<tr>
	<td class=caption>Early Prices</td>
	<td>
	##TP_IF {![tpGetVar Settled 0]}##
		<select name="MktEPActive">
		<script>
		write_select('##TP_MktEPActive##','N','No','Y','Yes')
		</script>
		</select>
		<i>(only applies to bets placed at live price)</i>
	##TP_ELSE##
		<script>
		write_which('##TP_MktEPActive##','Y','Yes','N','No')
		</script>
		<input type=hidden name=MktEPActive value="##TP_MktEPActive##">
	##TP_ENDIF##
	</td>
</tr>
##TP_ELSE##
	<input type=hidden name=MktEPActive value="##TP_MktEPActive##">
##TP_ENDIF##
	<tr>
		<td class="caption">Market Stake Factor</td>
		<td >
			##TP_IF {[tpGetVar opAdd 0]}##
				<input type="text" name="MktStkFactor" size="5" maxlength="5" value="1.0">
			##TP_ELSE##
				<input type="text" name="MktStkFactor" size="5" maxlength="5" value="##TP_MktStkFactor##">
			##TP_ENDIF##

		</td>
	</tr>
##TP_IF {[OT_CfgGet FUNC_FCTC_STK_LIMITS 0]}##
    <tr>
	    <td class="caption">Forecast Stake Factor</td>
		<td><input type=text size=4 name=fc_stk_factor value="##TP_FcStkFactor##">
        ##TP_IF {[tpGetVar fcStkFactorAvail] != 1}##
        <i>(##TP_ClassFcStkFactor##)</i>
        ##TP_ENDIF##
	    &nbsp;&nbsp;&nbsp;<b>Minimum Forecast Stake Limit</b>
		<input type=text size=8 name=fc_min_stk value="##TP_FcMinStk##">
        ##TP_IF {[tpGetVar fcMinStkAvail] != 1}##
        <i>(##TP_ClassFcMinStk##)</i>
        ##TP_ENDIF##</td>
	</tr>
	<tr>
	    <td class="caption">Tricast Stake Factor</td>
		<td><input type=text size=4 name=tc_stk_factor value="##TP_TcStkFactor##">
        ##TP_IF {[tpGetVar tcStkFactorAvail] != 1}##
        <i>(##TP_ClassTcStkFactor##)</i>
        ##TP_ENDIF##
	    &nbsp;&nbsp;&nbsp;<b>Minimum Tricast Stake Limit</b>
		<input type=text size=4 name=tc_min_stk value="##TP_TcMinStk##">
        ##TP_IF {[tpGetVar fcMinStkAvail] != 1}##
        <i>(##TP_ClassTcMinStk##)</i>
        ##TP_ENDIF##</td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_DBL_RES 0] && [tpGetVar MktSort] != "CW"}##
	<tr>
		<td class=caption>Double Result</td>
		<td>
			##TP_IF {[op_allowed UpdDblRes]}##
				<select name="MktDblRes">
					<script>
						write_select('##TP_MktDblRes##',
							'N','No',
							'Y','Yes');
					</script>
				</select>
			##TP_ELSE##
				<script>
					write_which('##TP_MktDblRes##','Y','Yes','N','No','','No');
				</script>
			##TP_ENDIF##
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {![tpGetVar Settled   0] && [OT_CfgGet FUNC_AUTO_DH 0]}##
<tr>
	<td class=caption>
		<b>Auto Calculate Dead Heat Reductions?</b>
	</td>
	<td>
		<select name="MktAutoDHRedn">
		<script type="text/javascript">
			write_select('##TP_MktAutoDHRedn##','N','No','Y','Yes')
		</script>
		</select>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
	<tr>
		<td class=caption>Channels</td>
		<td align=left valign=center class="table">
		##TP_PLAY chan_sel.html##
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_MBS 0]}##
<tr>
	<td class="caption">&nbsp;Money Back Special?</td>
	<td>
		<input type="checkbox" name="MBSmkt" value="1" ##TP_IF {[tpBindGet MBSmkt]=="1"} ##checked##TP_ENDIF##>
	</td>

</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_MARKET_FLAGS 0]}##
	##TP_IF {[tpGetVar NumMktFlags 0]>0}##
	<tr>
		<td class=caption>Miscellaneous Flags</td>
		<td class="table">
		<table cellspacing=0 cellpadding=0 border=0>
			##TP_LOOP mkt_flag_idx {[expr {4*(([tpGetVar NumMktFlags]+3)/4)}]}##
			##TP_IF {[tpGetVar mkt_flag_idx] % 4 == 0}##
			<tr>
			##TP_ENDIF##

			##TP_IF {[tpGetVar mkt_flag_idx] < [tpGetVar NumMktFlags]}##
				<td>
				<input type=checkbox name="market_flag_##TP_market_flag_code##" ##TP_market_flag_selected##>
				##TP_market_flag_name##
				</td>
			##TP_ELSE##
				<td>&nbsp;</td>
			##TP_ENDIF##

			##TP_IF {([tpGetVar mkt_flag_idx]+1) % 4 == 0}##
			</tr>
			##TP_ENDIF##
			##TP_ENDLOOP##
		</table>
	</tr>
	##TP_ENDIF##
##TP_ENDIF##

##TP_IF {![tpGetVar opAdd 0] && [OT_CfgGet BF_ACTIVE 0]}##
	##TP_TCL {tpSetVar BfMoni 1}##
	##TP_PLAY bf_market.html##
##TP_ENDIF##

##TP_IF {[OT_CfgGet FUNC_TRAD_GUIDS 0]}##
	<tr>
		<td class="caption">Request GUID</td>
		##TP_IF {[tpBindGet ReqGUID] != ""}##
		<td>##TP_ReqGUID##</td>
		##TP_ELSE##
		<td>N/A</td>
		##TP_ENDIF##
	</tr>
##TP_ENDIF##

<tr>
	<th class=buttons colspan=2>
	<table border=0 cellspacing=0 cellpadding=0 width=100%>
	<tr>
		<input type="hidden" name="TypeId" value="##TP_TypeId##">
		<input type="hidden" name="EvId"   value="##TP_EvId##">
		<input type="hidden" name="MktId"  value="##TP_MktId##">
		<th width=65% class=buttons>
		##TP_IF {[op_allowed ManageEvMkt]}##
			##TP_IF {[tpGetVar opAdd 0]}##
				##TP_IF {[tpGetVar AllowDDCreation 0]}##
				<input type=button class="btn_def" value="Add Market" onClick="return fs(this,'MktAdd')">
				##TP_ENDIF##
			##TP_ELSE##
				<input type=button class="btn_def" name="mod_mkt" value="Modify Market" onClick="return fs(this,'MktMod')">
				##TP_IF {[tpGetVar AllowDDCreation 0]}##
				<input type=button class="btn_def" value="Copy Market" onClick="return promptCloneMarket(this,'MktClone')">
				##TP_ENDIF##
				##TP_IF {[tpGetVar AllowDDDeletion 0]}##
				<input type=button class="btn_def" name="del_mkt" value="Delete Market" onClick="return fs(this,'MktDel')">
				##TP_ENDIF##
				<input type=hidden name="newMktName" value="">
				##TP_IF {[string first [tpGetVar MktType] "AHLl"] >= 0}##
					<input type=button class="btn_def" value="View APC Log" onClick="return fs(this,'MktAHApcLog')">
				##TP_ENDIF##
				##TP_IF {![tpGetVar Settled 0] && [OT_CfgGet DBV_URL ""]!=""}##
						##TP_IF {[tpGetVar PERM_ViewDBVLiab 0]}##
							<input type=button class="btn_def" value="Liabilities" onClick="return fs(this,'DBV')">
						##TP_ENDIF##
				##TP_ENDIF##
			##TP_ENDIF##
		##TP_ENDIF##

		<input type=hidden name=ClassId     value="##TP_ClassId##">
		<input type=hidden name=type_id     value="##TP_type_id##">
		<input type=hidden name=date_range  value="##TP_date_range##">
		<input type=hidden name=date_lo     value="##TP_date_lo##">
		<input type=hidden name=date_hi     value="##TP_date_hi##">
		<input type=hidden name=settled     value="##TP_settled##">
		<input type=hidden name=result_conf value="##TP_result_conf##">
		<input type=hidden name=status      value="##TP_status##">
		<input type=hidden name=allow_stl   value="##TP_allow_stl##">

		<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
		<input type=button class="btn_def" value="Refresh" onClick="return fs(this,'Refresh')">

		</th>
		##TP_IF {![tpGetVar opAdd 0]}##
			##TP_IF {[tpGetVar PERM_ViewAudit 0]}##
				<th class=goaudit width=40%>
				##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
					<input type=button class="btn_def" value="View Betfair Audit History" onClick="return fs(this,'GoBFAudit')">
				##TP_ENDIF##
				<input type=button class="btn_def" value="View Audit History" onClick="return fs(this,'GoAudit')">
				<input type=hidden name=AuditInfo value="EvMkt">
				</th>
			##TP_ENDIF##
		##TP_ENDIF##
	</tr>
	</table>
	</th>
</tr>

##TP_IF {[tpGetVar OfferAutoGen 0]}##
	##TP_IF {[op_allowed ManageEvMkt]}##
		<tr class=blank>
			<td colspan=2>&nbsp;</td>
		</tr>
		<tr>
			##TP_IF {[tpGetVar AutoGenOK 0]}##
				<th class=buttons colspan=2>
				<select name="autogen_mkt_id">
					##TP_LOOP auto_idx { [tpGetVar NumWDWMkt]}##
					<option value="##TP_AutoGenMktId##">##TP_AutoGenMktName##</option>
					##TP_ENDLOOP##
				</select>
				<input type=button class="btn_def" value="Auto-Generate Selections" onClick="return fs(this,'MktAutoGen')">
				##TP_IF {[tpGetVar MktSort] == "QR"}##
					Favourite
					<select name="Fave">
						<script>write_select('H','H','Home','A','Away')</script>
					</select>
				##TP_ENDIF##
				</th>
			##TP_ELSE##
				<th align=center colspan=2>
				<font color=darkorange>
				Selections in this market can be auto-generated,<br>
				but you must set up a match result (Win/Draw/Win)<br>
				market with three priced selections, and set the
				event domain (domestic/international/...) first.<b>
				</font>
				</th>
			##TP_ENDIF##
		</tr>
	##TP_ENDIF##
##TP_ENDIF## <!-- OfferAutoGen -->

##TP_IF {[tpGetVar OfferCascade 0]==1}##
	##TP_IF {[op_allowed UpdAutoGenEvOcPrices] && [op_allowed UpdEvOcPrice]}##
		<tr class=blank>
			<td colspan=2>&nbsp;</td>
		</tr>
		<tr>
			<th class=buttons colspan=2>
				<input type=button class="btn_def" value="Cascade Prices" onClick="return fs(this,'MktCascadeWDW')">
			</th>
		</tr>
	##TP_ENDIF##
##TP_ENDIF##

##TP_IF {([tpGetVar AfterEventStart 0] && ![tpGetVar opAdd 0]) || (([tpGetVar NumSelnsNoRslt 0] == 0) && ([tpGetVar NumSelns] > 0))}##
	<tr class=blank>
		<td colspan=2>&nbsp;</td>
	</tr>
	##TP_IF {[tpGetVar Settled 0]}##
		<tr class=settled>
			<th colspan=2 align=left>
			<font color=white>
			This market has been settled
			</font>
			</th>
		</tr>
		##TP_IF {[OT_CfgGet FUNC_STL_CHK 0] && [op_allowed SettleCheck]}##
		<tr>
		    <th class=title colspan=2>
					  <input type=button class="btn_def" value="Mark Market for Settle Check" onClick="return fs(this,'MktSettleChk')">
			</th>
		</tr>
		##TP_ENDIF##

        ##TP_IF {[op_allowed ReSettle]}##
			##TP_IF {[tpGetVar EvAllowSettle]=="Y"} ##
				<tr>
				   <th class=title colspan=2>
				##TP_IF {[tpGetVar MktType] != "S"}##
					  <input type=button class="btn_def" value="Re-Settle Market" onClick="return fs(this,'MktReStl')">
				##TP_ELSE##
					  <input type=button class="btn_def" value="Re-Settle Spread Market" onClick="return fs(this,'MktReStlSpread')">
				##TP_ENDIF##
					  <input type=hidden name=DoSettle value=Y>
				   </th>
				</tr>
			##TP_ENDIF##
		##TP_ENDIF##
	##TP_ELSE##
		<tr>
			<th class=buttons colspan=2>
			##TP_IF {![tpGetVar Confirmed 0]}##
				##TP_IF {[op_allowed ConfirmResults]}##
					##TP_IF {[tpGetVar NumSelnsNoRslt 0] == 0}##
						<input type=button class="btn_def" value="Confirm Results" onClick="return fs(this,'MktConf')">
						<input type=hidden name="AllSelnsVoid" value=##TP_AllSelnsVoid##>
					##TP_ELSE##
						##TP_NumSelnsNoRslt## selections with no result
						##TP_IF {[op_allowed PoolVoidAll] && [tpGetVar VoidSelectionsButton 0]}##
							<input type=button class="btn_def" value="Void All Selections" onClick="return fs(this,'MktVoidAllSel')">
						##TP_ENDIF##
					##TP_ENDIF##
				##TP_ELSE##
					<i>Results are not confirmed</i>
				##TP_ENDIF##
			##TP_ELSE##
				##TP_IF {![op_allowed Settle ConfirmResults]}##
					<i>Market is not settled</i>
				##TP_ELSE##
					##TP_IF {[op_allowed Settle]}##
						##TP_IF {[tpGetVar EvAllowSettle]=="Y"} ##
							##TP_IF {[tpGetVar MktType] != "S"}##
								<input type=button class="btn_def" value="Settle Market" onClick="return fs(this,'MktStl')">
							##TP_ELSE##
								<input type=button class="btn_def" value="Settle Spread Market" onClick="return fs(this,'MktStlSpread')">
							##TP_ENDIF##
							<input type=hidden name=DoSettle value=Y>
						##TP_ENDIF##
					##TP_ENDIF##
					##TP_IF {[op_allowed ConfirmResults]}##
						<input type=button class="btn_def" value="Unconfirm Results" onClick="return fs(this,'MktUnconf')">
					##TP_ENDIF##
				##TP_ENDIF##
			##TP_ENDIF##
			</th>
		</tr>
	##TP_ENDIF## <!-- Settled -->
##TP_ENDIF## <!-- AfterEventStart -->

</table>
##TP_IF {[tpGetVar ShowPriceSet "N"] == "Y"}##
<table cellpadding=2 cellspacing=1 border=0>
        <tr>
            <th class=infono colspan=3>
            Please check that the appropriate show prices are set.
            </th>
        </tr>
        <br>
</table>
##TP_ENDIF##

<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::MARKET::DoMkt>

<!-- For A/H/L type markets, detail the state of the APC mechanism -->

##TP_IF {[tpGetVar NumSelns 0]>0}##
	##TP_IF {[string first [tpGetVar MktType] "AHLl"] >= 0}##
		<table border=0 cellspacing=1 cellpadding=1>
		<tr>
			<th class=title colspan=5>APC Status</th>
		</tr>
		<tr>
			<th class=colhead>Selection</th>
			<th class=colhead>Stake</th>
			<th class=colhead>Bets</th>
			<th class=colhead>Payout</th>
			<th class=colhead>Trigger</th>
		</tr>
		##TP_LOOP seln_idx {[tpGetVar NumSelns]}##
			<tr>
				<td><a href="##TP_CGI_URL##?action=ADMIN::SELN::GoOc&OcId=##TP_OcId##&ClassId=##TP_ClassId##&type_id=##TP_type_id##&date_range=##TP_date_range##&date_lo=##TP_date_lo##&date_hi=##TP_date_hi##&settled=##TP_settled##&result_conf=##TP_result_conf##&status=##TP_status##&allow_stl=##TP_allow_stl##">##TP_OcDesc##</a></td>
				<td class=ra>##TP_OcZLPWinStake##</td>
				<td class=ra>##TP_OcZLPBetCount##</td>
				<td class=ra>##TP_OcZLPWinLiab##</td>
				<td class=ra>##TP_OcZMaxTotal##&nbsp;</td>
			</tr>
		##TP_ENDLOOP##
		<tr>
			<td>&nbsp;</td>
			<td class=ra><b>##TP_MktLPWinStake##</b></td>
			<td class=ra><b>##TP_MktLPBetCount##</b></td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		</table>
		<br>
	##TP_ENDIF##
##TP_ENDIF##

<!-- List of Selections -->
##TP_IF {![tpGetVar opAdd 0]}##
	<table border=0 cellspacing=1 cellpadding=1>
	<tr>
		<th class=title colspan=##TP_SelColSpan##>
			Market Selections
		</th>
	</tr>
</form>
	##TP_IF {[tpGetVar MktType]!="C" && [tpGetVar MktType]!="S"}##
		<form name="GoAddEvOc" method=get action="##TP_CGI_URL##" >
		##TP_IF {[tpGetVar NumSelns 0]>0}##
			<tr>
				<th class=colhead>Selection</th>
				<th class=colhead>Display</th>
				<th class=colhead>Status</th>
				<th class=colhead>Pricing</th>
				##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_SHOW_PRICES 0] && [op_allowed BFPrices]}##
					##TP_TCL {tpSetVar ColNam 1}##
					##TP_PLAY bf_market.html##
				##TP_ENDIF##
				##TP_IF {[tpGetVar MktCanPlace 1]}##
				<th class=colhead>Place</th>
				##TP_ENDIF##
				<th class=colhead>Min Bet</th>
				<th class=colhead>Max Bet(LP)</th>
				<th class=colhead>Max Bet(SP)</th>
				##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
				<th class=colhead>Max Bet(EP)</th>
				##TP_ENDIF##
				<th class=colhead>Max Place(LP)</th>
				<th class=colhead>Max Place(SP)</th>
				##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
				<th class=colhead>Max Place(EP)</th>
				##TP_ENDIF##
				<th class=colhead>Result</th>
				##TP_IF {[tpBindGet MktDblRes] == "Y"}##
					<th class=colhead>Double Resulting</th>
				##TP_ENDIF##
				<td class=colhead>DH Win</td>
				<td class=colhead>DH Place</td>
				<th class=colhead>Confirmed</th>
				<th class=colhead>Settled</th>
				##TP_IF {[string first [tpGetVar ClassSort] "HR/GR"] >= 0 && [tpGetVar MktType] == "-"}##
					<th class=colhead>1st Show Set</th>
					<th class=colhead>2nd Show Set</th>
				##TP_ENDIF##
				##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_ALLOW_BETTING 0] && [op_allowed BFOrder]}##
					##TP_TCL {tpSetVar ColNamOrd 1}##
					##TP_PLAY bf_market.html##
				##TP_ENDIF##
			</tr>
			##TP_LOOP seln_idx {[tpGetVar NumSelns]}##
				<script>
					write_oc_tr("##TP_OcSettled##","##TP_OcResultConf##","##TP_OcResult##","##TP_OcStatus##","##TP_OcDisplayed##");
				</script>
					<td><a href="##TP_CGI_URL##?action=ADMIN::SELN::GoOc&OcId=##TP_OcId##&OcMktId=##TP_MktId##&ClassId=##TP_ClassId##&type_id=##TP_type_id##&date_range=##TP_date_range##&date_lo=##TP_date_lo##&date_hi=##TP_date_hi##&settled=##TP_settled##&result_conf=##TP_result_conf##&status=##TP_status##&allow_stl=##TP_allow_stl##">##TP_OcDesc##</a></td>
					<td>##TP_OcDisplayed##:##TP_OcDisporder##</td>
					<td>##TP_OcStatus##</td>
					<td>
					<script>
						write_oc_price(
							"##TP_MktLPAvail##",
							"##TP_MktSPAvail##",
							"##TP_OcResult##",
							"##TP_OcLP##",
							"##TP_OcSP##");
					</script>
					##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_SHOW_PRICES 0] && [op_allowed BFPrices]}##
						##TP_TCL {tpSetVar BfMktDep 1}##
						##TP_PLAY bf_market.html##
					##TP_ENDIF##
					</td>
					##TP_IF {[tpGetVar MktCanPlace 1]}##
					<td>##TP_OcLPL##&nbsp;</td>
					##TP_ENDIF##
					<td>##TP_OcMinBet##&nbsp;</td>
					<td>##TP_OcMaxBet##&nbsp;</td>
					<td>##TP_OcSpMaxBet##&nbsp;</td>
					##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
					<td>##TP_OcEpMaxBet##&nbsp;</td>
					##TP_ENDIF##
					<td>##TP_OcMaxPlaceLP##&nbsp;</td>
					<td>##TP_OcMaxPlaceSP##&nbsp;</td>
					##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpGetVar Category]] != -1}##
					<td>##TP_OcMaxPlaceEP##&nbsp;</td>
					##TP_ENDIF##
					<td>
					<script>
						write_oc_result("##TP_MktType##",
							"##TP_OcResult##","##TP_OcHcapScore##","##TP_OcPlace##",
							"##TP_OcWinDhRedNum##","##TP_OcWinDhRedDen##",
							"##TP_OcPlDhRedNum##","##TP_OcPlDhRedDen##")
					</script>
					</td>
					##TP_IF {[tpBindGet MktDblRes] == "Y"}##
						<td>##TP_OcDblResDesc##</td>
					##TP_ENDIF##
					<td>##TP_OcWinDHRed##&nbsp;</td>
					<td>##TP_OcPlDHRed##&nbsp;</td>
					<td>##TP_OcResultConf##</td>
					<td>##TP_OcSettled##</td>
					##TP_IF {[string first [tpGetVar ClassSort] "HR/GR"] >= 0 && [tpGetVar MktType] == "-"}##
						<td>##TP_FSPriceSet##&nbsp;</td>
						<td>##TP_SSPriceSet##&nbsp;</td>
					##TP_ENDIF##
					##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_ALLOW_BETTING 0] && [op_allowed BFOrder]}##
						##TP_TCL {tpSetVar BtnOrd 1}##
						##TP_PLAY bf_market.html##
					##TP_ENDIF##
				</tr>
				##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_ALLOW_BETTING 0] && [op_allowed BFOrder]}##
					<tr>
						##TP_TCL {tpSetVar OrdDet 1}##
						##TP_PLAY bf_market.html##
					</tr>
				##TP_ENDIF##

			##TP_ENDLOOP## <!-- seln_idx -->
			<tr>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td class=ra><b>##TP_MktMargin##%</b></td>
				##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_SHOW_PRICES 0] && [op_allowed BFPrices]}##
					##TP_TCL {tpSetVar BfMktMap 1}##
					##TP_PLAY bf_market.html##
				##TP_ENDIF##
				##TP_IF {[tpGetVar MktCanPlace 1]}##
				<td class=ra><b>##TP_MktPlaceMargin##%</b></td>
				##TP_ENDIF##
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				##TP_IF {[string first [tpGetVar ClassSort] "HR/GR"] >= 0 && [tpGetVar MktType] == "-"}##
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				##TP_ENDIF##
				##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_ALLOW_BETTING 0] && [op_allowed BFOrder]}##
					##TP_TCL {tpSetVar Ord 1}##
					##TP_PLAY bf_market.html##
				##TP_ENDIF##
			</tr>
		##TP_ELSE## <!-- NumSelns > 0 -->
			<tr>
				<td colspan=##TP_SelColSpan##>
				<I>There are no selections specified for this market.</I>
				</td>
			</tr>
		##TP_ENDIF## <!-- NumSelns > 0 -->

		##TP_IF {[tpGetVar BettingOpen 0]}##
			##TP_IF {![tpGetVar Confirmed 0] && ![tpGetVar Settled 0]}##
				##TP_IF {[op_allowed ManageEvOc]}##
					<tr>
						<th colspan=##TP_SelColSpan## class=buttons>
						<input type="hidden" name="EvId"  value="##TP_EvId##">
						<input type="hidden" name="MktId" value="##TP_MktId##">
						<font color=white>
						##TP_IF {[tpGetVar AllowDDCreation 0]}##
						<input type=button class="btn_def" value="Add Market Selection"  onClick="return fs(this,'MktAddSeln')">
						##TP_ENDIF##
						##TP_IF {[tpGetVar NumSelns 0]>0}##
							&nbsp;&nbsp;&nbsp;
							<input type=button class="btn_def" value="Update Market Selections" onClick="return fs(this,'MktUpdSelns')">
						##TP_ENDIF##
						##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
							##TP_TCL {tpSetVar BtnBFLiq 1}##
							##TP_IF {[OT_CfgGet BF_SELN_APC 0] && [op_allowed BFAutoPriceChange]}##
								##TP_TCL {tpSetVar BtnOCAPC 1}##
							##TP_ENDIF##
							##TP_IF {([OT_CfgGet BF_SELN_REDUCE_RISK 0] || [OT_CfgGet BF_SELN_AUTO_LAY 0]) && [op_allowed BFAutoLayBack]}##
								##TP_TCL {tpSetVar BtnOCAuto 1}##
							##TP_ENDIF##
							##TP_PLAY bf_market.html##
						##TP_ENDIF##
						</font>
						</th>
					</tr>
				##TP_ENDIF##
			##TP_ELSE##
				<tr>
					<th colspan=##TP_SelColSpan## class=buttons>
					<input type="hidden" name="EvId"  value="##TP_EvId##">
					<input type="hidden" name="MktId" value="##TP_MktId##">
					<font color=white>
					##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
						##TP_TCL {tpSetVar BtnBFLiq 1}##
						##TP_IF {[OT_CfgGet BF_SELN_APC 0] && [op_allowed BFAutoPriceChange]}##
							##TP_TCL {tpSetVar BtnOCAPC 1}##
						##TP_ENDIF##
						##TP_IF {([OT_CfgGet BF_SELN_REDUCE_RISK 0] || [OT_CfgGet BF_SELN_AUTO_LAY 0]) && [op_allowed BFAutoLayBack]}##
							##TP_TCL {tpSetVar BtnOCAuto 1}##
						##TP_ENDIF##
						##TP_PLAY bf_market.html##
					##TP_ENDIF##
					</font>
					</th>
				</tr>
			##TP_ENDIF## <!-- !Confirmed && !Settled -->
		##TP_ENDIF## <!-- !AfterEventStart -->
		<input type=hidden name=OcMktId value="##TP_MktId##">
		<input type=hidden name=SubmitName value="">
		<input type=hidden name=action value=ADMIN::SELN::GoOc>
		</form>
	##TP_ELSEIF {[tpGetVar MktType]=="C"}##
		<tr class=infoyes>
			<th align=left colspan=##TP_SelColSpan##>
			This is a correct score & first scorer market.<br>
			Selections are auto-generated when the market is displayed.
			</th>
		</tr>
	##TP_ELSEIF {[tpGetVar MktType]=="S"}##
		<tr class=infoyes>
			<th align=left colspan=##TP_SelColSpan##>
			This is a spread betting market.<br>
			Spread bet markets do not contain any selections.
			</th>
		</tr>
	##TP_ENDIF## <!-- MKtSort != SC -->

	##TP_IF {[tpGetVar NumSelns 0]>0}##
		##TP_IF {[tpGetVar AfterEventStart 0]}##
			##TP_IF {![tpGetVar Settled 0] && ![tpGetVar Confirmed 0]}##
				##TP_IF {[op_allowed SetResults]}##
					<form action="##TP_CGI_URL##" method=get >
					<input type="hidden" name="EvId"  value="##TP_EvId##">
					<input type="hidden" name="MktId" value="##TP_MktId##">
					<tr class=suspended>
						<th align=left colspan=##TP_SelColSpan##>
						<font color=black>
						<input type=button class="btn_def" value="Set Market Results" onClick="return fs(this,'MktSetRes')">
						</font>
						</th>
					</tr>
					<input type=hidden name=SubmitName value="">
					<input type="hidden" name="action" VALUE="ADMIN::SELN::GoOcsRes">
					</form>
				##TP_ENDIF##
            ##TP_ENDIF##
			##TP_IF {([tpGetVar Settled] || [tpGetVar Confirmed 0]) && [tpGetVar MktType] == "N"}##
					<form action="##TP_CGI_URL##" method=get >
					<input type="hidden" name="EvId"  value="##TP_EvId##">
					<input type="hidden" name="MktId" value="##TP_MktId##">
					<tr class=suspended>
						<th align=left colspan=##TP_SelColSpan##>
						<font color=black>
						<input type=button class="btn_def" value="Show Market Results" onClick="return fs(this,'MktSetRes')">
						</font>
						</th>
					</tr>
					<input type=hidden name=SubmitName value="">
					<input type="hidden" name="action" VALUE="ADMIN::SELN::GoOcsRes">
					</form>
              ##TP_ENDIF##

		##TP_ENDIF## <!-- AfterEventStart -->
	##TP_ENDIF## <!-- NumSelns > 0 -->

	</table>

<!-- show links to the pools that this market is in -->
	##TP_IF {[tpGetVar HasPools] == "Y"}##
	<br>
	<table border=0 cellspacing=1 cellpadding=1>
		<tr>
			<th class=title colspan=9>
			Pools
			</th>
		</tr>
		<tr>
			<th class=colhead>Pool Type</th>
			<th class=colhead>Leg n of m</th>
			<th class=colhead>Display</th>
			<th class=colhead>Status</th>
			<th class=colhead>Voided</th>
			<th class=colhead>Confirmed</th>
			<th class=colhead>Settled</th>
		</tr>
		##TP_LOOP pool_idx {[tpGetVar NumPools]}##
		<script>write_pool_tr('##TP_PoolSettled##', '##TP_PoolConfirmed##', '##TP_PoolStatus##', '##TP_PoolDisplayed##', '##TP_PoolIsVoid##')
		</script>
			<td><a href="##TP_CGI_URL##?action=ADMIN::POOLS::GoPoolInfo&PoolId=##TP_PoolId##">##TP_PoolName##</a></td>
			<td>##TP_PoolLegNum## / ##TP_PoolNumLegs##</td>
			<td>##TP_PoolDisplayed##</td>
			<td>##TP_PoolStatus##</td>
			<td>##TP_PoolIsVoid##</td>
			<td>##TP_PoolConfirmed##</td>
			<td>##TP_PoolSettled##</td>
		</tr>
		##TP_ENDLOOP##
		##TP_IF {[op_allowed PoolVoidAll] && [tpGetVar VoidAllPoolsWithNoDiv 0]}##
			<form action="##TP_CGI_URL##" method=get >
			<input type="hidden" name="EvId"  value="##TP_EvId##">
			<input type="hidden" name="MktId" value="##TP_MktId##">
			<tr class=button>
				<th align=left colspan=7>
				<input type=submit class="btn_def" value="Void Pools with no Dividend">
				</th>
			</tr>
			<input type="hidden" name="action" VALUE="ADMIN::POOLS::VoidAllPoolsMkt">
			</form>
		##TP_ENDIF##
	</table>

	##TP_ENDIF## <!-- pools links -->

##TP_ENDIF## <!-- opAdd -->

##TP_IF {[OT_CfgGet ENABLE_OC_VARIANTS 0] == 1}##


		<style>
			.ocv_active {
				 background-color: #00FF00
			}

			.ocv_suspended {
				 background-color: #FF0000
			}

			.ocv_hidden {
				font: 12pt Arial;
				letter-spacing 4pt;
				 background-color: #FFFF00
			}
		</style>


		<script type="text/javascript">

			function setOcVarParam(sname,svalue) {
				var x = new getObj(sname);
				if (!x.obj) {
					var oInput = document.createElement("INPUT");
					oInput.name = sname;
					oInput.type = "HIDDEN";
					oInput.id = sname;
					oInput.value = svalue;
					var oForm = new getObj("oc_variants");
					oForm.obj.appendChild(oInput);
				} else {
					x.obj.value = svalue;
				}
			}

			function getObj(name) {
				if (document.getElementById) {
					this.obj = document.getElementsByName(name).item(0);
				} else if (document.all) {
					this.obj = document.all[name];
				} else if (document.layers) {
					this.obj = getObjNN4(document,name);
				}
			}

			function getObjNN4(obj,name) {
				var x = obj.layers;
				var thereturn;
				for (var i=0;i<x.length;i++)
				{
					if (x[i].id == name)
						thereturn = x[i];
					else if (x[i].layers.length)
						var tmp = getObjNN4(x[i],name);
					if (tmp) thereturn = tmp;
				}
				return thereturn;
			}

		</script>


	<!-- Handicap Teasers -->
	##TP_IF {[string first [tpGetVar MktType] "AHULlM"] >= 0 && [tpGetVar NumSelns 0]>0 }##
	<form name="oc_variants" method="post" action="##TP_CGI_URL##">

	<input type="hidden" name="action"     value="ADMIN::MARKET::DoMkt"/>
	<input type="hidden" name="MktId"      value="##TP_MktId##"/>
	<input type="hidden" name="AuditInfo"  value="EvOcVariant" id="AuditInfoVar">
	<input type="hidden" name="SubmitName" value=""/>
	<br/>

		##TP_IF {[tpBindGet ocv_num_hcaps] > 0}##

		<table cellpadding="0" cellspacing="0">
			<tr>
				<th colspan="3" class="title">
					Handicap Teasers
				</th>
			</tr>
			<tr>
				<th class="colhead">
					Selection
				</th>
				<th class="colhead" align="right">
					Teasers
				</th>
				<th class="colhead" align="left">
					Enabled
				</th>
			</tr>

			##TP_LOOP seln_idx {[tpGetVar NumSelns]}##
			<tr>
				<td>
				##TP_OcDesc##
				</td>
				<td align="right">
				##TP_OcHasOcVars##
				</td>
				<td align="left">
					<select name="ocv_seln_status_##TP_OcId##">
						<script language="javascript"/>
						write_select('##TP_OcHasOcVars##','N','No','Y','Yes')
						</script>
					</select>
				</td>

			</tr>
			##TP_ENDLOOP##

			<tr>
				<td colspan="3" height="2" align="center">
				</td>
			</tr>
			<tr>
				<td align="left">
					<input class="btn_def" type="button" value="Update"
							onclick="javascript:setOcVarParam('oc_var_action','UpdOcvSelnEnabled');
										fs(this,'ProcessOcVariant')"/>
				</td>
				<td align="right" colspan="2">
				<input class="btn_def" type="button" value="View Teaser History" size="40"
					onClick="document.getElementById('AuditInfoVar').value='EvOcVariant';return fs(this,'GoAudit')" />
				</td>
			</tr>
		</table>
		<br/>


		<table cellpadding="2" cellspacing="0">
			<tr>
				<th colspan="2" class="title">
					Handicap Teasers Breakdown
				</th>
				<th class="title" colspan="##TP_TCL {tpBufWrite [tpBindGet ocv_num_selns]}##"></th>
			</tr>

			<tr>
				<th class="colhead">Selections :</th>
				<th class="colhead"></th>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<th class="colhead">##TP_ocv_selection##</th>
				##TP_ENDLOOP##
			</tr>

			##TP_LOOP ocv_hcap_idx {[tpBindGet ocv_num_hcaps]}##

			<tr>
				<td rowspan="4">
					handicap:
					<br\>
					<input type="text" value="##TP_ocv_value##" size="6" name="ocv_hcap_##TP_ocv_value##"/>
				</td>
				<td>
					Price:
				</td>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<td>
					##TP_IF {[tpBindGet ocv_oc_var_id] != ""}##
					<input name="ocv_prc_##TP_ocv_oc_var_id##" type="text" size="5" value="##TP_ocv_price_num##/##TP_ocv_price_den##"/>
					##TP_ENDIF##
				</td>
				##TP_ENDLOOP##
			</tr>

			<tr>
				<td>
					Hcap:
				</td>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<td>
					##TP_ocv_hcap_value_fmt##
					<input type="hidden" name="ocv_hcap_##TP_ocv_oc_var_id##" value="##TP_ocv_value##"/>
				</td>
				##TP_ENDLOOP##
			</tr>

			<tr>
				<td>
					Status:
				</td>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<td>
					##TP_IF {[tpBindGet ocv_oc_var_id] != ""}##
					<select name="ocv_status_##TP_ocv_oc_var_id##">
						<option value="S" ##TP_IF {[tpBindGet ocv_status] == "S"}##selected##TP_ENDIF##>S</option>
						<option value="A" ##TP_IF {[tpBindGet ocv_status] == "A"}##selected##TP_ENDIF##>A</option>
					</select>
					##TP_ENDIF##
				</td>
				##TP_ENDLOOP##
			</tr>

			<tr>
				<td>
					Max Bet:
				</td>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<td>
					##TP_IF {[tpBindGet ocv_oc_var_id] != ""}##
					<input name="ocv_maxbet_##TP_ocv_oc_var_id##" type="text" size="7" value="##TP_ocv_max_bet##"/>
					##TP_ENDIF##
				</td>
				##TP_ENDLOOP##
			</tr>

			<tr>
				<td class=buttons>
					<input type="button" value="Del"
							onclick="javascript:setOcVarParam('oc_var_action','DeleteMktValue');
										setOcVarParam('oc_var_old_value','##TP_ocv_value##');
										fs(this,'ProcessOcVariant')"/>
					&nbsp;
					<input type="button" value="Upd"
							onclick="javascript:setOcVarParam('oc_var_action','ChangeMktValue');
										setOcVarParam('oc_var_old_value','##TP_ocv_value##');
										fs(this,'ProcessOcVariant')"/>
				</td>
				<td>
				</td>
				##TP_LOOP ocv_seln_idx {[tpBindGet ocv_num_selns]}##
				<td class=buttons>
					##TP_IF {[tpBindGet ocv_oc_var_id] != ""}##
					<input type="button" value="Update"
								onclick="javascript:setOcVarParam('oc_var_action','UpdateOcvSgl');
													setOcVarParam('oc_var_id','##TP_ocv_oc_var_id##');
													fs(this,'ProcessOcVariant')"/>
					<input type="hidden" value="##TP_oc_var_id##" name="ocv_id_##TP_ocv_oc_var_id##"/>
					##TP_ENDIF##
				</td>
				##TP_ENDLOOP##
			</tr>

			<tr>
				<th colspan="2" bgcolor="#222222">
				</th>
				<th bgcolor="#222222" colspan="##TP_TCL {tpBufWrite [tpBindGet ocv_num_selns]}##"></th>
			</tr>

			##TP_ENDLOOP##


			<tr>
				<th colspan="2" class=buttons>
					<input type="button" value="Update All"
								onclick="javascript:setOcVarParam('oc_var_action','UpdateOcvAll');
													fs(this,'ProcessOcVariant')"/>
				</th>
				<th class="buttons" colspan="##TP_TCL {tpBufWrite [tpBindGet ocv_num_selns]}##"></th>
			</tr>
		</table>
		##TP_ENDIF##


	</br>

	<table cellpadding="0" cellspacing="1">
		<tr>
			<th class="title">
				Add Handicap Teasers
			</th>
		</tr>
		<tr>
			<td>
				<table cellpadding="2" cellspacing="2" >
					<tr>
						<td>Min</td>
						<td>
							<input type="text" name="MinHcapVariant" size="9" value="##TP_HCAP_TEASER_DFLT_MIN##"/>
						</td>
						<td>Max</td>
						<td>
							<input type="text" name="MaxHcapVariant" size="9" value="##TP_HCAP_TEASER_DFLT_MAX##"/>
						</td>
						<td>Increment</td>
						<td colspan="2">
							<input type="text" name="VariantHcapIncr" size="9" value="##TP_HCAP_TEASER_DFLT_INCR##"/>
						</td>

						<td colspan="2">
							Price:
							<input type="text" name="VariantHcapPrice" size="9" value="1/100"/>
						</td>

						<td>Max Bet</td>
						<td>
							<input type="text" name="MaxBetHcapVariant" size="9" value=""/>
						</td>

						<td colspan="2">
							Status:
							<select name="VariantHcapStatus">
								<option value="S">S</option>
								<option value="A" selected>A</option>
							</select>
						</td>

						<input type="hidden" name="oc_var_action" value="AddHcapVarMkt"/>
						<td colspan="2" class="button">
							<input type="button" size="5" class="btn_def" value="Add Teasers"
								onclick="javascript:setOcVarParam('oc_var_action','AddHcapVarMkt');fs(this,'ProcessOcVariant')"/>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>


	</table>
	</form>

	##TP_ENDIF##
##TP_ENDIF##

</body>
</html>
