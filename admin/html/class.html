<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- $Id: class.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Add Event Class</title>
##TP_PLAY JS_ValFuncs.html##
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>
##TP_PLAY bf_dd.js##
var errorList = "";
function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function validate(f)
{
	var class_name  = strTrim(f.ClassName.value, " ");
	var disporder   = strTrim(f.DispOrder.value, " ");

	errorList = "";

	if (class_name.length == 0) {
		add_err("class name cannot be empty");
	} else {
		if (!isSafeStr(class_name)) {
			add_err("don't use these characters in group name : "
				+ "tab [ ] { } < > \" \\ $");
		}
	}
	if (disporder.length > 0) {
		if (!isInt8(disporder, true)) {
			add_err("disporder must be an integer between +/-99999999");
		}
	}

	if (errorList != "") {
		alert("There are some errors in the form:\n\n" + errorList);
		return false;
	}
	return true;
}

function write_tr(status,displayed)
{
	if (status == 'S') {
		document.write('<tr class=suspended>');
	} else if (displayed != 'Y') {
		document.write('<tr class=hidden>');
	} else {
		document.write('<tr class=active>');
	}
}
function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	##TP_IF {[OT_CfgGet BF_ACTIVE 0]}##
		if (t == "UpdRule") {
			b.form.action.value="ADMIN::BETFAIR_TYPE::UpdTypeRule";
		}
	##TP_ENDIF##
	b.form.submit();
	return true;
}

function ViewDispPopup(id,name)
{
	window.open("##TP_CGI_URL##?action=ADMIN::VIEWS::GoViewDisporders&id="+id+"&sort=CLASS&name="+name,
		"Views",
		"toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes,width=300,height=300");
}

function blurb_popup (id, sort) {
	if (id == "") {
		alert("No Id specified, does the "+sort+" exist.\n"+
			"You must create it before you can add a blurb");
		return;
	}

	window.open("##TP_CGI_URL##?action=ADMIN::BLURB::do_blurb&ref_id="+id+"&sort="+sort,
		"Blurb",
		"toolbar=no,location=no,directories=no,menubar=no,resizable=yes,width=600,height=200");
}

</script>
</head>
<body>
##TP_PLAY error_rpt.html##
##TP_IF {[tpGetVar ClassAddFailed 0]}##
	<h3 class="failed">Failed to add new class</h3>
##TP_ENDIF##
##TP_IF {[tpGetVar ClassAdded 0]}##
	<h3 class="succeeded">Class Added</h3>
##TP_ENDIF##
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	<th colspan=2 class=title>
	Event Class Details
	</th>
</tr>
<form action="##TP_CGI_URL##" method=get onSubmit="return validate(this);">
##TP_IF {[tpGetVar FuncShowDDId 0] && ![tpGetVar opAdd 0]}##
	<tr>
		<td class="caption">Class Identifier</td>
		<td>##TP_ClassId##</td>
	</tr>
##TP_ENDIF##

<tr>
	<td class=caption>Class name</td>
	<td>
		<input type=text name="ClassName" value="##TP_ClassName##" size=40>
	</td>
</tr>
<tr>
	<td class=caption>Category</td>
	<td class="table">
		<table border="0" cellspacing="0" cellpadding="3">
			<tr>
				<td>
					<select name="Category">
						<script type="text/javascript">
							write_select('##TP_ClassCategory##'
								##TP_LOOP cat_idx {[tpGetVar NumCats]}##
								,"##TP_Category##","##TP_Category##"
							##TP_ENDLOOP##
							);
						</script>
					</select>
				</td>
				<td class=subcaption>Sort</td>
				<td>
					<select name="Sort">
						<script type="text/javascript">
							write_select('##TP_Sort##'
								##TP_LOOP sort_idx {[tpGetVar NumSorts]}##
								,'##TP_SortCode##','##TP_SortName##'
								##TP_ENDLOOP##
							);
						</script>
					</select>
				</td>
				<td class=subcaption>Status</td>
				<td>
					<select name="Status">
						<script type="text/javascript">
							write_select('##TP_Status##','A','Active','S','Suspended')
						</script>
					</select>
				</td>
				<td class=subcaption>Displayed</td>
				<td>
					<select name="Displayed">
						<script type="text/javascript">
							write_select('##TP_Displayed##', 'Y','Yes','N','No');
						</script>
					</select>
				</td>
			</tr>
		</table>
	</td>
<tr>
	<td class=caption>Disporder</td>
	<td class="table">
		<table border="0" cellspacing="0" cellpadding="3">
			<tr>
				<td>
					<input type=text name="Disporder" value="##TP_Disporder##" size=8>
					##TP_IF {[OT_CfgGetTrue FUNC_VIEWS]}##
						<input type=button class="btn_def" value="View Disporders" onclick="ViewDispPopup('##TP_ClassId##','##TP_ClassName##')">
					##TP_ENDIF##
				</td>
				##TP_IF {[OT_CfgGet FUNC_ASYNC_BET 0]}##
				<td class="subcaption">Auto-referral Betting</td>
				<td>
					<select name="AsyncBetting">
						<script type="text/javascript">
							write_select('##TP_AsyncBetting##','Y', 'Yes', 'N', 'No');
						</script>
					</select>
				</td>
				##TP_ELSE##
				<input type="hidden" name="AsyncBetting" value="##TP_AsyncBetting##" />
				##TP_ENDIF##
			</tr>
		</table>
	</td>
</tr>


##TP_IF {[string first URL [OT_CfgGet FUNC_CLASS_FIELDS ""]] >= 0}##
	<tr>
		<td class=caption>Information URL</td>
		<td>
		<input type="text" name="URL" size=50 maxlen=120 value="##TP_URL##">
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[string first BLURB [OT_CfgGet FUNC_CLASS_FIELDS ""]] >= 0}##
	<tr>
		<td class=caption>Blurb</td>
		<td>
	    	<textarea cols=60 rows=4 wrap=virtual name="Blurb">##TP_Blurb##</textarea><br/>
			<i>(Only 250 characters are stored)</i><br/>
			<a href='javascript:blurb_popup("##TP_ClassId##", "CLASS")'>edit multi-lingual text</a>
			<span class="multiLingualMsg">(multi-lingual text will take precedence over the default text)</span>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_CLASS_FLAGS 0]}##

	##TP_IF {[tpGetVar NumClsFlags 0]>0}##
	<tr>
		<td class=caption>Flags</td>
		<td class="table">
		<table cellspacing=0 cellpadding=0 border=0>
		##TP_LOOP ev_tag_idx {[expr {4*(([tpGetVar NumClsFlags]+3)/4)}]}##
			##TP_IF {[tpGetVar ev_tag_idx]%4 == 0}##
				<tr>
			##TP_ENDIF##
			##TP_IF {[tpGetVar ev_tag_idx]<[tpGetVar NumClsFlags]}##
				<td>
				<input type=checkbox name="ClsFlag_##TP_ClsFlagCode##" ##TP_ClsFlagSel##>
				##TP_ClsFlagName##
				</td>
			##TP_ELSE##
				<td>&nbsp;</td>
			##TP_ENDIF##
			##TP_IF {([tpGetVar ev_tag_idx]+1)%4 == 0}##
				</tr>
			##TP_ENDIF##
		##TP_ENDLOOP##
		</table>
		</td>
	</tr>
	##TP_ENDIF##

##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
	<tr>
		<td class=caption>Channels</td>
		<td class="table">
		##TP_PLAY chan_sel.html##
		</td>
	</tr>
	<tr>
		<td class=caption>Fastkey</td>
		<td>
		<input type=text name=Fastkey size=1 value="##TP_Fastkey##">
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet FUNC_FCTC_STK_LIMITS 0]}##
	<tr>
	    <td class="caption">Forecast Stake Factor</td>
		<td><input type=text size=4 name=fc_stk_factor value="##TP_FcStkFactor##">
	    &nbsp;&nbsp;&nbsp;<b>Minimum Forecast Stake Limit</b>
		<input type=text size=8 name=fc_min_stk value="##TP_FcMinStk##"></td>
	</tr>
	<tr>
	    <td class="caption">Tricast Stake Factor</td>
		<td><input type=text size=4 name=tc_stk_factor value="##TP_TcStkFactor##">
	    &nbsp;&nbsp;&nbsp;<b>Minimum Tricast Stake Limit</b>
		<input type=text size=4 name=tc_min_stk value="##TP_TcMinStk##"></td>
	</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGetTrue FUNC_VIEW_FLAGS]}##
	<tr>
		<td class="caption">Views</td>
		<td class="table">
		##TP_PLAY view_sel.html##
		</td>
	</tr>
##TP_ENDIF##

##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [tpGetVar NoBFClassMap 0] != 1}##

	##TP_IF {[OT_CfgGet BF_ACCOUNT_PER_CLASS 0]} ##
		##TP_TCL {tpSetVar BfAcc 1}##
		##TP_PLAY bf_class.html##
	##TP_ENDIF##
	##TP_IF {[OT_CfgGet BF_MANUAL_MATCH 0] || [OT_CfgGet BF_AUTO_MATCH 0]}##
		##TP_TCL {tpSetVar BfFilter 1}##
		##TP_PLAY bf_class.html##
	##TP_ENDIF##

##TP_ENDIF##

<tr>
	<td class="caption">Commentary version</td>
	<td><input type="text" name="commentary" value="##TP_Commentary##" size="2" /></td>
</tr>
##TP_IF {[OT_CfgGet FUNC_BIR_DELAY 0]}##
<tr>
	<td class=caption>BIR delay</td>
	<td>
		<input type=text name="ClassBirDelay" value="##TP_BIRDelay##" size=4>&nbsp;(sec)&nbsp; ##TP_IF {[tpGetVar displayBIRHierarchy 0]}## (##TP_BIRHierarchyVal## sec from ##TP_BIRHierarchy##) ##TP_ENDIF##
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td colspan=2 class=buttons>
	<table border=0 cellspacing=0 cellpadding=0 width=100%>
	<tr>
		<input type=hidden name="ClassId" value="##TP_ClassId##">
		<td width=75% class="buttons">
		##TP_IF {[op_allowed ManageClass]}##
			##TP_IF {[tpGetVar opAdd 0]}##
				<input type=button class="btn_def" value="Add Event Class" onClick="return fs(this,'ClassAdd')">
			##TP_ELSE##
				<input type=button class="btn_def" value="Modify Event Class" onClick="return fs(this,'ClassMod')">
				##TP_IF {[tpGetVar AllowDDDeletion 0]}##
				<input type=button class="btn_def" value="Delete Event Class" onClick="return fs(this, 'ClassDel')">
				##TP_ENDIF##
			##TP_ENDIF##
		##TP_ENDIF##
		<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
		</td>
		##TP_IF {![tpGetVar opAdd 0]}##
			##TP_IF {[tpGetVar PERM_ViewAudit 0]}##
				<td class=goaudit width=25%>
				<input type=button class="btn_def" value="View Audit History" onClick="return fs(this,'GoAudit')">
				<input type=hidden name=AuditInfo value="Class">
				</td>
			##TP_ENDIF##
		##TP_ENDIF##
	</tr>
	</table>
	</td>
</tr>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::CLASS::DoClass>
</form>
</table>
<br>
<!----- TYPES ----->

##TP_TCL {tpBindString NumCols 8}##

##TP_IF {![tpGetVar opAdd 0]}##
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	<th colspan=##TP_NumCols## class=title>
	##TP_ClassName## Event Types
	</th>
</tr>
<form ACTION="##TP_CGI_URL##" method=post name="fmtype">
<tr>
	<th class=colhead>Type</th>
	<th class=colhead>Disporder</th>
	##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
		<th class=colhead>Channels</th>
		<th class=colhead>Fastkey</th>
	##TP_ENDIF##
	##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_AUTO_MATCH 0]}##
			##TP_TCL {tpSetVar BfFilterHeaders 1}##
			##TP_PLAY bf_match_rules.html##
	##TP_ENDIF##
</tr>
##TP_IF {[tpGetVar NumTypes 0]}##
##TP_LOOP type_idx {[tpGetVar NumTypes]}##
<script>
	write_tr('##TP_TypeStatus##','##TP_TypeDisplayed##')
</script>
	<td>
	<a HREF="##TP_CGI_URL##?action=ADMIN::TYPE::GoType&ClassId=##TP_ClassId##&TypeId=##TP_TypeId##">##TP_TypeName##</a>
	</td>
	<td align=right>##TP_TypeDisporder##</td>
	##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
		<td>##TP_TypeChannels##&nbsp;</td>
		<td>##TP_TypeFastkey##&nbsp;</td>
	##TP_ENDIF##

	##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_AUTO_MATCH 0]}##
		##TP_TCL {tpSetVar BfFilterCols 1}##
		##TP_PLAY bf_match_rules.html##
	##TP_ENDIF##
</tr>
##TP_ENDLOOP##
##TP_ELSE##
<tr>
	<td colspan=##TP_NumCols##>
	<span class="nrows">No event types defined</span>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[op_allowed ManageEvType]}##
<tr>
<th colspan=##TP_NumCols## class=buttons>
	<input type=hidden name="ClassId" value="##TP_ClassId##">
	<input type=hidden name="Category" value="##TP_ClassCategory##">
	<input type=hidden name="ClassName" value="##TP_ClassName##">
	 ##TP_IF {[tpGetVar AllowDDCreation 0]}##
	<input type=button class="btn_def" value="Add Event Type" onClick="return fs(this,'TypeAdd')">
	##TP_ENDIF##
	##TP_IF {[OT_CfgGet BF_ACTIVE 0] && [OT_CfgGet BF_AUTO_MATCH 0]}##
		##TP_TCL {tpSetVar BfFilterBtn 1}##
		##TP_PLAY bf_match_rules.html##
	##TP_ENDIF##
</th>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::TYPE::GoType>
</form>
</tr>
##TP_ENDIF##
</table>

<br>

##TP_TCL {ADMIN::COUPON::get_class_coupons [tpBindGet ClassId] 1}##

##TP_ENDIF##
</body>
</html>
