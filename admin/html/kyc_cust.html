
<form action="##TP_CGI_URL##" method="post" name="kyc">
<input type="hidden" name="action" value="ADMIN::KYC::DoCust"/>
<input type="hidden" name="CustId" value="##TP_CustId##"/>

<script type="text/javascript">
	function kyc_fs(b,t)
	{
		var status = b.form.status.value;
		var reason = b.form.reason_code.value;

		if (
			(status == '' || status == 'R' || status == 'F') &&
			reason != ''
		) {
			alert('You must not choose a reason if the customer has not passed KYC');
			return;
		}

		b.disabled = true;
		b.value = "Busy...";
		b.form.submit();
		return true;
	}
</script>

<table border="0" cellspacing="0" cellpadding="3">
	<thead>
		<tr>
			<th colspan="2" class="title">KYC Status</th>
		</tr>
	</thead>

	<tbody>
		<tr>
			<td class="caption">Status</td>
			<td>
				##TP_IF {[op_allowed UpdateKYCStatus]}##
					<select name="status">
						<script type="text/javascript">
							write_select('##TP_CustKYCStatus##',
								'','N/A',
								'R','Restricted',
								'F','Restricted (Automated check failed)',
								'AR','Restricted (triggered by AV)',
								'AF','Restricted, Automated check failed (triggered by AV)',
								'A','Automated AuthPro pass',
								'C','Automated CVV2 pass','M','Manual pass'
							);
						</script>
					</select>
				##TP_ELSE##
					<script type="text/javascript">
						write_which('##TP_CustKYCStatus##',
								'','N/A',
								'R','Restricted',
								'F','Restricted (Automated check failed)',
								'AR','Restricted (triggered by AV)',
								'AF','Restricted, Automated check failed (triggered by AV)',
								'A','Automated AuthPro pass',
								'C','Automated CVV2 pass',
								'M','Manual pass'
						);
					</script>
				##TP_ENDIF##
			</td>
		</tr>
		<tr>
			<td class="caption">Reason</td>
			<td>
				##TP_IF {[op_allowed UpdateKYCStatus]}##
					<select name="reason_code">
						<script type="text/javascript">
							write_select('##TP_CustKYCReason##','','N/A'
								##TP_LOOP kyc_idx {[tpGetVar KYCNumReasonRows]}##
									,'##TP_KYCReasonCode##','##TP_KYCDesc##'
								##TP_ENDLOOP##
							);
						</script>
					</select>
				##TP_ELSE##
					<script type="text/javascript">
						write_which('##TP_CustKYCReason##','','N/A'
						##TP_LOOP kyc_idx {[tpGetVar KYCNumReasonRows]}##
							,'##TP_KYCReasonCode##','##TP_KYCDesc##'
						##TP_ENDLOOP##
						);
					</script>
				##TP_ENDIF##

			</td>
		</tr>
		<tr>
			<td class="caption">Notes</td>
			<td>
				##TP_IF {[op_allowed UpdateKYCStatus]}##
					<textarea name="notes" cols="40" rows="4">##TP_CustKYCNotes##</textarea>
				##TP_ELSE##
					##TP_CustKYCNotes##
				##TP_ENDIF##
			</td>
		</tr>
		##TP_IF {[op_allowed UpdateKYCStatus]}##
			<tr>
				<td class="buttons" colspan="1">
					<input type="button" value="Update" onClick="return kyc_fs(this)"/>
				</td>
		##TP_ELSE##
			<tr>
		##TP_ENDIF##
			<input type=hidden name=AuditInfo value="">
			<input type=hidden name=SubmitName value="">
			<td class="buttons" colspan="1">
				<input type="button" value="View KYC history" onClick="return doAudit('kycCust', this)"/>
			</td>
		</tr>
	</tbody>

</table>
</form>
