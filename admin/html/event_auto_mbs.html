<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- $Id: event_auto_mbs.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Automatic Money Back Special</title>
<script>

var errorList = "";

function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\;\n";
	}
	errorList += e_str;
}

function goback(ev_id)
{
	window.location="##TP_CGI_URL##?action=ADMIN::EVENT::GoEv&EvId=" + ev_id;
}

function isInteger(s) {
  return (s.toString().search(/^[0-9]+$/) == 0);
}

function validate(f)
{	
	var name = f.MBSOfferName.value;
	var relexp = f.MBSOfferRelExpiry.value;
	var redid = f.MBSOfferRedemptionId.value;
	errorList = "";
	if (name.length == 0) {
		add_err("Name of Offer cannot be empty");
	}
	if (!isInteger(relexp)) {
		add_err("Relative expiry must be an integer number of days");
	}

	if (errorList != "") {
		alert("There are some errors in the form:\n\n" + errorList);
		return false;	
	}

	var r = confirm("You are about to generate Money Back Special Tokens");
	if (r == false) {
		return false;
	}

	return true;

}

</script>
</head>

<body>
	##TP_PLAY msg_rpt.html##
	##TP_PLAY error_rpt.html##

	<form name="DoAutoMBS" method=get ACTION="##TP_CGI_URL##" onSubmit="return validate(this);">
	<table cellspacing=0 cellpadding=2 border=0>
		<tr>
			<th class=title colspan=2>Automatically Generate Money Back Special Tokens</th>
		</tr>
		<tr>
			<td class="caption">Event</td>
			<td>##TP_EvDesc##</td>
		<tr>
			<td class="caption">Event Identifier</td>
			<td>##TP_EvId##</td>
		</tr>
		<tr>
			<td class=caption>New MBS Offer Name</td>
			<td>
				<input name="MBSOfferName" type="text" size="30" value="MBS: EvId##TP_EvId##">
			</td>
		</tr>
		<tr>
			<td class=caption>Relative Expiry in days</td>
			<td>
				<input name="MBSOfferRelExpiry" type="text" size="3" value="##TP_TCL {OT_CfgGet MBS_REL_EXP 15}##">
			</td>
		</tr>
		<tr>
			<td class=caption>MBS Redemption Value</td>
			<td>
				<select name="MBSOfferRedemptionId">
				##TP_LOOP red_val_idx {[tpGetVar NumRedVal 0]}##
					<option value="##TP_id##">##TP_option##</option>
				##TP_ENDLOOP##
			</td>
		</tr>
		<tr>
			<th class=buttons align = "right" colspan="2">
				<input type=submit class="btn_def" value="Automatically Generate MBS">
				<input type=hidden name=action value="ADMIN::EVENT::DoAutoMBS">
				<input type=hidden name=EvId value="##TP_EvId##">
				<input type=hidden name=EvDesc value="##TP_EvDesc##">
				<input type=button class="btn_def" value="Back" onClick="goback('##TP_EvId##')">
			</th>
		</tr>
	</form>

</table>

</body>
</html>
