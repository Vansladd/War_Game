<html>
<!-- $Id: autogen_FB.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Football Event Generation</title>
##TP_PLAY header_cal.html##
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>

##TP_INCL price_util.js##

var errorList = "";

function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function validate(f)
{
	errorList = "";

	var fm = document.forms["DoEventFB"];

	var selectedHome = fm.elements["EvHomeTeamId"].selectedIndex;
	var home         = fm.elements["EvHomeTeamId"].options[selectedHome].value;
	var selectedAway = fm.elements["EvAwayTeamId"].selectedIndex;
	var away         = fm.elements["EvAwayTeamId"].options[selectedAway].value;
	var domain       = fm.elements["EvFBDomain"].selectedIndex;

	if (home == away) {
		add_err("Home and away teams cannot be the same.");
	}
	if (domain==0) {
		add_err("Domain must be set.");
	}
	if (errorList != "") {
		alert("There are some errors in the form:\n\n" + errorList);
		return false;
	}
    return true;
}

function fs(b,t)
{
	var valid = true;
	if (t != "Back") {
		valid = validate(b);
	}
	if (valid==true) {
		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();
		return true;
	}
}

function init()
{
	var fm = document.forms["DoEventFB"];

	fm.elements["EvHomeTeamId"].selectedIndex=##TP_HOME_TEAM_IDX##;
	fm.elements["EvAwayTeamId"].selectedIndex=##TP_AWAY_TEAM_IDX##;
}

function displayCalendars() {
	new Calendar(document.forms.DoEventFB.EvStartTime,null,true,"lo")

}


function calculateOverround(mkt_sort) {

	var res = 0.0;

	switch (mkt_sort) {
		case "WDW" :
			var LPInputs = new Array('WDWHomeLP','WDWDrawLP','WDWAwayLP');
			break;
		case "AH" :
			var LPInputs = new Array('AHBHomeLP','AHBAwayLP');
			break;
		default :
			var LPInputs = new Array();
	}

	for ( var i=0; i < LPInputs.length ; i++ ) {
		eval('var oc_lp = parsePrice(document.forms["DoEventFB"].' + LPInputs[i] + '.value);');

		if (oc_lp[0] != '' && oc_lp[0] != 'ERR' && oc_lp[1]!= '' ) {
			res +=  ( oc_lp[1] / ( parseFloat(oc_lp[0]) + parseFloat(oc_lp[1])) );
		}
	}

	return 100*res;
}


function doWarningOverround(button,onConfirm) {

	var confirmWDW = true;
	var confirmAH = true;

	var overroundWDW = calculateOverround('WDW');
	var overroundAH = 101;

	if (parseFloat(overroundWDW) < 100 ) {
		var overroundWDW_disp = overroundWDW.toFixed(2);
		//QC 193 replace overround in the error msg by underround
		confirmWDW = confirm('You have inputted prices that will result in an underround of ' + overroundWDW_disp + '%  for the Win/Draw/Win market. \n Do you wish to continue?');

	}

	##TP_IF {[tpGetVar MKT_AH 0]}##

	var genAH = document.forms["DoEventFB"].AHautogen.checked;

	if (genAH) {

		overroundAH = calculateOverround('AH');

		if (parseFloat(overroundAH) < 100 ) {

			var overroundAH_disp = overroundAH.toFixed(2);
			//QC 193 replace overround in the error msg by underround
			confirmAH = confirm('You have inputted prices that will result in an underround of ' + overroundAH_disp + '%  for the Asian Handicap market. \n Do you wish to continue?');
		}
	}

	##TP_ENDIF##

	if (confirmWDW && confirmAH) {
	 	return fs(button,onConfirm);
	}
}


</script>

</head>
<body onload="init(); displayCalendars()">


##TP_PLAY error_rpt.html##
<table border=0 cellspacing=0 cellpadding=2>
<form name=DoEventFB method=get action="##TP_CGI_URL##">
<input type=hidden name=ClassSort value="FB">
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::AUTOGEN::DoEvFB>
<input type=hidden name=TypeId value="##TP_TypeId##">
<input type=hidden name=EvId   value="##TP_EvId##">
<input type=hidden name="MktGrpList" value="##TP_MktGrpList##">
<tr>
	<th class=title colspan=2>
	Football Event Auto-Generation:&nbsp;
    ##TP_ClassName##,&nbsp;##TP_TypeName##
	</th>
</tr>
<tr>
	<td nowrap class=caption>Home vs Away</td>
	<td nowrap>
	##TP_IF {[string first SHORTCUT [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
		<input type=text size=2 name=EvShortcut value="##TP_EvShortcut##">
	##TP_ENDIF##
	<select name=EvHomeTeamId>
		##TP_LOOP c_idx {$TEAMARRAY(entries)}##
		<option value="##TP_TEAM_ID##">##TP_TEAM_NAME##</option>
		##TP_ENDLOOP##
	</select>
	<select name=EvAwayTeamId>
		##TP_LOOP c_idx {$TEAMARRAY(entries)}##
		<option value="##TP_TEAM_ID##">##TP_TEAM_NAME##</option>
		##TP_ENDLOOP##
	</select>
	</td>
</tr>
##TP_IF {[tpGetVar NumEvTags 0]>0}##
<tr>
	<td class=caption>Flags</td>
	<td class="table">
	<table cellspacing=0 cellpadding=0 border=0>
	##TP_LOOP ev_tag_idx {[expr {4*(([tpGetVar NumEvTags]+3)/4)}]}##
		##TP_IF {[tpGetVar ev_tag_idx]%4 == 0}##
			<tr>
		##TP_ENDIF##
		##TP_IF {[tpGetVar ev_tag_idx]<[tpGetVar NumEvTags]}##
			<td>
			<input type=checkbox name="EVTAG_##TP_EvTagCode##" ##TP_EvTagSel##>
			##TP_EvTagName##
			</td>
		##TP_ELSE##
			<td>&nbsp;</td>
		##TP_ENDIF##
		##TP_IF {([tpGetVar ev_tag_idx]+1)%4 == 0}##
			</tr>
		##TP_ENDIF##
	##TP_ENDLOOP##
	</table>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[string first VENUE [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
	<tr>
		<td class=caption>Venue</td>
		<td>
		<input type=text name=EvVenue value="##TP_EvVenue##" size=60>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[string first VENUE [OT_CfgGet FUNC_EVENT_FIELDS]] >= 0}##
	<tr>
		<td class=caption>Country</td>
		<td>
		<input type=text name=EvCountry value="##TP_EvCountry##" size=60>
		</td>
	</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Start Time</td>
	<td>
	<input name=EvStartTime type=text size=19 value="##TP_EvStartTime##">
	##TP_IF {[tpGetVar NumDomains 0] > 1}##
		&nbsp;&nbsp;&nbsp;
		<b>Domain</b>&nbsp;
        <select name=EvFBDomain>
        <script>
            write_select("##TP_EvFBDomain##"
				,'-','unset'
				##TP_LOOP domain_idx {[tpGetVar NumDomains]}##
				,"##TP_DomainFlag##","##TP_DomainName##"
				##TP_ENDLOOP##
                )
        </script>
        </select>
	##TP_ELSE##
		&nbsp;&nbsp;&nbsp;
		##TP_TCL -quiet {tpSetVar domain_idx 0}##
		<input type=hidden name=EvFBDomain value="##TP_DomainFlag##">
	##TP_ENDIF##
    </td>
</tr>
<tr>
	<td class=caption>Stake limits</td>
	<td>Bet Min&nbsp;
	<input name=EvMinBet type=text size=8 value="##TP_EvMinBet##">
	&nbsp;&nbsp;
	Bet Max&nbsp;
	<input name=EvMaxBet type=text size=8 value="##TP_EvMaxBet##">
	</td>
</tr>
##TP_IF {[OT_CfgGet FUNC_CHANNELS 0]}##
	<tr>
		<td class=caption>Channels</td>
		<td class="table">
		##TP_PLAY chan_sel.html##
		</td>
	</tr>
	<tr>
		<td class=caption>Fastkey</td>
		<td>
		<input type=text name=EvFastkey size=1 value="##TP_EvFastkey##">
		</td>
	</tr>
##TP_ENDIF##
<tr>
	<td colspan=2>&nbsp;</td>
</tr>
<tr class=subtitle>
	<th colspan=2 align=left>Market Selection Prices</th>
</tr>
##TP_IF {[tpGetVar MKT_MR 0]}##
<tr>
	<td class=caption align=right>##TP_DESC_MR##</td>
	<td colspan>&nbsp;Home&nbsp;<input type=text size=8 name=WDWHomeLP value="##TP_WDWHomeLP##">
	Draw&nbsp;<input type=text size=8 name=WDWDrawLP value="##TP_WDWDrawLP##">
	Away&nbsp;<input type=text size=8 name=WDWAwayLP value="##TP_WDWAwayLP##">
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_WL 0]}##
<tr>
<td class=caption align=right>##TP_DESC_WL##</td>
	<td colspan>&nbsp;Home&nbsp;<input type=text size=8 name="WLHomeLP" value="##TP_WLHomeLP##">
	Away&nbsp;<input type=text size=8 name="WLAwayLP" value="##TP_WLAwayLP##">
	</td>
</tr>
<tr><td><input type="hidden" name="WLautogen" value="1"></td></tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_AH 0]}##
<tr>
	<td class=caption>##TP_DESC_AH##</td>
	<td colspan>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="AHautogen" value="1" ##TP_CHECKED_AH##>
	</td>
</tr>
<tr>
	<td class=caption>&nbsp;</td>
	<td colspan>&nbsp;Handicap&nbsp; <select name=MktHcapValue>
	<script>
	    write_select('##TP_MktHcapValue##',
			##TP_IF {![OT_CfgGetTrue FUNC_HCAP_SIDE]}##
								   '-20','-5.0',
				'-19','-4.5/-5.0', '-18','-4.5',
				'-17','-4.0/-4.5', '-16','-4.0',
				'-15','-3.5/-4.0', '-14','-3.5',
				'-13','-3.0/-3.5', '-12','-3.0',
				'-11','-2.5/-3.0', '-10','-2.5',
 				 '-9','-2.0/-2.5',  '-8','-2.0',
 				 '-7','-1.5/-2.0',  '-6','-1.5',
 				 '-5','-1.0/-1.5',  '-4','-1.0',
 				 '-3','-0.5/-1.0',  '-2','-0.5',
				 '-1','-0.0/-0.5',
			##TP_ENDIF##
	         '0','0.0',  '1','0.0/0.5',
	         '2','0.5',  '3','0.5/1.0',
	         '4','1.0',  '5','1.0/1.5',
	         '6','1.5',  '7','1.5/2.0',
	         '8','2.0',  '9','2.0/2.5',
	        '10','2.5', '11','2.5/3.0',
	        '12','3.0', '13','3.0/3.5',
	        '14','3.5', '15','3.5/4.0',
	        '16','4.0', '17','4.0/4.5',
	        '18','4.5', '19','4.5/5.0',
	        '20','5.0')
	</script>
	</select>
	##TP_IF {[OT_CfgGetTrue FUNC_HCAP_SIDE]}##
		<b>&nbsp;added to&nbsp;</b>
		<select name="MktHcapSide">
		<script>
		write_select('##TP_MktHcapSide##','H','Home','A','Away')
		</script>
		</select>
		side
	##TP_ELSE##
		<b>(added to home side)</b>
	##TP_ENDIF##
	<input type=hidden name=MktMakeupValue value="##TP_MktMakeupValue##">
	</td>
</tr>
<tr>
	<td class=caption>&nbsp;</td>
	<td colspan>&nbsp;Home&nbsp;<input type=text size=8 name=AHBHomeLP value="##TP_AHBHomeLP##">
	&nbsp;Away&nbsp;<input type=text size=8 name=AHBAwayLP value="##TP_AHBAwayLP##"></td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_CS 0]}##
<tr>
	<td class=caption>##TP_DESC_CS##</td>
	<td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="CSautogen" value="1" ##TP_CHECKED_CS##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_HF 0]}##
<tr>
	<td class=caption>##TP_DESC_HF##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="HFautogen" value="1" ##TP_CHECKED_HF##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_FS 0]}##
<tr>
    <td class=caption>##TP_DESC_FS##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="FSautogen" value="1" ##TP_CHECKED_FS##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_SC 0]}##
<tr>
    <td class=caption>##TP_DESC_SC##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="SCautogen" value="1" ##TP_CHECKED_SC##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_LS 0]}##
<tr>
    <td class=caption>##TP_DESC_LS##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="LSautogen" value="1" ##TP_CHECKED_LS##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_OU 0]}##
<tr>
    <td class=caption>##TP_DESC_OU##</td>
    <td>
	&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="OUautogen" value="1" ##TP_CHECKED_OU##>
	&nbsp;&nbsp;&nbsp;Over/Under&nbsp;
	<input type=text size=3 name="OU_hcap_value" value="##TP_OU_hcap_value##">
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_TG 0]}##
<tr>
    <td class=caption>##TP_DESC_TG##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="TGautogen" value="1" ##TP_CHECKED_TG##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_OE 0]}##
<tr>
    <td class=caption>##TP_DESC_OE##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="OEautogen" value="1" ##TP_CHECKED_OE##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_SF 0]}##
<tr>
    <td class=caption>##TP_DESC_SF##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="SFautogen" value="1" ##TP_CHECKED_SF##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_H1 0]}##
<tr>
    <td class=caption>##TP_DESC_H1##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="H1autogen" value="1" ##TP_CHECKED_H1##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_H2 0]}##
<tr>
    <td class=caption>##TP_DESC_H2##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="H2autogen" value="1" ##TP_CHECKED_H2##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_TC 0]}##
<tr>
    <td class=caption>##TP_DESC_TC##</td>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="TCautogen" value="1" ##TP_CHECKED_TC##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_HT 0]}##
<tr>
    <td class=caption>##TP_DESC_HT##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="HTautogen" value="1" ##TP_CHECKED_HT##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_GC 0]}##
<tr>
    <td class=caption>##TP_DESC_GC##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="GCautogen" value="1" ##TP_CHECKED_GC##>
	</td>
</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar MKT_QR 0]}##
<tr>
    <td class=caption>##TP_DESC_QR##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="QRautogen" value="1" ##TP_CHECKED_QR##>
	</td>
</tr>
##TP_ENDIF##

##TP_COMMENT Double Chance market##
##TP_IF {[tpGetVar MKT_DC 0]}##
<tr>
    <td class=caption>##TP_DESC_DC##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="DCautogen" value="1" ##TP_CHECKED_DC##>
	</td>
</tr>
##TP_ENDIF##

##TP_COMMENT Goal no Goal market##
##TP_IF {[tpGetVar MKT_GG 0]}##
<tr>
    <td class=caption>##TP_DESC_GG##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="GGautogen" value="1" ##TP_CHECKED_GG##>
	</td>
</tr>
##TP_ENDIF##

##TP_COMMENT Goalscorer market##
##TP_IF {[tpGetVar MKT_GS 0]}##
<tr>
    <td class=caption>##TP_DESC_GS##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="GSautogen" value="1" ##TP_CHECKED_GS##>
	</td>
</tr>
##TP_ENDIF##

##TP_COMMENT Anytime Scorer market##
##TP_IF {[tpGetVar MKT_AG 0]}##
<tr>
    <td class=caption>##TP_DESC_AG##</th>
    <td>&nbsp;Auto-generate?&nbsp;<input type="checkbox" name="AGautogen" value="1" ##TP_CHECKED_AG##>
	</td>
</tr>
##TP_ENDIF##

##TP_IF {[OT_CfgGet OPENBET_CUST ""] == "BlueSQ"} ##
	 <tr>
                <td class=caption>Calendar</td>

                <td><input type=checkbox name="Calendar" ##TP_CALENDAR##></td>
        </tr>
##TP_ENDIF##
<tr>
    <th colspan=2 class=buttons>
    <table border=0 cellspacing=0 cellpadding=0 width=100%>
    <tr>
        <th width=75% class=buttons>
        <input type=button class="btn_def" value="Add Event" onClick="##TP_IF {[OT_CfgGet ENABLE_OVERROUND_WARNING 0 ]}##return doWarningOverround(this,'EvAddFB') ##TP_ELSE## return fs(this,'EvAddFB')##TP_ENDIF##">
        <input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
        </th>
    </tr>
    </table>
    </th>
</tr>
</form>
</table>
</body>
</html>
