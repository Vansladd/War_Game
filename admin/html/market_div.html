<html>
<!-- $Id: market_div.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Forecast/Tricast Dividends</title>

##TP_PLAY JS_WriteSelect.html##

<script>

function validate(f)
{
	return true;
}

var div_id_list = "";

function write_div_id_list()
{
	document.write('<input type="hidden" name="DivIdList" value="' + div_id_list + '">\n');
}

function write_input(name,id,val,size,max)
{
	document.write('<input type="text" name="' + name + '_' + id + '" size=' + size + ' max=' + max + ' value="' + val + '">\n');
}

function write_seln_select(id)
{
	if (id >= 0) {
		write_select(id
			##TP_LOOP seln_idx {[tpGetVar NumSelns]}##
				,##TP_OcListId##,"##TP_OcListDesc##"
			##TP_ENDLOOP##
		);
	} else {
		write_select(id
			,"","n/a"
			##TP_LOOP seln_idx {[tpGetVar NumSelns]}##
				,##TP_OcListId##,"##TP_OcListDesc##"
			##TP_ENDLOOP##
		);
	}
}

function write_div_line(id,type,seln1,seln2,seln3,dividend,b)
{
	if (div_id_list != "") {
		div_id_list += ",";
	}
	div_id_list += id;

	document.write('<tr>\n');

	document.write('<td><b>\n');
	if (type == "TW") {
		document.write("Tote Win");
	} else if (type == "TP") {
		document.write("Tote Place");
	} else if (type == "FC") {
		document.write("Forecast");
	} else if (type == "TC") {
		document.write("Tricast");
	} else {
		document.write("???");
	}
	document.write('</b></td>\n');

	document.write('<td><b>\n');
	document.write(seln1);
	document.write('</b></td>\n');

	document.write('<td><b>\n');
	if (seln2 == "") {
		document.write('&' + 'nbsp;');
	} else {
		document.write(seln2);
	}
	document.write('</b></td>\n');

	document.write('<td><b>\n');
	if (seln3 == "") {
		document.write('&' + 'nbsp;');
	} else {
		document.write(seln3);
	}
	document.write('</b></td>\n');

	document.write('<td>\n');
	write_input('DivAmount',id,dividend,12,12);
	document.write('</td>\n');

	##TP_IF {![tpGetVar opAdd 0] && [tpGetVar PERM_ViewAudit 0] && [tpGetVar NumDivs] > 0}##
		document.write("<td><input type=button class='btn_def' value='View Audit History' onClick='return go_audit\(this," + id + ")'></td>\n");
	##TP_ELSE##
		document.write("<td>&nbsp;</td>");
	##TP_ENDIF##

	document.write('</tr>\n');
}
function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
function go_audit(b,id)
{
	b.form.DivId.value = id;
	fs(b,'GoAudit');
}
</script>

</head>
<body>
##TP_PLAY error_rpt.html##
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	##TP_IF {![tpGetVar opAdd 0] && [tpGetVar PERM_ViewAudit 0]}##
		<th colspan=6 class=buttons>
	##TP_ELSE##
		<th colspan=5 class=buttons>
	##TP_ENDIF##

	##TP_MktDesc## dividends ##TP_EvDesc##
	</th>
</tr>

<form ACTION="##TP_CGI_URL##" method=get onSubmit="return validate(this);">

<tr>
	<th class=colhead>Type</th>
	<th class=colhead>1<sup>st</sup></th>
	<th class=colhead>2<sup>nd</sup></th>
	<th class=colhead>3<sup>rd</sup></th>
	<th class=colhead>Dividend</th>
	##TP_IF {![tpGetVar opAdd 0] && [tpGetVar PERM_ViewAudit 0]}##
		<th class=colhead>Audit History</th>
	##TP_ENDIF##

</tr>
<script>
##TP_LOOP div_idx {[tpGetVar NumDivs]}##
	write_div_line(
		"##TP_DivId##",
		"##TP_DivType##",
		"##TP_DivSeln1##",
		"##TP_DivSeln2##",
		"##TP_DivSeln3##",
		"##TP_DivAmount##");
##TP_ENDLOOP##
</script>

<script>
	write_div_id_list();
</script>

##TP_IF {[tpGetVar AllowDDCreation 0]}##
	<tr>
		<td>
		<select name="NewDivType">
			<script>write_select(
				'FC',
				'FC','Forecast','TC','Tricast'
				##TP_IF {[OT_CfgGetTrue FUNC_USE_TOTE_DIV]}##
				,'TW','Tote Win','TP','Tote Place'
				##TP_ENDIF##
			);</script>
		</select>
		</td>
		<td>
		<select name="NewDivSeln1">
			<script>write_seln_select(0);</script>
		</select>
		</td>
		<td>
		<select name="NewDivSeln2">
			##TP_IF {[OT_CfgGetTrue FUNC_USE_TOTE_DIV]}##
			<script>write_seln_select(-1);</script>
			##TP_ELSE##
			<script>write_seln_select(0);</script>
			##TP_ENDIF##
		</select>
		</td>
		<td>
		<select name="NewDivSeln3">
			<script>write_seln_select(-1);</script>
		</select>
		</td>
		<td>
		<input type="text" name="NewDivAmount" size=12 value="">
		</td>
	</tr>
##TP_ENDIF## <!--AllowDDCreation -->

<tr>
	<th colspan=5 class=buttons>
	<input type=hidden name="EvId"  value="##TP_EvId##">
	<input type=hidden name="MktId" value="##TP_MktId##">
	##TP_IF {[op_allowed SetResults]}##
		<input type=button class="btn_def" value="Update Dividends" onClick="return fs(this,'UpdDivs')">
	##TP_ENDIF##
	<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
	</th>
	##TP_IF {![tpGetVar opAdd 0] && [tpGetVar PERM_ViewAudit 0]}##
		<th class=buttons><input type=button class="btn_def" value="View Audit for Deleted Dividends" onclick="return fs(this,'GoAuditMktDivDel')"></th>
		<input type=hidden name=DivId value="">
		<input type=hidden name=AuditInfo value="MktDiv">
	##TP_ENDIF##
</tr>

<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::MARKET::DoMktDiv>
</form>
</table>
<p>
To delete a dividend, blank the field and submit the form.
</p>
</body>
</html>
