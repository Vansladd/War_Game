<html>
<!-- $Id: collection_upd.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Update Collection Details</title>
<script language="JavaScript">

// Accepts digits only
var regex_disporder = /^[0-9]*$/;
var db_sport_id  = ##TP_TCL {tpBufWrite [tpGetVar DbSelectedSportId]} ## ;
var db_disporder = ##TP_CollectionDisp## ;
var db_name      = "##TP_CollectionName##" ;
var set_all_links_selected = true ;

##TP_IF {[tpGetVar CollectionExp] == "Y" } ##
var db_expanded  = true ;
##TP_ELSE##
var db_expanded  = false ;
##TP_ENDIF##

function has_details_changed (b)
{
	if ( (b.form.name.value            == db_name)      &&
	     (b.form.disporder.value       == db_disporder) &&
	     (b.form.SelectedSportId.value == db_sport_id ) &&
	     (b.form.expanded.checked      == db_expanded )
	) {
		return 0;
	} else {
		return 1;
	}
}

function check_valid (b,t)
{	
	if (b.form.name.value == "" || b.form.disporder.value == "") {
		alert ("Please enter missing data")
		return false;
	} else if ( !regex_disporder.test(b.form.disporder.value)) {
		alert ("Please enter a valid display order value")
	} else if ( !has_details_changed(b) ) {
		alert ("Collection details have not changed");
	} else {
		b.form.expanded.value = b.form.expanded.checked;
		return fs(b,t);
	}
}

function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function remove_group_links(b) {

	numDelBoxes = b.form.delBoxes.length ;
	delLinksList = "" ;

	if (!numDelBoxes ) {
		// We only have 1 entry, the delBoxes.length check picks up nothing
		// so access the one field manually
		if ( b.form.delBoxes.checked ) {
			delLinksList = delLinksList + b.form.delBoxes.value ;
		}
	} else {
		// deal with multiple check boxes
		for (i = 0; i < numDelBoxes; i++) {
			if ( b.form.delBoxes[i].checked ) {
				delLinksList = delLinksList + b.form.delBoxes[i].value + "," ;
			}
		}
	}

	if ( delLinksList == "" ) {
		alert ("There are no market groups selected to unlink.") ;
	} else {
		action = "ADMIN::COLLECTION::RemoveMktGroupLink&CollectionId=##TP_CollectionId##&delMktGroupLinksList=" + delLinksList ;

		url = "##TP_CGI_URL##?action=" + action;
		document.location.href = url;
	}
}

function select_unselect_all(b) {

	numDelBoxes = b.form.delBoxes.length ;

	if (!numDelBoxes ) {
		// We only have 1 entry, the delBoxes.length check picks up nothing
		// so access the one field manually

	 	b.form.delBoxes.checked = set_all_links_selected ;
	} else {
		// deal with multiple check boxes
		for (i = 0; i < numDelBoxes; i++) {
			b.form.delBoxes[i].checked = set_all_links_selected
		}
	}

	if (set_all_links_selected) {
		set_all_links_selected = false ;
		b.form.select_unselect.value = "Unselect all"
		
	} else {
		set_all_links_selected = true ;
		b.form.select_unselect.value = "Select all"
	}
}

</script>
</head>

<body>

##TP_PLAY error_rpt.html##
##TP_PLAY msg_rpt.html##

<form method="get" action="##TP_CGI_URL##" name="collectionFm">
	<input type="hidden" name="action" value="ADMIN::COLLECTION::GoCollection" />
	<input type="hidden" name="CollectionId" value="##TP_CollectionId##" />

	##TP_IF {[tpGetVar CurrentDisp] == [tpGetVar primaryDisp] } ##
		<input type="hidden" name="isPrimary" value="Yes" />
	##TP_ELSE##
		<input type="hidden" name="isPrimary" value="No" />
	##TP_ENDIF##

	<input type="hidden" name="SubmitName" value="" />

<table cellspacing="0" cellpadding="2" border="0">

	<tr>
		<th colspan="4" class="title">
			Update Collection Details
		</th>
	</tr>

##TP_IF {[tpGetVar NumSports 0]}##

	<tr>
		<td class="caption">Sport:</td>

		<td >

			##TP_IF {[tpGetVar NumLinkedMktGrp 0]}##
				<input type=hidden type="text" name="SelectedSportId" value="##TP_TCL {tpBufWrite [tpGetVar DbSelectedSportId]} ##" maxlength="50" />
				<input disabled="true" type="text" name="" value="##TP_TCL {tpBufWrite [tpGetVar SelectedSport]} ##" maxlength="50" />
			##TP_ELSE##
			<select  name="SelectedSportId" >

		
				##TP_LOOP sport_idx {[tpGetVar NumSports]}##
	
					##TP_IF {[tpGetVar SelectedIdx] == [tpGetVar sport_idx] } ##
						<option value="##TP_sportId##" selected="selected">##TP_sportName##</option>
					##TP_ELSE##
						<option value="##TP_sportId##">##TP_sportName##</option>
					##TP_ENDIF##
	
				##TP_ENDLOOP##
				
			</select>
		##TP_ENDIF##
		</td>

		<td >Disp Order:</td>
		<td>
		<input type="text" name="disporder" value="##TP_CollectionDisp##" maxlength="5" size=5 />
		</td>
	</tr>
	<tr>
		<td class="caption">Name:</td>
		<td colspan="1">
			<input  type="text" name="name" value="##TP_CollectionName##" maxlength="50" size=30 />		
		</td>
	</tr>

	<tr>
		<td class="caption">Expanded?:</td>

		##TP_IF {[tpGetVar CollectionExp] == "Y" } ##
			<td >
				<input checked name="expanded" type="checkbox" value = ""  >	
			</td>
		##TP_ELSE##
			<td >
				<input name="expanded" type="checkbox" value = ""  >
			</td >
		##TP_ENDIF##

		##TP_IF {[tpGetVar CurrentDisp] == [tpGetVar primaryDisp] } ##
			<td >Primary collection for sport?:</td>
			<td ><b>Yes</b></td>
		##TP_ELSE##
			<td ><b>Set display order to 0 to make this a primary collection</b></td>
		##TP_ENDIF##

	</tr>
</table>

<table cellspacing="0" cellpadding="2" border="0">
##TP_IF {[tpGetVar NumLinkedMktGrp 0]}##
	<tr>
		<td><b> Linked Market Groups </b></td>
		<td colspan="3">	
		</td>
	</tr>
	<tr>
		<th colspan="1"  class=colhead><A HREF="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollection&SubmitName=GotoUpd&order=group&CollectionId=##TP_CollectionId##">Market Group</A></th>
		<th colspan="2"  class=colhead><A HREF="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollection&SubmitName=GotoUpd&order=type&CollectionId=##TP_CollectionId##">Event Type</A></th>
	
		##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
			<th colspan="1" class=colhead>Select to remove link</th>
		##TP_ENDIF##
	</tr>

	##TP_LOOP col_mkt_grp_idx {[tpGetVar NumLinkedMktGrp]}##
	
	<tr>
		<td colspan="1">##TP_mktGroupName##</td>
		<td colspan="2">##TP_typeName##</td>
	
		##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
			<td colspan="1"> <input  name="delBoxes" type="checkbox" value = "##TP_mktGroupId##"  > </td>
		##TP_ENDIF##
	</tr>
	##TP_ENDLOOP##

	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
		<tr>
			<th class="buttons" colspan=1>
				<input type="button" value="Add link" onClick="return fs(this,'GoAddMktGrpLinkHub')" />
			</th>
			<th class="buttons" colspan=1>
				
				<input type="button" value="Remove link" onClick="remove_group_links(this)" />
			</th>
			<th class="buttons" colspan=2>
				
				<input type="button" name="select_unselect" value="Select all" onClick="select_unselect_all(this)" />
			</th>
		</tr>
	##TP_ENDIF##
</table>

##TP_ELSE##
	<tr>
		<td> &nbsp;&nbsp;</td>
		<td colspan="4">	
		</td>
	</tr>
	<tr>
		<td colspan=4>
		<b><i>There are no market groups linked to this collection</i></b>
		</td>
	</tr>
	<tr>
		<td> &nbsp;&nbsp;</td>
		<td colspan="4">	
		</td>
	</tr>
	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
		<tr>
			<th class="buttons" colspan=4>
				<input type="button" value="Add link" onClick="return fs(this,'GoAddMktGrpLinkHub')" />
			</th>
		</tr>
	##TP_ENDIF##

##TP_ENDIF##

<table>

	<tr>
		<td colspan=3>
		<b><i>Confirm collection details changes:</i></b>
		</td>
	</tr>

	<tr>
		##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
			<th class="buttons" colspan=1>
				<input type="button" value="Ok" onClick="return check_valid(this,'DoUpd')" />
			</th>
		##TP_ENDIF##
		<th class="buttons" colspan=3>
			
			<input type="button" value="Cancel" onClick="return fs(this,'Back')" />
		</th>
	</tr>

</table>
##TP_ELSE##
<tr>
	<td colspan=4>
	<b><i>There are no event sports defined</i></b>
	</td>
</tr>
##TP_ENDIF##

</form>

</body>
</html>
