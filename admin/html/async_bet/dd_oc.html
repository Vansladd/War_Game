##TP_COMMENT $Id: dd_oc.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $##
##TP_COMMENT Copyright (c) 2005 Orbis Technology Ltd. All rights reserved.##

<!-- Drill-Down Outcome -->
<tr id="oc_##TP_leg_leg_no##_##TP_leg_part_no##" style="display:none">

	<td colspan="5" class="bordered_col">
		<table cellspacing="0" cellpadding="2" class="bordered_table">
			<tr>

				<!-- Outcome Detais -->
				<td width="80%" valign="top">
					<table cellspacing="0" cellpadding="2" class="bordered_table" width="96%">
						##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
							<form action="##TP_CGI_URL##" name="oc_##TP_leg_leg_no##_##TP_leg_part_no##" method="get">
							<input type="hidden" name="action" value="ADMIN::ASYNC_BET::DoUpdDDOc">
							<input type="hidden" name="ev_oc_id" value="##TP_leg_ev_oc_id##">
							<input type="hidden" name="lp_avail" value="##TP_leg_mkt_lp_avail##">
							<input type="hidden" name="sp_avail" value="##TP_leg_mkt_sp_avail##">
							<input type="hidden" name="bet_id" value="##TP_bet_id##">
							<input type="hidden" name="bet_group_id" value="##TP_bet_group_id##">
							<input type="hidden" name="selected_leg" value="">
							<input type="hidden" name="selected_dd" value="">
						##TP_ENDIF##

						##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],ev_oc_id) == [tpGetVar DD_EV_OC_ID ""]}##
							##TP_IF {[tpGetVar IsError 0]}##
								<tr id="dd_update_msg_oc_##TP_leg_leg_no##_##TP_leg_part_no##">
									<th class="subcaption" colspan="2" style="color: red">
										Error: while updating ##TP_leg_oc_name## Event Selection Details
										<br>##TP_ErrMsg## ##TP_ERROR## ##TP_ErrorSite##
									</td>
								</tr>
							##TP_ELSE##
								<tr id="dd_update_msg_oc_##TP_leg_leg_no##_##TP_leg_part_no##">
									<th class="subcaption" colspan="2" style="color: green">
										Successfully updated ##TP_leg_oc_name## Event Selection Details
									</td>
								</tr>
							##TP_ENDIF##
						##TP_ENDIF##
						<tr id="dd_caption_oc_##TP_leg_leg_no##_##TP_leg_part_no##" ##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],ev_oc_id) == [tpGetVar DD_EV_OC_ID ""]}##style="display:none"##TP_ENDIF##>
							<th class="subtitle" colspan="2">
								##TP_leg_oc_name## Event Selection Details
							</td>
						</tr>

						<tr>
							<td class="caption">Status</td>
							<td>
								##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
									<select name="status">
										<script>
											write_select('##TP_leg_oc_status##','A','Active','S','Suspended')
										</script>
									</select>
								##TP_ELSE##
									##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],oc_settled) == "Y"}##
										Settled
									##TP_ELSEIF {$ASYNC(leg,[tpGetVar leg_idx],oc_result_conf) == "Y"}##
										Result Confirmed
									##TP_ELSE##
										Result Set
									##TP_ENDIF##
									&nbsp;
									(<script>write_which('##TP_leg_oc_result##', 'W', 'Win', 'P', 'Place', 'L', 'Lose', 'V', 'Void', 'H', 'Settled against market handicap', 'N', 'None')</script>)
								##TP_ENDIF##
							</td>
						</tr>

						##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
							<tr>
								<td class="caption">Displayed</td>
								<td>
									<select name="displayed">
										<script>
											write_select('##TP_leg_oc_displayed##', 'Y','Yes','N','No');
										</script>
									</select>
								</td>
							</tr>

							<tr>
								<td class="caption">Stake Limits</td>
								<td>
									Min:&nbsp;<input name="min_bet" id="oc_min_bet" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_min_bet##" onblur="ensureInputElemCanonical(this);">
									##TP_IF {[OT_CfgGet FUNC_MAX_WIN_MULTIPLES 0]}##
									Max Multiple Bet:&nbsp;
									<input name="max_mult_bet" type="text" value="##TP_leg_oc_max_multiple_bet##" size=12>&nbsp;<i>##TP_leg_oc_f_max_multiple_bet##</i>
									##TP_ELSE##
									<input name="max_mult_bet" type="hidden" value="##TP_leg_oc_max_multiple_bet##">
									##TP_ENDIF##
								</td>
							</tr>

							<!-- Non-handicap markets have option on flipping price at stake or -->
							<!-- liability, handicap markets flip on liability -->
							##TP_IF {[string first $ASYNC(leg,[tpGetVar leg_idx],mkt_type) "AHMSCULl"] < 0}##
								<tr>
									<td class="caption">Max total</td>
									<td>
										##TP_IF {[string first $ASYNC(leg,[tpGetVar leg_idx],mkt_type) "AHM"] < 0}##
											<script>
												write_which('##TP_leg_oc_stk_or_lbt##','S','Stake','L','Liability')
											</script>
											<input type="hidden" name="stk_or_lbt" value="##TP_leg_oc_stk_or_lbt##">
										##TP_ELSE##
											<b>Liability</b>
											<input type="hidden" name="stk_or_lbt" value="L">
										##TP_ENDIF##
										<input type="text" name="max_total" id="oc_max_total" class="canonicalMoney" size="12" value="##TP_TCL {tpBufWrite [comma_num_str [tpBindGet leg_oc_max_total]]}##" onblur="ensureInputElemCanonical(this);">
										&nbsp;<b>(current total ##TP_TCL {tpBufWrite [comma_num_str [tpBindGet leg_oc_cur_total]]}##)</b>
									</td>
								</tr>
							##TP_ELSE##
								<tr>
									##TP_IF {[tpBindGet leg_mkt_apc_status] == "A"}##
										<td class="caption">Price change at</td>
									##TP_ELSE##
										<td class="caption">Liability</td>
									##TP_ENDIF##
									<td align=left>
										<input type="hidden" name="stk_or_lbt" value="L">
										##TP_IF {[tpBindGet leg_mkt_apc_status] == "A"}##
											&nbsp;<b>liability</b>
										##TP_ENDIF##
										<input type="text" name="max_total" id="oc_max_total" class="canonicalMoney" size="10" value="##TP_TCL {tpBufWrite [comma_num_str [tpBindGet leg_oc_max_total]]}##" onblur="ensureInputElemCanonical(this);">
										&nbsp;<b>(current total ##TP_TCL {tpBufWrite [comma_num_str [tpBindGet leg_oc_cur_total]]}##)</b>
									</td>
								</tr>
							##TP_ENDIF##
							##TP_IF {[OT_CfgGet FUNC_LAY_TO_LOSE 0]}##
								<tr>
									<td class="caption">Max Bet (LP):</td>
									<td>
										<input name="lp_max_bet" id="oc_lp_max_bet" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_lp_max_bet##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxWin## />
										<b>Max Bet SP:</b>&nbsp;<input name="sp_max_bet" id="oc_sp_max_bet" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_sp_max_bet##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxWin## />
										##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpBindGet leg_category]] != -1}##
											<b>Max Bet (EP):</b>&nbsp;<input name="ep_max_bet" id="oc_ep_max_bet" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_ep_max_bet##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxWin## />
										##TP_ENDIF##
										<b>Lock WIN:</b><input type="checkbox" name="lock_win_stk_lmt" class="canonicalMoney" ##TP_LOCK_WIN_STAKE_LIMITS## />
									</td>
								</tr>
								<tr>
									<td class="caption">Max Place (LP):</td>
									<td>
										<input name="lp_max_place" id="oc_lp_max_place" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_lp_max_place##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxPlace## />
										<b>Max Place (SP):</b>&nbsp;<input name="sp_max_place" id="oc_sp_max_place" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_sp_max_place##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxPlace## />
										##TP_IF { [lsearch [OT_CfgGet EP_AVAILABLE_CLASSES "GREYHOUNDS HORSE_RACING"] [tpBindGet leg_category]] != -1}##
											<b>Max Place (EP):</b>&nbsp;<input name="ep_max_place" id="oc_ep_max_place" class="canonicalMoney" type="text" size="12" value="##TP_leg_oc_ep_max_place##" onblur="ensureInputElemCanonical(this);" ##TP_DisableMaxPlace## />
										##TP_ELSE##
											<input type="hidden" name="ep_max_bet" class="canonicalMoney" value="##TP_leg_oc_ep_max_bet##" />
		                                                                	<input type="hidden" name="ep_max_place" class="canonicalMoney" value="##TP_leg_oc_ep_max_place##" />
										##TP_ENDIF##
										<b>Lock PLACE:</b><input type="checkbox" name="lock_place_stk_lmt" class="canonicalMoney" ##TP_LOCK_PLACE_STAKE_LIMITS## />
									</td>
								</tr>
							##TP_ELSE##
								<input type="hidden" name="lp_max_bet" class="canonicalMoney" value="##TP_leg_oc_lp_max_bet##" />
								<input type="hidden" name="sp_max_bet" class="canonicalMoney" value="##TP_leg_oc_sp_max_bet##" />
								<input type="hidden" name="lp_max_place" class="canonicalMoney" value="##TP_leg_oc_lp_max_place##" />
								<input type="hidden" name="sp_max_place" class="canonicalMoney" value="##TP_leg_oc_sp_max_place##" />
								<input type="hidden" name="ep_max_bet" class="canonicalMoney" value="##TP_leg_oc_ep_max_bet##" />
								<input type="hidden" name="ep_max_place" class="canonicalMoney" value="##TP_leg_oc_ep_max_place##" />
							##TP_ENDIF##
							##TP_IF {[OT_CfgGet FUNC_FCTC_STK_LIMITS 0]}##
								<tr>
									<td class="caption">Forecast Stake Limit</td>
									<td><input type="text" size="4" name="fc_stk_limit" class="canonicalMoney" value="##TP_leg_oc_fc_stk_limit##">
									&nbsp;&nbsp;&nbsp;<b>Tricast Stake Limit</b>
									<input type="text" size="8" name="tc_stk_limit" class="canonicalMoney" value="##TP_leg_oc_tc_stk_limit##"></td>
								</tr>
							##TP_ELSE##
								<input type="hidden" name="fc_stk_limit" class="canonicalMoney" value="##TP_leg_oc_fc_stk_limit##" />
								<input type="hidden" name="tc_stk_limit" class="canonicalMoney" value="##TP_leg_oc_tc_stk_limit##" />
							##TP_ENDIF##
						##TP_ENDIF oc_update##

						<tr>
							<td class="caption">Price</td>
							<td>
								##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],mkt_lp_avail) == "Y"}##
									##TP_IF {[op_allowed UpdEvOcPrice] && $ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
										<b>Fixed:</b>&nbsp;
										<input name="lp" type="text" size="8" value="##TP_leg_oc_lp##">
									##TP_ELSE##
										Fixed ##TP_leg_oc_lp##
									##TP_ENDIF##
									&nbsp;&nbsp;&nbsp;&nbsp;
								##TP_ELSE##
									<input type="hidden" name="lp" value="##TP_leg_oc_lp##">
								##TP_ENDIF##
								##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],mkt_sp_avail) == "Y"}##
									##TP_IF {[op_allowed UpdEvOcPrice] && $ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
										<b>SP Guide:</b>&nbsp;
										<input name="sp" type="text" size="8" value="##TP_leg_oc_sp##">
									##TP_ELSE##
										SP Guide ##TP_leg_oc_sp##
									##TP_ENDIF##
								##TP_ELSE##
									<input type="hidden" name="sp" value="##TP_leg_oc_sp##">
								##TP_ENDIF##
							</td>
						</tr>

						##TP_IF {[op_allowed ManageEvOc] && $ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
						<tr>
							<th class="buttons" colspan="2">
								<input type="button" class="btn_def" value="Update" onclick="updDDOc(this, 'oc_##TP_leg_leg_no##_##TP_leg_part_no##')">&nbsp;&nbsp;&nbsp;&nbsp;
							</th>
						</tr>
						##TP_ENDIF##

						##TP_IF {$ASYNC(leg,[tpGetVar leg_idx],oc_update)}##
							</form>
						##TP_ENDIF##
					</table>
				</td>
				<!-- End of Outcome Detais -->

				<!-- Price History -->
				<td valign="top">
					<table cellspacing="0" cellpadding="2" class="bordered_table" witdth="90%">

						<tr><th class="subtitle" colspan="3">Price History</th></tr></tr>

						<tr>
							<th nowrap class="colhead" style="padding-right: 6px">Date</th>
							<th nowrap class="colhead" style="padding-right: 6px">Price</th>
							<th nowrap class="colhead">Status</th>
						</tr>

						##TP_LOOP price_idx {$ASYNC(price,nrows)}##
							##TP_IF {$ASYNC(price,[tpGetVar price_idx],ev_oc_id) == $ASYNC(leg,[tpGetVar leg_idx],ev_oc_id)}##
								<tr>
									<td style="padding-right: 6px">##TP_price_cr_date##</td>
									<td style="padding-right: 6px">##TP_price_price##</td>
									<td>##TP_price_status##</td>
								</tr>
							##TP_ENDIF##
						##TP_ENDLOOP price_idx##

					</table>
				</td>
				<!-- End Of Price History -->

			</tr>
		</table>
	</td>

</tr>
<!-- End of Drill-Down Outcome -->
