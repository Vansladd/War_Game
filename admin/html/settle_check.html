<html>
<head>
<title>Check Settlement Results</title>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<script language=JavaScript>
function fs(b,t) {
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
</script>
</head>

<body>
<table cellspacing=0 cellpadding=2 border=0>
<tr>
	<th colspan=9 class=title>
	##TP_IF {![tpGetVar NoBetsAffected]}##
	0 customers affected by selection/market change-
	##TP_ENDIF##
	Check Settlement Results</th>
</tr>
</table>
<br>
<form name=resettle action="##TP_CGI_URL##" method=post>
##TP_IF {$EVMKT(num) > 0} ##
	##TP_LOOP mkt_idx $EVMKT(num)##
	<table cellspacing=0 cellpadding=2 border=0>
	<tr>
		<th class=colhead colspan=4>##TP_MktDesc##</th>
		<th class=colhead>
		<a href="##TP_CGI_URL##?action=ADMIN::SETTLE::DelSettleCheck&type=M&id=##TP_MktId##">DELETE</a>
		</th>
	</tr>

	<tr>
		<th class=colhead colspan=5>No. of unsettled bets for market: ##TP_MktNumUnStl##</th>
	</tr>
	##TP_IF {$EVMKT([tpGetVar mkt_idx],mkt_sort) == {AH} || $EVMKT([tpGetVar mkt_idx],mkt_sort) == {WH}}##
	<tr>
		<th class="colhead">Handicap Makeup</th>
		<th class="colhead">New Handicap</th>
		<th class="colhead">&nbsp;</th>
		<th class="colhead">&nbsp;</th>
	</tr>
	<tr>
		<td>##TP_HcapMakeup##</td>
		<td><input type=text name=hcap-makeup_##TP_MktId## value=""></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
	##TP_ENDIF##

	<!--Output Rule 4 for GR & HR markets-->
	##TP_IF {$EVMKT([tpGetVar mkt_idx],class_sort) == {GR} || $EVMKT([tpGetVar mkt_idx],class_sort) == {HR}}##
	<tr>
		<th class="colhead" colspan="5">Rule 4</th>
	</tr>

	<tr>
		<th class="colhead">Market</th>
		<th class="colhead">Start Time</th>
		<th class="colhead">End Time</th>
		<th class="colhead">Deduction</th>
		<th class="colhead">Disable Rule 4</th>
	</tr>

	##TP_LOOP r4_idx {$EVMKT([tpGetVar mkt_idx],num_rule_fours)}##
	<tr>
		<td>
			<select name=r4-mkt_##TP_MktId##_##TP_Rule4Id##>
			<option value="L">L</option>
			<option value="S">S</option>
			</select>
		</td>
		<td><input type=text name=r4-st_##TP_MktId##_##TP_Rule4Id## value=""></td>
		<td><input type=text name=r4-et_##TP_MktId##_##TP_Rule4Id## value=""></td>
		<td><input type=text name=r4-deduction_##TP_MktId##_##TP_Rule4Id## value=""></td>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td>##TP_Type##</td>
		<td>##TP_TimeFrom##</td>
		<td>##TP_TimeTo##</td>
		<td>##TP_Deduction##</td>
		<td><input type="checkbox" name="rule4-del_##TP_MktId##_##TP_Rule4Id##" value="1"></td>
	</tr>
	##TP_ENDLOOP##

	##TP_LOOP rule4_idx {2}##
	<tr>
		<td>
			<select name=r4-mkt_##TP_MktId##_no##TP_TCL {tpBufWrite [tpGetVar rule4_idx]}##>
			<option value="L">L</option>
			<option value="S">S</option>
			</select>
		</td>
		<td><input type=text name=r4-st_##TP_MktId##_no##TP_TCL {tpBufWrite [tpGetVar rule4_idx]}## value=""></td>
		<td><input type=text name=r4-et_##TP_MktId##_no##TP_TCL {tpBufWrite [tpGetVar rule4_idx]}## value=""></td>
		<td><input type=text name=r4-deduction_##TP_MktId##_no##TP_TCL {tpBufWrite [tpGetVar rule4_idx]}## value=""></td>
		<td>&nbsp;</td>
	</tr>
	##TP_ENDLOOP##

	##TP_ENDIF##

	<!--List of all dividends for the market-->
	##TP_IF {$EVMKT([tpGetVar mkt_idx],class_sort) == {HR} || $EVMKT([tpGetVar mkt_idx],class_sort) == {GR}}##
	<tr>
		<th class="colhead" colspan="6">Dividends</th>
	</tr>

	<tr>
		<th class="colhead">Type</th>
		<th class="colhead">1st</th>
		<th class="colhead">2nd</th>
	    <th class="colhead">3rd</th>
		<th class="colhead">Dividend</th>
		<th class="colhead">Disable Dividend</th>
	</tr>

	##TP_LOOP div_idx {$EVMKT([tpGetVar mkt_idx],num_dividends)}##
	<tr>
		<td>##TP_DivType##</td>
		<td>##TP_DivSeln1##</td>
		<td>##TP_DivSeln2##</td>
		<td>##TP_DivSeln3##</td>
		<td>##TP_Dividend##</td>
		<td><input type="checkbox" name="dtype-del_##TP_MktId##_##TP_DivId##" value="1"></td>
	</tr>

	<tr>
		<td>
		<select name="dtype-mkt_##TP_MktId##_##TP_DivId##">
		<option value="FC">FC</option>
		<option value="TC">TC</option>
		<option value="TW">TW</option>
		<option value="TP">TP</option>
		</select>
		</td>
		##TP_LOOP count_idx {3}##
		<td>
		<select name="div-seln##TP_TCL {tpBufWrite [tpGetVar count_idx]}##_##TP_MktId##_##TP_DivId##">
		<option value="">n/a</option>
		##TP_LOOP div_oc_idx {$EVMKT([tpGetVar mkt_idx],num_ocs)}##
		<option value="##TP_DivEvOcId##">##TP_DivOcDesc##</option>
		##TP_ENDLOOP##
		</select>
		</td>
		##TP_ENDLOOP##
		<td><input type=text name=dividend_##TP_MktId##_##TP_DivId## value=""></td>
	</tr>
	##TP_ENDLOOP##

	<tr>
		<td>
		<select name="dtype-mkt_##TP_MktId##_unique">
		<option value="FC">FC</option>
		<option value="TC">TC</option>
		<option value="TW">TW</option>
		<option value="TP">TP</option>
		</select>
		</td>

		##TP_LOOP count_idx {3}##
		<td>
		<select name="div-seln##TP_TCL {tpBufWrite [tpGetVar count_idx]}##_##TP_MktId##_unique">
		<option value="">n/a</option>
		##TP_LOOP div_oc_idx {$EVMKT([tpGetVar mkt_idx],num_ocs)}##
		<option value="##TP_DivEvOcId##">##TP_DivOcDesc##</option>
		##TP_ENDLOOP##
		</select>
		</td>
		##TP_ENDLOOP##
		<td><input type=text name=dividend_##TP_MktId##_unique value=""></td>
	</tr>
	##TP_ENDIF##

	<!-- Allow each way terms to be modified when necessary-->
	##TP_IF {$EVMKT([tpGetVar mkt_idx],class_sort) == {HR} || $EVMKT([tpGetVar mkt_idx],class_sort) == {GR} && $EVMKT(([tpGetVar mkt_idx],is_ew) == {Y}}##
	<tr>
		<th class="colhead" colspan="5">Each Way</th>
	</tr>
	<tr>
		<th class=colhead>Place</th>
		<th class=colhead>New Place</th>
		<th class=colhead>Price</th>
		<th class=colhead>New Price (fractional)</th>
	</tr>
	<tr>
		<td>##TP_MktEwPlace##</td>
		<td><input type=text name=ew-place_##TP_MktId## value= "" size=3></td>
		<td>##TP_MktEwNum##/##TP_MktEwDen##</td>
		<td><input type=text name=ew-price_##TP_MktId## value= "" size=3></td>
	</tr>
	##TP_ENDIF##
	<tr>
		<td>Bets created after</td>
		<td><input type=text name=mkt-cr-after_##TP_MktId## value="" size=20></td>
	</tr>
	<tr>
		<td>Bet settled after</td>
		<td><input type=text name=mkt-stl-after_##TP_MktId## value="" size=20></td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
	</table>
	##TP_ENDLOOP##
##TP_ENDIF##
<br>
##TP_IF {$EVOC(num) > 0} ##
	##TP_LOOP oc_idx $EVOC(num)##
	<table cellspacing=0 cellpadding=2 border=0>
	<tr>
		<th class=colhead colspan=7>##TP_OcDesc##</th>
		<th class=colhead colspan=7>
		<a href="##TP_CGI_URL##?action=ADMIN::SETTLE::DelSettleCheck&type=O&id=##TP_OcId##">DELETE</a>
		</th>
	</tr>

	<tr>
		<th class=colhead colspan=17>No. of unsettled bets for selection: ##TP_OcNumUnStl##</th>
	</tr>

	<tr>
		<th class=colhead>Result</th>
		<th class=colhead>New Result</th>

		##TP_IF {$EVOC([tpGetVar oc_idx],place_avail)}##
			<th class=colhead>SP</th>
			<th class=colhead>New SP (fractional)</th>
			<th class=colhead>Place</th>
			<th class=colhead>New Place</th>
			<th class=colhead>Dead Heat (win)</th>
			<th class=colhead>New Dead Heat (win)</th>
			##TP_IF {[tpGetVar NumTerms 0] > 0}##
				<th class=colhead colspan=##TP_ColSpan##>Each Way Terms<br>
			##TP_ELSE##
				<th class=colhead>Dead Heat (place)</th>
				<th class=colhead>New Dead Heat (place)</th>
			##TP_ENDIF##
		##TP_ELSE##
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
			<th>&nbsp;</th>
		##TP_ENDIF##

	</tr>
		##TP_IF {[tpGetVar NumTerms 0] > 0}##
			<tr><th class=colhead colspan=8></th>
		##TP_ENDIF##
		##TP_LOOP terms_idx {[tpGetVar NumTerms 0]}##
			<th class=colhead> ##TP_TERMS_ew_places##@##TP_TERMS_ew_fac_num##/##TP_TERMS_ew_fac_den## </th>
		##TP_ENDLOOP##
		##TP_IF {[tpGetVar NumTerms 0] > 0}##
			</tr>
		##TP_ENDIF##
	<tr>
		<td>##TP_Result##</td>
		<td>
		<select name=result_##TP_OcId##>
		##TP_LOOP result_idx {$EVOC([tpGetVar oc_idx],numResult)}##
		<option value="##TP_ResultVal##" ##TP_IF {$EVOC([tpGetVar oc_idx],[tpGetVar result_idx],flag) == $EVOC([tpGetVar oc_idx],result)}## selected ##TP_ENDIF##>##TP_ResultDesc##</option>
		##TP_ENDLOOP##
		</select>
		</td>

		##TP_IF {$EVOC([tpGetVar oc_idx],place_avail)}##
		<td>##TP_SP##</td>
		<td><input type=text name=sp_##TP_OcId## value="" size=3></td>
		<td>##TP_Place##</td>
		<td><input type=text name=place_##TP_OcId## value="" size=3></td>
		##TP_IF {[tpGetVar NumTerms 0]>0}##
			<input type="hidden" name="EW_terms" value="##TP_EW_terms##">
			<td>
				##TP_IF {[tpGetVar HasWinDH 0]}##
					##TP_TCL -quiet {tpBufWrite "$w_dh_num([tpBindGet OcId]) / $w_dh_den([tpBindGet OcId])"}##
				##TP_ELSE##
					1/1
				##TP_ENDIF##
			</td>
			<td><input type=text name=wdh_##TP_OcId## value="" size=6></td>
			##TP_LOOP terms_idx {[tpGetVar NumTerms 0]}##
				<td>##TP_TCL -quiet {tpBufWrite "$p_dh_num([tpBindGet TERMS_ew_terms_id],[tpBindGet OcId]) / $p_dh_den([tpBindGet TERMS_ew_terms_id],[tpBindGet OcId])"}##
				<input type="text" name="pdh_##TP_OcId##_##TP_TERMS_ew_terms_id##" size="3"</td>
			##TP_ENDLOOP##
		##TP_ELSE##
			<td>
				##TP_IF {[tpGetVar HasWinDH 0]}##
					##TP_TCL -quiet {tpBufWrite "$w_dh_num([tpBindGet OcId]) / $w_dh_den([tpBindGet OcId])"}##
				##TP_ELSE##
					1/1
				##TP_ENDIF##
			</td>
			<td><input type="text" name="wdh_##TP_OcId##" value="" size="6"></td>
			<td>
				##TP_IF {[tpGetVar HasPlaceDH 0]}##
					##TP_TCL -quiet {tpBufWrite "$p_dh_num([tpBindGet OcId]) / $p_dh_den([tpBindGet OcId])"}##
				##TP_ELSE##
					1/1
				##TP_ENDIF##
			</td>
			<td><input type="text" name="pdh_##TP_OcId##_0" value="" size="6"></td>
		##TP_ENDIF##
		##TP_ELSE##
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		##TP_ENDIF##
	</tr>
	<tr>
	 	<td>Bets created after</td>
		<td><input type=text name=oc-cr-after_##TP_OcId## value="" size=20></td>
	</tr>
	<tr>
		<td>Bet settled after</td>
		<td><input type=text name=oc-stl-after_##TP_OcId## value="" size=20></td>
	</tr>
	##TP_ENDLOOP##
##TP_ENDIF##

##TP_IF {![OT_CfgGet FUNC_STL_CHK 0] || ![op_allowed SettleCheck]}##
    <tr><td>You do not have the permissions to access this page, please contact the System Administrator</td></tr>
##TP_ELSEIF {$EVOC(num) == 0 && $EVMKT(num) == 0} ##
    <tr><td>There are no active resettlment selections - Please go into the event and market screens and add from there</td></tr>
##TP_ELSE##
    <tr>
	<th colspan=30 class=buttons><input type=button class="btn_def" value="Check Settlement" onClick="return fs(this,'DoSettleCheck')"></th>
    </tr>
	  <input type=hidden name=SubmitName value="">
	  <input type=hidden name=action value="ADMIN::SETTLE::DoSettleCheck">
	 </form>
##TP_ENDIF##
	  </table>
  </body>
</html>

