<html>
<!-- $Id: ev_type_list_popup.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Event Type Selection</title>
##TP_PLAY JS_WriteSelect.html##
<script>
var sort = new Object();
##TP_LOOP sort_idx {[tpGetVar NumSorts]}##
sort["##TP_SortType##"] = "##TP_TypeSort##";##TP_ENDLOOP##

##TP_LOOP class_idx {[tpGetVar NumClasses]}##
sort["C:##TP_ClassId##"]="##TP_ClassSort##"; ##TP_ENDLOOP##

var nms = new Array();
var ids = new Array();
##TP_LOOP class_idx {[tpGetVar NumClasses]}##
nms[##TP_ClassId##]=new Array(##TP_LOOP type_idx {$CLASS([tpGetVar class_idx],types)}##"##TP_TypeName##"##TP_IF {[tpGetVar type_idx]!=[expr $CLASS([tpGetVar class_idx],types)-1]}##, ##TP_ENDIF####TP_ENDLOOP##);
ids[##TP_ClassId##]=new Array(##TP_LOOP type_idx {$CLASS([tpGetVar class_idx],types)}##"##TP_TypeId##"##TP_IF {[tpGetVar type_idx]!=[expr $CLASS([tpGetVar class_idx],types)-1]}##, ##TP_ENDIF####TP_ENDLOOP##);
##TP_ENDLOOP##

function fsFB(b,t)
{
	var fm = document.forms["evform"];

	var selectedType = fm.elements["TypeId"].selectedIndex;
	var type         = fm.elements["TypeId"].options[selectedType].value;

	fm.elements["ClassSort"].value = sort[type];

	if (t == "EvAddFB") {
		if ((type.substring(0,1) == "C") ||
				(sort[type] != "FB" && sort[type] != "BB")) {
			alert ("You must select a FB/BB event type!");
			return false;
		}
	}
	if (t == "EvResFB") {
		if (sort[type] != "FB" && sort[type] != "BB") {
			alert ("You must select a FB/BB event type!");
			return false;
		}
	}
	if (t == "EvConfStlFB") {
		if (sort[type] != "FB" && sort[type] != "BB") {
			alert ("You must select a FB event type!");
			return false;
		}
	}

	return fs(b,t);
}


function fs(b,t)
{
	if (t=="EvAdd" || t=="EvAddFB" || t=="EResFB" || t=="EvConfStlFB" ) {
		if (!validateTypeList())
			return false;
	}

	if (t == "EvAdd") {
		var s = b.form.TypeId.options[b.form.TypeId.selectedIndex].value;
		if (s == "0" || s.substring(0,1) == "C") {
			alert ("Please choose an event type");
			return false;
		}
	}
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function updateTypeList() {

	var c = document.evform.ClassId;
	var opt = document.evform.TypeId.options;

	var cId = c.options[c.selectedIndex].value;
	var cName = c.options[c.selectedIndex].text;

	// Delete everything
	opt.length=0;

	if (cId != "0") {

		opt[opt.length] = new Option( "-- all "+cName+" --", "C:"+cId );

		var nm = nms[cId];
		var id = ids[cId];

		for (i=0;i<nm.length;i++) {
			opt[opt.length] = new Option( nm[i], id[i] );
		}

	} else {

		opt[opt.length] = new Option("<< All classes selected >>", "0");
	}

	opt.selectedIndex = 0;
}

function validateTypeList() {

	var t = document.forms['evsettleform'].elements['TypeId'];
	var c = document.forms['evsettleform'].elements['ClassId'];

	var ret = true;

	if (t.selectedIndex < 1 || t.selectedIndex < 1) {
		ret = false;
	}

	if (ret == false) {
		alert("Please select a valid event class and event type from the list.");
		return false;
	} else {
		selected_value = t.options[t.selectedIndex].value
		selected_text = '' + c.options[c.selectedIndex].text + ' >>> ' + t.options[t.selectedIndex].text
		updateParent('eventTypeForm',selected_value,''+selected_text)
		return true;
	}

}

function updateSettleTypeList() {
##TP_IF {[op_allowed Settle]|| [op_allowed ConfirmResults]}##
	var c = document.evsettleform.ClassId;
	var opt = document.evsettleform.TypeId.options;

	var cId = c.options[c.selectedIndex].value;
	var cName = c.options[c.selectedIndex].text;

	// Delete everything
	opt.length=0;

	if (cId != "0") {

		opt[opt.length] = new Option( "-- all "+cName+" --", "C:"+cId );

		var nm = nms[cId];
		var id = ids[cId];

		for (i=0;i<nm.length;i++) {
			opt[opt.length] = new Option( nm[i], id[i] );
		}

	} else {

		opt[opt.length] = new Option("<< All classes selected >>", "0");
	}

	opt.selectedIndex = 0;

##TP_ENDIF##
}
function updateParent(form_name,update_value,update_text) {
	eval("var parent_form = opener.document."+form_name)
	parent_form.LinkedEventTypeId.value = update_value;
	parent_form.LinkedEventText.value = update_text;
	self.close();
	return false;
}
</script>
</head>
<body onload="updateSettleTypeList();">
##TP_IF {[op_allowed Settle]|| [op_allowed ConfirmResults]}##
<table border=0 cellspacing=0 cellpadding=2>
<form name="evsettleform" method=post action=##TP_CGI_URL##>
<tr>
	<th colspan=2 class=title>
	Event Quick Confirm/Settle Criteria
	</th>
</tr>
<input type=hidden name=ClassSort value="">
<tr>
	<td class=caption>Classes</td>
	<td>
	<select name=ClassId size=10 onchange="updateSettleTypeList()">
		<option value=0 selected>-All Classes-</option>
		##TP_LOOP class_idx {[tpGetVar NumClasses]}##
			<option value="##TP_ClassId##">##TP_ClassName##</option>
		##TP_ENDLOOP##
	</select>

	<select name=TypeId size=10>
		<option value="C:0"></option>
	</select>

	</td>
</tr>
<tr>
	<th colspan=2 class=buttons>
	<input type=button class="btn_def" value="Add Linked Event Type" onClick="validateTypeList()">
	</th>
</tr>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::EV_SEL::DoEvSettle>
</form>
</table>
##TP_ENDIF##
</html>