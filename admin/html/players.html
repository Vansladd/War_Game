<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<!-- $Id: players.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
	<title>Players</title>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
	<script type="text/javascript" language="JavaScript">
<!--

self.focus();

var players = new Array();
players[0] = new Array(-1, "New ...", "", "");

##TP_LOOP c_idx {$PLAYERS(nrows)}##
	players[##TP_TCL {tpBufWrite [expr [tpGetVar c_idx] + 1]}##] = new Array(##TP_ESC esc_js##"##TP_playerID##", "##TP_playerFirstName##", "##TP_playerLastName##", "##TP_playerPosition##", "##TP_playerPerf##"##TP_ESC##);
##TP_ENDLOOP##

function listPlayers() {
	for(var i = 0; i < players.length; i++)
	{
		if(players[i][1] != "") {
			option = new Option(players[i][1] + " " + players[i][2], players[i][0]);
		}
		else {
			option = new Option(players[i][2], players[i][0]);
		}
		document.player.playerList.options[i] = option;
	}
	document.player.playerList.selectedIndex = 0;
	document.player.playerList.focus();
	showPlayer(0);
}

function showPlayer(index) {
	document.player.playerID.value   = (index == 0) ? "" : players[index][0];
	document.player.playerFirstName.value = (index == 0) ? "" : players[index][1];
	document.player.playerLastName.value = (index == 0) ? "" : players[index][2];
	document.player.playerPosition.value  = (index == 0) ? "" : players[index][3];
	document.player.playerPerf.value = (index == 0) ? "" : players[index][4];
	if(index == 0) {
		document.player.playerImage.value = "";
		document.player.delPlayerB.disabled = true;
	}
	else {
		document.player.playerImage.value = mangle(document.player.playerFirstName.value, document.player.playerLastName.value);
		document.player.delPlayerB.disabled = false;
	}

	##TP_IF {[tpGetVar manageTeamPlayer 0] != 1}##
		document.player.addUpdPlayerB.disabled = true;
		document.player.delPlayerB.disabled = true;
	##TP_ENDIF##
}

function addUpdPlayer() {
	var manage = ##TP_manage##;
	if(!manage) {
		alert("You don't have permission to do this sort of thing");
		return;
	}
	if(document.player.playerLastName.value.length < 1) {
		alert("Missing player name");
		return;
	}
	var index = document.player.playerList.selectedIndex;
	if(index == 0) {
		document.player.SubmitName.value="add";
	}
	else {
		document.player.SubmitName.value="upd";
	}
	document.player.submit();
}

function delPlayer() {
	var manage = ##TP_manage##;
	if(!manage) {
		alert("You don't have permission to do this sort of thing");
		return;
	}
	if(!confirm("Are you sure you want to delete this player ?")) {
		return;
	}
	var index = document.player.playerList.selectedIndex;
	if(index == 0) {
		alert("Cannot delete this item");
		return;
	}
	document.player.SubmitName.value="del";
	document.player.submit();
}

function mangle(first, last) {
	if(first == "") {
		str = last;
	}
	else {
		str = first + " " + last;
	}
	a = str.split(" ");
	out = "";
	for(i = 0; i < a.length; i++) {
		if(i > 0) {
			out += "_";
		}
		out = out +  a[i];
	}
	str = document.player.teamCode.value + "_" + out.toLowerCase() + ".gif";
	return str;
}

function stopImageEdits(textItem) {
	if(document.player.playerLastName.value != "") {
		textItem.value = mangle(document.player.playerFirstName.value, document.player.playerLastName.value);
	} else {
		textItem.value = "";
	}
	setTimeout("document.player.playerFirstName.focus()", 1);
}

//-->
</script>
</head>

<body onload="listPlayers()">
<form name="player" action="##TP_CGI_URL##" method=get>
<input name="action" type="hidden" value="ADMIN::TEAMPLAYER::doPlayer">
<input name="SubmitName" type="hidden" value="">

<input name="teamID" type="hidden" value="##TP_teamID##">
<input name="teamCode" type="hidden" value="##TP_teamCode##">

<table border="0" cellpadding="1" cellspacing="0" width="650">
<tr>
	<td width="190" rowspan="7" valign="top">
		<select style="width:180px" size="14" name="playerList" onchange="showPlayer(this.selectedIndex)">
		</select>
	</td>
	<th class="title" colspan="2">
	Players - ##TP_teamName##
	</th>
</tr>
<tr>
	<td class="caption">First Name</td>
	<td>
	<input name="playerID" type="hidden" value="">
	<input name="playerFirstName" type="text" size="20" maxlength="20" onchange="document.player.playerLastName.focus()">
	</td>
</tr>
<tr>
	<td class="caption">Last Name</td>
	<td>
	<input name="playerLastName" type="text" size="20" maxlength="20" onchange="document.player.playerPosition.focus()">
	</td>
</tr>
<tr>
	<td class="caption">Position</td>
	<td>
	<input name="playerPosition" type="text" size="15" maxlength="35">
	</td>
</tr>
<tr>
	<td class="caption">Performance</td>
	<td>
	<input name="playerPerf" type="text" size="15" maxlength="255">
	</td>
</tr>
<tr>
	<td class="caption">Image</td>
	<td>
		<input name="playerImage" disabled type="text" size="25" onfocus="stopImageEdits(this)">
	</td>
</tr>
<tr>
	<th class=buttons colspan="2">
		<input name="addUpdPlayerB" type="button" class="btn_def" value="Save" onclick="javascript:addUpdPlayer()">
		<input name="delPlayerB" type="button" class="btn_def" value="Delete" onclick="javascript:delPlayer()">
	</th>
</tr>
</table>
</form>

</body>
</html>
