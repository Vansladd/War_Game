##TP_COMMENT $Id: popup_dd.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $##
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
	<title>OpenBet Drilldown Selector</title>
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
	<script type="text/javascript">
	##TP_TCL -quiet {tpSetVar anc_idx [expr {[tpGetVar NumAncestors]-1}]}##
	var base_path = '##TP_ANCPath##';

 	Children = new Array();
 	##TP_LOOP child_idx {[tpGetVar NumChildren]}##
 		Children[##TP_TCL {tpGetVar child_idx}##] =
 			{level: "##TP_ChildLevel##", id: "##TP_ChildId##", name: "##TP_ChildName##"};
 	##TP_ENDLOOP##

	function goDD(path, level, id) {
		if (arguments.length == 3) {
			path += "," + level + "," + id;
		}
		document.dd_form.path.value = path;
		document.dd_form.submit();
		return false;
	}

	function selectChild() {
		if (document.dd_form.select_option.value == "CHECKBOX") {
			selectCheckBoxChildren();
		} else {
			selectRadioChildren();
		}
	}

	function selectRadioChildren() {
		var child_radios = document.dd_form.children;
		if (!child_radios || !child_radios.length) {
			alert("Error: No children found to select");
			return false;
		}
		var child_idx = "";
		for (var i = 0; i < child_radios.length; i++) {
			if (child_radios[i].checked == true) {
				child_idx = child_radios[i].value;
			}
		}
		if (child_idx == "") {
			alert('Please select ##TP_ChildLevelArticle## ##TP_ChildLevelNames##');
			return false;
		}

		window.opener.set_vals(Children[child_idx].level, Children[child_idx].id, Children[child_idx].name);

		// This is optional, so if it's not defined in the opener document just ignore the exception
		try {
				window.opener.set_context(Children[child_idx].id,document.dd_form.current_level_name.value);
			} catch (e) {}

		return true;
	}

	function selectCheckBoxChildren() {
		var child_boxes = document.dd_form.children;
		if (!child_boxes || !child_boxes.length) {
			alert("Error: No children found to select");
			return false;
		}
		var levels = new Array();
		var ids = new Array();
		var names = new Array();
		var child_idx = "";
		for (var i = 0; i< child_boxes.length; i++) {
			if (child_boxes[i].checked == true) {
				child_idx = child_boxes[i].value;
				levels.push(Children[child_idx].level);
				ids.push(Children[child_idx].id);
				names.push(Children[child_idx].name);
			}
		}

		window.opener.set_vals(levels, ids, names);

		if (##TP_CloseOnSelect## == 1) {
			window.close();
		}

		return true;
	}
	</script>
</head>
<body>

	<form name="dd_form" method="POST" action="##TP_CGI_URL##">
	<input type="hidden" name="action"            value="##TP_TCL {reqGetArg -unsafe [asGetActivatorName]}##">
	<input type="hidden" name="selected_level"    value="##TP_SelectedLevel##">
	<input type="hidden" name="selected_id"       value="##TP_SelectedId##">
	<input type="hidden" name="selectable_levels" value="##TP_SelectableLevels##">
	<input type="hidden" name="blurb"             value="##TP_Blurb##">
	<input type="hidden" name="path"              value="">
	<input type="hidden" name="disable_links_at_level" value="##TP_disableLinksAtLevel##">
	<input type="hidden" name="current_level_name" value="##TP_ANCName##" />
	<input type="hidden" name="select_option"      value="##TP_SelectOption##" />
	<input type="hidden" name="close_on_select"   value="##TP_CloseOnSelect##" />
	<input type="hidden" name="show_date"         value="##TP_ShowDate##" />

	##TP_LOOP pass_idx {[tpGetVar NumPassThru]}##
	<input type="hidden" name="##TP_PassName##"   value="##TP_PassValue##">
	##TP_ENDLOOP##

	<div style="display:none">
	<input type="##TP_IF {[tpBindGet SelectOption] == "CHECKBOX"}##checkbox##TP_ELSE##radio##TP_ENDIF##"  name="children" value="dummy radio button to simplify selectChild function">
	</div>

	<table border="0" cellspacing="0" cellpadding="2" width="98%" align="center">

	<tr>
		<th class=title colspan="3">
			Drilldown Selector
		</th>
	</tr>

	<tr>
		<td colspan="3">
			<b>
			##TP_IF {[string length [tpBindGet Blurb]]}##
				##TP_Blurb##<br>
			##TP_ENDIF##
			##TP_IF {[tpGetVar HasSelectable]}##
			To select ##TP_ChildLevelArticle## ##TP_ChildLevelNames##, tick the radio button next to it and press the 'Select' button.<br>
			##TP_ENDIF##
			##TP_IF {[tpGetVar HasClickable]}##
			To drilldown further, click the ##TP_ChildLevelNames## links.
			##TP_ENDIF##
			##TP_IF {[tpGetVar NumAncestors] > 1}##
			Use the 'Up' button to move up a level.
			##TP_ENDIF##
			</b>
		</td>
	</tr>

	<tr>
		<th colspan="3" class="buttons">
			##TP_IF {[tpGetVar NumAncestors] > 1}##
			##TP_TCL -quiet {tpSetVar anc_idx [expr {[tpGetVar NumAncestors]-2}]}##
			<input type="button" name="btnUp" value="Up" onclick="goDD('##TP_ANCPath##')">
			##TP_ENDIF##
			##TP_IF {[tpGetVar HasSelectable]}##
			<input type="button" name="btnSelect" value="Select" onclick="selectChild()">
			##TP_ENDIF##
		</th>
	</tr>

	<tr>
		<td colspan="3" style="background-color: black; color: white;">
			<b>Event Hierarchy Path</b>
		</td>
	</tr>
	<tr>
		<td colspan="3">
		##TP_LOOP anc_idx {[tpGetVar NumAncestors]-1}##
			<a href="#" onclick="goDD('##TP_ANCPath##')">
				##TP_ANCName##
			</a> &gt;
		##TP_ENDLOOP##
		##TP_TCL -quiet {tpSetVar anc_idx [expr {[tpGetVar NumAncestors]-1}]}##
		##TP_ANCName##
		</td>
	</tr>

	##TP_IF {![tpGetVar NumChildren]}##
		<tr>
			<td colspan="3">
				<b>No items found.</b>
			</td>
		</tr>
	##TP_ELSE##
		##TP_TCL -quiet {tpSetVar child_idx 0; tpSetVar col_idx 0; tpSetVar child_cols 3}##
		##TP_LOOP dummy 9999##
		##TP_IF {[string length [tpBindGet ChildNewLevelStr]]}##
			##TP_IF {[tpGetVar col_idx] > 0}##
			<td colspan="##TP_TCL {expr {[tpGetVar child_cols]-[tpGetVar col_idx]}}##">
				&nbsp;
			</td>
		</tr>
			##TP_ENDIF##
		<tr>
			<td colspan="3" style="background-color: black; color: white;">
				<b>##TP_ChildNewLevelStr##</b>
			</td>
		</tr>
		##TP_TCL -quiet {tpSetVar col_idx 0}##
		##TP_ENDIF##
		##TP_IF {[tpGetVar col_idx] == 0}##
		<tr>
		##TP_ENDIF##
			<td width="##TP_TCL {expr {100/[tpGetVar child_cols]}}##%">
				##TP_IF {[tpGetVar child_idx] >= [tpGetVar NumChildren]}##
					&nbsp;
				##TP_ELSE##
					##TP_IF {[tpBindGet ChildCanSelect]}##
					##TP_IF {[tpBindGet SelectOption] == "CHECKBOX"}##
					<input type="checkbox" name="children" value="##TP_TCL {tpGetVar child_idx}##"##TP_IF {[tpBindGet ChildSelected]}## selected="selected"##TP_ENDIF## />
					##TP_ELSE##
					<input type="radio" name="children" value="##TP_TCL {tpGetVar child_idx}##"##TP_IF {[tpBindGet ChildSelected]}## checked="checked"##TP_ENDIF##>
					##TP_ENDIF##
					##TP_ENDIF##
					##TP_IF {[tpBindGet ChildCanClick]}##
					<a href="#" onclick="goDD(base_path,'##TP_ChildLevel##','##TP_ChildId##')">
						##TP_ChildName##
					</a>
					##TP_ELSE##
					##TP_ChildName##
					##TP_ENDIF##
					##TP_TCL -quiet {tpSetVar child_idx [expr {[tpGetVar child_idx]+1}]}##
				##TP_ENDIF##
			</td>
		##TP_TCL -quiet {tpSetVar col_idx [expr {[tpGetVar col_idx]+1}]}##
		##TP_IF {[tpGetVar col_idx] == [tpGetVar child_cols]}##
		</tr>
		##TP_TCL -quiet {tpSetVar col_idx 0}##
		##TP_ENDIF##
		##TP_IF {[tpGetVar child_idx] >= [tpGetVar NumChildren]}##
		##TP_BREAK##
		##TP_ENDIF##
		##TP_ENDLOOP##
	##TP_ENDIF##

	<tr>
		<th colspan="3" class="buttons">
			##TP_IF {[tpGetVar NumAncestors] > 1}##
			##TP_TCL -quiet {tpSetVar anc_idx [expr {[tpGetVar NumAncestors]-2}]}##
			<input type="button" name="btnUp2" value="Up" onclick="goDD('##TP_ANCPath##')">
			##TP_ENDIF##
			##TP_IF {[tpGetVar HasSelectable]}##
			<input type="button" name="btnSelect2" value="Select" onclick="selectChild()">
			##TP_ENDIF##
		</th>
	</tr>

	</table>
	</form>

</body>
</html>
