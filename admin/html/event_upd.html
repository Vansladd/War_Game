<html>
<!-- $Id: event_upd.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Update Events</title>

##TP_PLAY JS_WriteSelect.html##

<script language=JavaScript>

var errorList = "";

##TP_IF {[OT_CfgGetTrue FUNC_CONF_CRIT_EV_CHNG]}##
var need_admin_conf = 1;
##TP_ELSE##
var need_admin_conf = 0;
##TP_ENDIF##

var ev_id     = new Array();
var ev_start  = new Array();
var ev_status = new Array();
var ev_count  = 0;
var ev_form;

function add_err(e_str)
{
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function set_aux_conf(u,p,l)
{
	ev_form.AuxAdminName.value = u;
	ev_form.AuxAdminPwd.value  = p;
	ev_form.AuxLoginUID.value  = l;

	ev_form.SubmitName.value="UpdEvs";
	ev_form.submit();
	return true;
}

function fs(b,t)
{

	if (t == "EvUpdShow") {
		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.action.value="ADMIN::EV_SEL::DoEvSel"
		b.form.submit();
		return true;
	}

	var get_conf = 0;
	var elt_t, elt_s, e, e_id, e_status, e_start, u_status, u_start;

	ev_form = b.form;

	if (need_admin_conf && t == "UpdEvs") {
		var e;
		for (e = 0; e < ev_count; e++) {
			e_id     = ev_id    [e];
			e_status = ev_status[e_id];
			e_start  = ev_start [e_id];

			if (e_start != "-") {
				elt_t = "start_time_" + e_id;
				u_start = ev_form.elements[elt_t].value;
				if (e_start != u_start) {
					get_conf = 1;
					break;
				}
			}

			if (e_status != "-") {
				elt_t = "status_" + e_id;
				elt_s = ev_form.elements[elt_t]
				u_status = elt_s.options[elt_s.selectedIndex].value;
				if (e_status == "S" && u_status != e_status) {
					get_conf = 1;
					break;
				}
			}
		}
	}

	if (get_conf) {
		window.open
			("##TP_CGI_URL##?action=ADMIN::EVENT::GoCritEvConf",
			"additional_confirmation",
			"toolbar=false,location=false,directories=false,menubar=false,resizable=true,width=300,height=150");
		return false;
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function add_ev(evid)
{
	ev_id[ev_count++] = evid;
}

function write_coloured_tr(started)
{
	if (started=="Y") {
		document.write('<tr class=suspended>');
	} else {
		document.write('<tr class=active>');
	}
}

function write_start_time(resconf,starttime,evid)
{
	if (resconf=="N") {
		ev_start[evid] = starttime;
		document.write('<td><input type=text size=19 name="start_time_'
		+evid+'" value="'+starttime+'"></td>');
	} else {
		ev_start[evid] = "-";
        document.write('<td>'+starttime);
		document.write('<input type=hidden name="start_time_'+evid+'" value="'
			+ starttime+ '"></td>');
	}
}

function write_status(resset,status,evid)
{
	txt = "?";
	if (resset=="N") {
		ev_status[evid] = status;
        document.write('<td><select name="status_'+evid+'">');
        write_select(status,'A','Active','S','Suspended');
        document.write('</select></td>');
	} else {
		ev_status[evid] = "-";
		document.write('<td>');
		write_which(status,'A','Active','S','Suspended');
		document.write(
          '<input type=hidden name="status_'+evid+'" value="'+status+'"></td>');
	}
}

function write_is_off(off,evid)
{
	if (off != "X") {
		document.write('<td><select name="isoff_'+evid+'">');
		write_select(off,'-','N/A','Y','Yes','N','No');
		document.write('</select></td>');
	} else {
		document.write('<td>N/A');
        document.write(
          '<input type=hidden name="isoff_'+evid+'" value="-"></td>');
	}
}

</script>

</head>

<body>
<form name="UpdEvs" method=post action="##TP_CGI_URL##" >
##TP_PLAY error_rpt.html##
<table border=0 cellspacing=1 cellpadding=1>
<tr>
    <th class=title colspan=19>
    Events Update
    </font>
    </th>
</tr>
##TP_IF {[tpGetVar EventsUpdated 0] != ""}##
<tr>
	<td colspan=19><h3><font color=green>Number of Events Updated:&nbsp;##TP_TCL {tpBufWrite [tpGetVar EventsUpdated]}##</font></h3></td></tr>
##TP_ENDIF##
##TP_IF {[tpGetVar NumEvents 0] > 0}##
	<tr>
		<th class=colhead>Event</th>
		<th class=colhead>Start Time</th>
		<th class=colhead>Displayed</th>
		<th class=colhead>Disporder</th>
		<th class=colhead>Status</th>
		<th class=colhead>BIR Delay</th>
		<th class=colhead>Min Bet</th>
		<th class=colhead>Max Bet</th>
		<th class=colhead>Multiples Key</th>
		<th class=colhead>Off?</th>
		##TP_IF {[tpGetVar NumFlags] > 0}##
		<th class=colhead colspan=##TP_NumFlags##>Flags</th>
		##TP_ENDIF##
		##TP_IF {[tpGetVar NumChannels] > 0}##
		<th class=colhead colspan=##TP_NumChannels##>Channels</th>
		##TP_ENDIF##
	</tr>

	##TP_LOOP seln_idx {[tpGetVar NumEvents]}##
		<script>add_ev("##TP_EvId##")</script>
		<script>write_coloured_tr('##TP_EvStarted##');</script>
		<td nowrap><a href="##TP_CGI_URL##?action=ADMIN::EVENT::GoEv&EvId=##TP_EvId##">
			##TP_EvDesc##</a>
		</td>
		<script>
			write_start_time('##TP_EvResultConf##','##TP_EvStartTime##','##TP_EvId##');
		</script>

		<td><select name="displayed_##TP_EvId##">
		<script>write_select('##TP_EvDisplayed##','Y','Yes','N','No');</script>
		</select>
		</td>
		<td><input type=text size=8 name=disporder_##TP_EvId## value="##TP_EvDisporder##"></td>
		<script>write_status('##TP_EvResultSet##','##TP_EvStatus##','##TP_EvId##');</script>
		<td><span><input type=text size=8 name=bir_delay_##TP_EvId## value="##TP_EvBirDelay##">##TP_EvBirHierarchy##</span></td>

        <td><input type=text size=8 name=min_bet_##TP_EvId## value="##TP_EvMinBet##"></td>
        <td><input type=text size=8 name=max_bet_##TP_EvId## value="##TP_EvMaxBet##"></td>
        <td><input type=text size=8 name=mult_key_##TP_EvId## value="##TP_EvMultKey##"></td>
		<script>write_is_off('##TP_EvIsOff##','##TP_EvId##');</script>

  		##TP_LOOP flag_idx {[tpGetVar NumFlags]}##
 		<td><input type=##TP_FlagInput## name="FL_##TP_FlagCode####TP_EvId##" value="Y" ##TP_FlagUse##><br>
		##TP_FlagName##</td>
		##TP_ENDLOOP##

		##TP_LOOP chnnl_idx {[tpGetVar NumChannels]}##
		<td><input type=##TP_ChannelInput## name="CN_##TP_ChannelCd####TP_EvId##" value="Y" ##TP_ChannelUse##><br>
		##TP_ChannelName##</td>
		##TP_ENDLOOP##
		</tr>
	##TP_ENDLOOP##

	<tr>
		<td colspan=19 class=buttons>
			<span class="caption">
				Mark all Displayed
				<select name="all_displayed">
					<script>write_select('##TP_AllDisplayed##','-','-','Y','Yes','N','No');</script>
				</select>
				Mark all Active
				<select name="all_status">
					<script>write_select('##TP_AllStatus##','-', '-','A','Active','S','Suspended');</script>
				</select>
				Mark all Off
				<select name="all_off">
					<script>write_select('##TP_AllOff##','none','-','Y','Yes','S','No','-','N/A');</script>
				</select>
				<input type=button class="btn_def" value="Go" onClick="return fs(this,'EvUpdShow')">
			</span>
			<br>
			Please note that values will only be updated in the DB if 'Update Events' is clicked.
		</td>
	</tr>
	<tr>
		<th colspan=19 class=buttons>
			<input type=button class="btn_def" value="Update Events" onClick="return fs(this,'UpdEvs')">
			<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
		</th>
	</tr>
##TP_ELSE##
	<tr>
		<td bgcolor="#CCCCCC">
		<I>There are no events for the specified parameters.</I>
		</td>
	</tr>
##TP_ENDIF##
</table>
<input type=hidden name="d_lo" value="##TP_d_lo##">
<input type=hidden name="d_hi" value="##TP_d_hi##">
<input type=hidden name="Settled" value="##TP_Settled##">
<input type=hidden name="Status" value="##TP_Status##">
<input type=hidden name="Displayed" value="##TP_Displayed##">
<input type=hidden name="ClassId" value="##TP_ClassId##">

##TP_IF {[OT_CfgGet FUNC_BIR_SEARCH 0]}##
<input type=hidden name="start_or_susp" value="##TP_start_or_susp##">
<input type=hidden name="is_bir" value="##TP_is_bir##">
##TP_ENDIF##

<input type=hidden name=AuxLoginUID value="">
<input type=hidden name=AuxAdminName value="">
<input type=hidden name=AuxAdminPwd value="">
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::EVENT::DoEvsUpd>
</form>
</body>
</html>
