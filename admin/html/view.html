<html>
<!-- $Id: view.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Add/Modify View</title>
<script language="javascript" src="##TP_CGI_URL##?action=ADMIN::ASYNC_BET::GoScript" type="text/javascript"></script>
<script type="text/javascript" src="##TP_OFFICE_STATIC_URL##/js/xmlhttp.js"></script>
##TP_PLAY JS_WriteSelect.html##
<script language=JavaScript>

function fs(b,t)
{
	if (t == "ViewDel") {
		if (!confirm("Are you sure you want to delete this view? All display orders and configurations relating to this view will be removed.")) { return false; }
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}


function fsAudit(b,t,audit)
{
	b.form.SubmitName.value=t;
	b.form.AuditInfo.value = audit;
	b.form.submit();
	return true;
}


function updateResult(response) {

	var details = response.split('|');
	var action = details[0];
	var final = details[1];
	var err = details[2];
	switch(action)
	{
		case 'ViewAdd':
			document.getElementById("idViewId").disabled = true;
			document.getElementById("idViewName").disabled = true;
			document.getElementById("idViewDesc").disabled = true;
			document.getElementById("idViewStatus").disabled = true;
			var divElem = document.getElementById("idDivViewAdd");
			divElem.style.display = "block";
			if (err != '') {
				divElem.style.color = "#FF0000";
				divElem.innerHTML = err;
			} else {
				if (parseInt(final)) {
					divElem.style.color = "#008000";
					divElem.innerHTML = "View has been added.";
					document.getElementById("idCloningDiv").style.display = "block";
				} else {
					divElem.style.color = "#0000FF";
					divElem.innerHTML = "View is being added...";
				}
			}
			break;
		case 'CloneViewDispOrder':
			document.getElementById("idDivCloneViewDispOrderButton").disabled = true;
			var divElem = document.getElementById("idDivCloneViewDispOrder");
			divElem.style.display = "block";
			if (err != '') {
				divElem.style.color = "#FF0000";
				divElem.innerHTML = err;
			} else {
				if (parseInt(final)) {
					divElem.style.color = "#008000";
					divElem.innerHTML = "View display order data data has been cloned.";
				} else {
					divElem.style.color = "#0000FF";
					divElem.innerHTML = "View display order data is being cloned...";
				}
			}
			break;
		case 'CloneViewDislayConfig':
			document.getElementById("idDivCloneViewDislayConfigButton").disabled = true;
			var divElem = document.getElementById("idDivCloneViewDislayConfig");
			divElem.style.display = "block";
			if (err != '') {
				divElem.style.color = "#FF0000";
				divElem.innerHTML = err;
			} else {
				if (parseInt(final)) {
					divElem.style.color = "#008000";
					divElem.innerHTML = "View display config data has been cloned.";
				} else {
					divElem.style.color = "#0000FF";
					divElem.innerHTML = "View display config data is being cloned...";
				}
			}
			break;
		case 'CloneViewRegion':
			document.getElementById("idDivCloneViewRegionButton").disabled = true;
			var divElem = document.getElementById("idDivCloneViewRegion");
			divElem.style.display = "block";
			if (err != '') {
				divElem.style.color = "#FF0000";
				divElem.innerHTML = err;
			} else {
				if (parseInt(final)) {
					divElem.style.color = "#008000";
					divElem.innerHTML = "View region data has been cloned.";
				} else {
					divElem.style.color = "#0000FF";
					divElem.innerHTML = "View region data is being cloned...";
				}
			}
			break;
		default:
			alert('No action triggered.');
			break;
	}
}


function addClone(action) {

	if ( document.getElementById('idViewId').value != '' && document.getElementById('idViewName').value != '' && document.getElementById('idViewDesc').value != '') {

		// Update divs
		updateResult(action+'|0|');

		// Building up the parameters string
		var params = '';
		// standard parameters group

		params += 'do_action=' + action;
		params += '&new_view=' + document.getElementById('idViewId').value;
		if (action == 'ViewAdd') {
			//adding language
			params += '&ViewId=' + document.getElementById('idViewId').value;
			params += '&ViewName=' + document.getElementById('idViewName').value;
			params += '&ViewDesc=' + document.getElementById('idViewDesc').value;
			params += '&ViewStatus=' + document.getElementById('idViewStatus').value;
		} else {//cloning
			params += '&root_view=' + document.getElementById('idRootViewId').value;
		}

		// Sending AJAX request to the server
		var call_back_function = function(_req) {asynchProcessHTMLResponse(_req,'updateResult','There was an error in the server while cloning data');};
		HttpRequest('##TP_CGI_URL##?action=ADMIN::VIEWS::DoAddClone', 'POST', call_back_function, params, true);

	} else {
		alert('Please specify the code, name, description and display order for the view.');
	}
}

</script>
</head>
<body>
##TP_PLAY error_rpt.html##
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	<th colspan=2 class=title>
	##TP_IF {[tpGetVar ViewName] != ""}## ##TP_ViewName## Details ##TP_ELSE## Add View ##TP_ENDIF##
	</th>
</tr>
<form ACTION="##TP_CGI_URL##" method=get>
<tr>
	<td class=caption>Code</td>
	<td>
	<input type=text id="idViewId" name="ViewId" value="##TP_ViewId##" size=10 ##TP_IF {![tpGetVar opAdd 0]}## disabled ##TP_ENDIF##>
	</td>
</tr>
<tr>
	<td class=caption>Name</td>
	<td>
	<input type="text" id="idViewName" name="ViewName" value="##TP_ViewName##" size=32>
	</td>
</tr>
<tr>
	<td class=caption>Description</td>
	<td>
	<input type="text" id="idViewDesc" name="ViewDesc" value="##TP_ViewDesc##" size=32>
	</td>
</tr>
<tr>
	<td class=caption>Status</td>
	<td>
	<select id="idViewStatus" name="ViewStatus">
	<script>
	write_select('##TP_ViewStatus##','A','Active','S','Suspended')
	</script>
	</select>
	</td>
</tr>
<tr>
	<th colspan=2 class=buttons>
	##TP_IF {[op_allowed AddView]}##
		##TP_IF {[tpGetVar opAdd 0]}##
		<input type=button class="btn_def" value="Add View" onClick="return addClone('ViewAdd')" id="idAddView">
		##TP_ELSE##
			<input type=hidden name=ViewId value="##TP_ViewId##">
			<input type=button class="btn_def" value="Modify View" onClick="return fs(this,'ViewUpd')">
			<input type=button class="btn_def" value="Delete" onClick="return fs(this,'ViewDel')">
		##TP_ENDIF##
	##TP_ENDIF##
	<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
	<div  id="idDivViewAdd" style="display:none;"/>
</tr>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value="ADMIN::VIEWS::DoView">
</table>
##TP_IF {[tpGetVar opAdd 0]}##
<div id="idCloningDiv" style="display:none">
<table>
<tr>
<td>
<table>
<tr>
	<th colspan=2 class=title>
	Clone Root View
	</th>
</tr>
<tr>
	<td class=caption>Root View</td>
	<td>
	<select id="idRootViewId" name="RootViewId">
	<script>
	##TP_LOOP view_idx {[tpGetVar NumViews]}##
	write_select('##TP_RootViewId##','##TP_ViewId##','##TP_ViewId##');
	##TP_ENDLOOP##
	</script>
	</select>
	</td>
</tr>
<tr>
	<td class=caption>View Display Order</td>
	<td>
		<input type=button class="btn_def" value="Clone" onClick="return addClone('CloneViewDispOrder');" id="idDivCloneViewDispOrderButton">
	</td>
</tr>
<tr>
	<td class=caption>Display Config</td>
	<td>
		<input type=button class="btn_def" value="Clone" onClick="return addClone('CloneViewDislayConfig');" id="idDivCloneViewDislayConfigButton">
	</td>
</tr>
<tr>
	<td class=caption>Region</td>
	<td>
		<input type=button class="btn_def" value="Clone" onClick="return addClone('CloneViewRegion');" id="idDivCloneViewRegionButton">
	</td>
</tr>

</table>
</td>
<td>
<table>
<tr>
	<td><div id="idDivCloneViewDispOrder" style="display:none;"/></td>
</tr>
<tr>
	<td><div id="idDivCloneViewDislayConfig" style="display:none;"/></td>
</tr>
<tr>
	<td><div id="idDivCloneViewRegion" style="display:none;"/></td>
</tr>
</table>
</td>
</tr>
</div>
##TP_ENDIF##
</form>
</table>
</body>
</html>
