<html>
<!-- $Id: ccy.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Add/Modify Currency</title>
##TP_PLAY JS_WriteSelect.html##
<script src="##TP_OFFICE_STATIC_URL##/js/package.js" language="javascript" type="text/javascript"></script>
<script src="##TP_OFFICE_STATIC_URL##/js/base.js" language="javascript" type="text/javascript"></script>
<script src="##TP_OFFICE_STATIC_URL##/js/sortable_table.js" language="javascript" type="text/javascript"></script>
<script language="Javascript">
function validate(f,t)
{
	var b = document.forms[0];
	var code			= b.CCYCode.value;
	##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
		var exch_rate_b =  b.CCYExchRateB.value;
		var exch_rate_s =  b.CCYExchRateS.value;
	##TP_ENDIF##
	var exch_rate = b.CCYExchRate.value;
	##TP_IF {[tpGetVar mode] != "xsyshost"}##
		var name     = b.CCYName.value;
		var min_dep	 = b.CCYMinDep.value;
		var max_dep	 = b.CCYMaxDep.value;
		var min_wtd	 = b.CCYMinWtd.value;
		var max_wtd	 = b.CCYMaxWtd.value;
		var dispord	 = b.CCYDisporder.value;
		var num_iso_code = b.CCYNumIsoCode.value;
	##TP_ENDIF##
	
	var err="";
	if (code.length !=3) {
		err += "Currency code must be 3 letters long\n";
	}
	##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
	##TP_ELSE##
		if (exch_rate != "" && isNaN(exch_rate)) {
			err += "Exchange rate must be a number\n";
		}
	##TP_ENDIF##
	
	##TP_IF {[tpGetVar mode] != "xsyshost"}##
	if (name.length <= 0) {
		err += "Must enter currency name\n";
	}
	if (min_dep == "" || isNaN(min_dep)) {
		err += "Min deposit must be a number\n";
	}
	if (max_dep =="" || isNaN(max_dep)) {
			err += "Max deposit must be a number\n";
	}
	if (min_wtd =="" || isNaN(min_wtd)) {
			err += "Min withdrawal must be a number\n";
	}
	if (max_wtd == "" || isNaN(max_wtd)) {
			err += "Max withdrawal must be a number\n";
	}
	if (dispord != "" && isNaN(dispord)) {
		err += "Display order must be a number\n";
	}
	if (num_iso_code == "" || isNaN(num_iso_code)) {
		err += "Numeric ISO code must be a number\n";
	}

	##TP_ENDIF##
	if (err != "") {
		alert(err);
	} else {
		fs(f,t);
	}
}
function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

var sortableTable;
 
function load() 
{
	sortableTable = new SortableTable(getObject('sortTable'),getObject('sortRow'));
}
</script>

</head>
<body onload="load();">
##TP_PLAY error_rpt.html##
<table border=0 cellspacing=0 cellpadding=3>
<tr>
	<th colspan=2 class=title>
	##TP_CCYCode## Currency Details
	</th>
</tr>
<form ACTION="##TP_CGI_URL##" method=get>
##TP_IF {[tpGetVar opAdd 0]}##
<tr>
	<td class=caption>Code</td>
	<td>
	##TP_IF {[tpGetVar mode] != "xsyshost"}##
	<input type=text name="CCYCode" value="" size=3>
	##TP_ELSE##
	<select name="CCYCode">
		##TP_LOOP ccy_idx {[tpGetVar XSYS_num_ccy]}##
		<option value="##TP_XSYS_undef_ccy##">##TP_XSYS_undef_ccy##</option>
		##TP_ENDLOOP##
	</select>
	##TP_ENDIF##
	</td>
</tr>
##TP_ENDIF##
##TP_IF { !([tpGetVar opAdd 0] && ([tpGetVar mode] == "xsyshost"))}##
<tr>
	<td class=caption>Name</td>
	<td>
	<input type="text" name="CCYName" value="##TP_CCYName##" size=40 ##TP_IF {[tpGetVar mode] == "xsyshost"}##disabled##TP_ENDIF##>
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Exchange Rate</td>
	<td>
	<input type="text" name="CCYExchRate" value="##TP_CCYExchRate##" size=14>
	</td>
</tr>
##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
	<tr>
		<td class=caption>Buy/Sell Rates</td>
		<td>
		<b>Buy</b>&nbsp;
		<input type="text" name="CCYExchRateB" value="##TP_CCYExchRateB##" size=10>
		&nbsp;&nbsp;
		<b>Sell</b>&nbsp;
		<input type="text" name="CCYExchRateS" value="##TP_CCYExchRateS##" size=10>
		</td>
	</tr>
##TP_ENDIF##
##TP_IF {[tpGetVar mode] != "xsyshost"}##
<tr>
	<td class=caption>Min Deposit</td>
	<td>
	<input type="text" name="CCYMinDep" value="##TP_CCYMinDep##" size=14>
	</td>
</tr>
<tr>
	<td class=caption>Max Deposit</td>
	<td>
	<input type="text" name="CCYMaxDep" value="##TP_CCYMaxDep##" size=14>
	</td>
</tr>
<tr>
	<td class=caption>Min Withdrawal</td>
	<td>
	<input type="text" name="CCYMinWtd" value="##TP_CCYMinWtd##" size=14>
	</td>
</tr>
<tr>
	<td class=caption>Max Withdrawal</td>
	<td>
	<input type="text" name="CCYMaxWtd" value="##TP_CCYMaxWtd##" size=14>
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Status</td>
	<td>
	<select name="CCYStatus">
	<script>
	write_select('##TP_CCYStatus##','A','Active','S','Suspended')
	</script>
	</select>
	</td>
</tr>

##TP_IF {[tpGetVar mode] != "xsyshost"}##
##TP_IF {[tpGetVar PERM_EditExtCCYs 0]}##
<tr>
	<td class=caption>External Multiplier</td>
	<td>
		<input type="text" name="CCYMultiplier" value="##TP_CCYMultiplier##" size=5>
	</td>
</tr>
<tr>
	<td class=caption>External Code</td>
	<td>
		<input type="text" name="CCYExtCCYCode" value="##TP_CCYExtCCYCode##" size=5>
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Numeric ISO Code</td>
	<td>
		<input type="text" name="CCYNumIsoCode" value="##TP_CCYNumIsoCode##" size=5>
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>CVV2 Check Value</td>
	<td>
		<input type="text" name="CCYCVV2CheckValue" value="##TP_CCYCVV2CheckValue##" size=5> (0 implies never check)
	</td>
</tr>
##TP_IF {[tpGetVar mode] != "xsyshost"}##
<tr>
	<td class=caption>Disporder</td>
	<td>
	<input type="text" name="CCYDisporder" value="##TP_CCYDisporder##" size=5>
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>Default Bank Route</td>
	<td>
	<select name="DefBankRoute">
	<script>
	write_select('##TP_CCYDefBankRoute##','BANK','Bank','ENVO','Envoy')
	</script>
	</select>
	</td>
</tr>
<tr>
	<th colspan=2 class=buttons>
	##TP_IF {[op_allowed ManageCCY]}##
		##TP_IF {[tpGetVar opAdd 0]}##
			<input type=button class="btn_def" value="Add Currency" onClick="validate(this,'CCYAdd');">
		##TP_ELSE##
			<input type=hidden name="CCYCode" value="##TP_CCYCode##">
			<input type=button class="btn_def" value="Modify Currency" onClick="validate(this,'CCYMod');">
			<input type=button class="btn_def" value="Delete Currency" onClick="fs(this,'CCYDel');">
		##TP_ENDIF##
	##TP_ENDIF##
	<input type=button class="btn_def" value="Back" onClick="fs(this,'Back');">
	</th>
</tr>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=##TP_IF {[tpGetVar mode] != "xsyshost"}##"ADMIN::CCY::DoCCY"##TP_ELSE##"ADMIN::CCY::DoXSYSCCY"##TP_ENDIF##>
##TP_IF {[tpGetVar mode] == "xsyshost"}##
	<input type="hidden" name="XSYS" value="##TP_XSYS##" />
##TP_ENDIF##
</form>
</table>

<br>

<!----- Historic Exchange Rates ----->
##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
	##TP_TCL {tpBindString NumCols 4}##
##TP_ELSE##
	##TP_TCL {tpBindString NumCols 2}##
##TP_ENDIF##
##TP_IF {[tpGetVar mode] != "xsyshost"}##
	##TP_IF {![tpGetVar opAdd 0]}##
		<table border=0 cellspacing=0 cellpadding=3 id="sortTable">
		<thead>
		<tr>
			<th colspan=##TP_NumCols## class=title>
			Historic Exchange Rates
			</th>
		</tr>
		<tr id="sortRow">
			<th class=colheadSortText>Date start</th>
			<th class=colhead>Rate</th>
			##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
				<th class=colhead>Buy Rate</th>
				<th class=colhead>Sell Rate</th>
			##TP_ENDIF##
		</tr>
		</thead>
		<tbody>
		##TP_LOOP ccy_hist_idx {[tpGetVar NumCCYHist]}##
			<tr>
				##TP_IF {[op_allowed ManageCCY]}##
					<td><a HREF="##TP_CGI_URL##?action=ADMIN::CCY::GoCCYHist&CCYHistId=##TP_CCYHistId##">##TP_CCYHistDate##</a></td>
				##TP_ELSE##
					##TP_CCYHistDate##
				##TP_ENDIF##
				<td class=ra><b>##TP_CCYHistRate##</b></td>
				##TP_IF {[OT_CfgGet FUNC_CCY_BUY_SELL 0]}##
					<td class=ra><b>##TP_CCYHistRateB##</b></td>
					<td class=ra><b>##TP_CCYHistRateS##</b></td>
				##TP_ENDIF##
			</tr>
		##TP_ENDLOOP##
		</tbody>
		##TP_IF {[tpGetVar ViewAll] != 1}##
		<tr>
			<th colspan=2 class=buttons>
			<form ACTION="##TP_CGI_URL##" method=get>
			<input type=hidden name=SubmitName value="">
			<input type=hidden name="action" value="ADMIN::CCY::GoCCY">
			<input type=hidden name="CCYCode" value="##TP_CCYCode##">
			<input type=hidden name="ViewAll" value="1">
			<input type=button class="btn_def" value="View All" onClick="fs(this,'');">
			</form>
			</th>
		</tr>
		
		##TP_ENDIF##
		</table>
	##TP_ENDIF##
##TP_ELSE##
	##TP_IF {![tpGetVar opAdd 0]}##
	<table border=0 cellspacing=0 cellpadding=3>
	<tr>
		<th colspan=3 class=title>
		Historic Exchange Rates
		</th>
	</tr>
	<tr>
		<th class=colhead>Date start</th>
		<th class=colhead>Date end</th>
		<th class=colhead>Rate</th>
	</tr>
	##TP_LOOP xsys_hist_idx {[tpGetVar xsys_hist_nrows]}##
	<tr>
		<td>##TP_XSYS_HIST_date_from##</td>
		<td>##TP_XSYS_HIST_date_to##</td>
		<td>##TP_XSYS_HIST_exch_rate##</td>
	</tr>
	##TP_ENDLOOP##
	</table>
	##TP_ENDIF##
##TP_ENDIF##

<table border=0 cellspacing=0 cellpadding=2>

	<form action="##TP_CGI_URL##" method=get>
	<input type=hidden name="action" value="ADMIN::CCY::DoExtMapCCY">
	
	<input type=hidden name="CCYCode" value="##TP_CCYCode##">
	<input type=hidden name="ViewAll" value="1">


	<tr>
		<th  colspan=2 class=title>
			Envoy Payment Mappings
		</th>
	</tr>
	<tr class=subtitle>
		<th>Sub Type</th>
		<th>Active</th>
	</tr>
	##TP_LOOP envo_all_idx {[tpGetVar num_envo_types 0]}##
	<tr align=center>
		<td>##TP_envo_desc##</td>
		<td><input type="checkbox" name="ext_ccys_checked" value="##TP_envo_type##" ##TP_envo_checked##></td>
	##TP_ENDLOOP##
	</tr>
	<tr>
		<th colspan=2 class="buttons"><input type="submit" value="Update Methods"> </th>
	</tr>


</form>
</table>

</body>
</html>
