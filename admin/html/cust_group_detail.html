<html>
<!-- $Id: cust_group_detail.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Customer Group Detail</title>
##TP_PLAY JS_WriteSelect.html##
<script type="text/javascript">

var group_detail = new Array();

// Array of Products and Types
##TP_LOOP p_idx {[tpGetVar NumProducts 0]}##
	group_detail['##TP_product_name##'] = new Array();
	##TP_LOOP t_idx {[tpBindGet num_tiers]}##
		group_detail['##TP_product_name##'][##TP_TCL {tpBufWrite [tpGetVar t_idx]}##] = new Array();
		group_detail['##TP_product_name##'][##TP_TCL {tpBufWrite [tpGetVar t_idx]}##]['value'] = '##TP_tier_value##';
		group_detail['##TP_product_name##'][##TP_TCL {tpBufWrite [tpGetVar t_idx]}##]['desc'] = '##TP_tier_desc##';
	##TP_ENDLOOP##
##TP_ENDLOOP##

function change_tiers() {

	// Get form elements
	var elems = document.forms["cust_details"].elements;

	// Get the currently selected Product
	var selected_product = elems["product"].value;

	// Clear the existing tier select
	clear_tiers();

	if (selected_product == "none") {
		return
	}

	var tier_select = elems["tier"];

	// loop through the array for the selected product populating the tier select
	for (i = 0; i < group_detail[selected_product].length; i++) {
		var opt = new Option(group_detail[selected_product][i]['desc'], group_detail[selected_product][i]['value']);

		if (group_detail[selected_product][i]['value'] == '##TP_CurrTier##') {
			opt.selected = true;
		}

		tier_select.options[tier_select.options.length] = opt;
	}
}


// Clear the tier select
function clear_tiers() {
	var tier_select = document.forms["cust_details"].elements["tier"];

	// Remove all except for the "dummy" top row
	while (tier_select.options.length > 1) {
		tier_select.options[tier_select.options.length -1] = null;
	}
}

function page_load() {

	##TP_IF {[tpGetVar type ""] == {Update}}##
		// Set the current value for the tier
		change_tiers();
	##TP_ENDIF##
}

function fs(b,t)
{
	if(!validate_form(t)) {
		return false;
	}

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function validate_form(t) {
	var f = document.forms["cust_details"].elements;

	// check select boxes have sensible values
	if(t != "Back" && (f.product.value == "none" || f.tier.value == "none")) {
		alert ("invalid product/tier details");
		return false;
	}
	return true;
}

</script>
</head>

<body onload="page_load()">
##TP_IF {[tpGetVar ShowError 0] == 1}##
<h3>##TP_error_message##</h3>
##TP_ENDIF##
<form name="cust_details">
<table border="0" cellspacing="0" cellpadding="2">
<tr>
	<th class="title" colspan="2">Customer Group Details</th>
</tr>
<tr class="subtitle">

</tr>
<tr>
	<td>Product</td>
	<td>
	##TP_IF {[tpGetVar type "Add"] == {Update}}##
		<input type="hidden" name="product" value="##TP_CurrProduct##" \>
		##TP_CurrProduct##
	##TP_ELSE##
		<select name="product" onchange="change_tiers()">
			<script type="text/javascript">
			write_select('##TP_CurrProduct##','none','-- Select Product --'
			##TP_LOOP p_idx {[tpGetVar NumProducts 0]}##
			,'##TP_product_name##', '##TP_product_desc##'
			##TP_ENDLOOP##
			);
			</script>
		</select>
	##TP_ENDIF##
	</td>
</tr>
<tr>
	<td>Tier</td>
	<td>
		<select name="tier">
			<option value="none">-- Select Tier --</option>
		</select>
	</td>
</tr>
<tr>
	<td>Comments</td>
	<td>
		<input type="text" size="60" name="comments" value="##TP_CurrComments##" />
	</td>
</tr>
<tr>
	<th class="buttons" colspan="2">
		##TP_IF {[tpGetVar type "Add"] == "Add"}##
		<input type="button" class="btn_def" value="Add" onclick="fs(this, 'Add')">
		##TP_ELSE##
		<input type="button" class="btn_def" value="Update" onclick="fs(this, 'Update')">
		##TP_ENDIF##
		&nbsp;
		<input type="button" class="btn_def" value="Delete" onclick="fs(this, 'Delete')">&nbsp;
		<input type="button" class="btn_def" value="Back" onclick="fs(this, 'Back')">
	</th>
</tr>

</table>
<input type="hidden" name="action" value="ADMIN::CUST::DoCustGroupsDetail">
<input type="hidden" name="cust_id" value="##TP_CustId##">
<input type="hidden" name="group_value_id" value="##TP_CurrTier##">
<input type="hidden" name="SubmitName" value="">
</form>
</body>
</html>
