<HTML>
<!-- $Id: password.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<TITLE>Change Password</TITLE>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--
var errorList = "";
var pwd_min_length = ##TP_pwdMinLength##;

function add_err(e_str) {
	if (errorList.length > 0) {
		errorList += "\n";
	}
	errorList += e_str;
}

function val_str_chars(s) {
	for (var i = 0; i < s.length; i++) {
		var ch = s.charAt(i);
		if ((ch>='A' && ch<='Z') || (ch>='a'||ch<='z') ||
			(ch>='0' && ch<='9') ||
			(ch=='-') || (ch=='_') || (ch=='.')) {
			null;
		} else {
			return false;
		}
	}
	return true;
}

function ck_password(p1,p2,p0) {
	if (p1.length < pwd_min_length) {
		add_err("Password must be "+pwd_min_length+" or more characters"
			+" containing letters and at least one number.");
		return 1;
	}
	if (val_str_chars(p1) == false) {
		add_err("only a..z,A..Z,0-9,-,_ and . allowed in password");
		return 1;
	}
	if (p1 != p2) {
		add_err("two versions of password don't match");
		return 1;
	}
	if (p1 == p0) {
		add_err("old and new password are the same");
		return 1;
	}
	return 0;
}

function submit_check(f) {
	var n_errs = 0;

	n_errs += ck_password  (f.Password_1.value, f.Password_2.value, f.Password_0.value);

	if (n_errs > 0) {
		alert("There are some errors in the form:\n\n" + errorList);
		errorList = "";
		return false;
	}
	return true;
}

function fs(b,t) {
	if (submit_check(b.form)) {
		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();
		return true;
	} else {
		return false;
	}
}

function init() {
	document.getElementById("Password_1").focus();
}

//-->
</SCRIPT>

<body onLoad="javascript:init();">
##TP_PLAY error_rpt.html##
##TP_IF {[tpGetVar PasswordChanged 0]}##
	<h3 class="succeeded">Password Changed</h3>
##TP_ENDIF##
##TP_IF {[tpGetVar Error 0]}##
	<h3 class="failed">##TP_ErrorMessage##</h3>
##TP_ENDIF##
<table border=0 bordercolor=red cellspacing=0 cellpadding=2 width=350>
<form method=get action="##TP_CGI_URL##" onSubmit="return submit_check(this);">
<tr>
	<th class=title colspan=2>
	Change Password
	</th>
</tr>
##TP_IF {[tpGetVar show_pw_policy]}##
<tr>
	<td class=caption colspan=2 style="text-align: center;">
	Password must be ##TP_pwdMinLength## or more characters containing letters and at least one number
	</td>
</tr>
##TP_ENDIF##
<tr>
	<td class=caption>New Password</td>
	<td>
	<input type="password" id="Password_1" name="Password_1" size=30 maxlength=30 value="">
	</td>
</tr>
<tr>
	<td class=caption>(again)</td>
	<td>
	<input type="password" name="Password_2" size=30 maxlength=30 value="">
	</td>
</tr>
<tr>
	<td class=caption>Current Password</td>
	<td>
	<input type="password" name="Password_0" size=30 maxlength=30 value="">
	</td>
</tr>
<tr>
	<th colspan=2 class=buttons>
	<input type=submit class="btn_def" value="Change Password" onClick="return fs(this,'PwdMod')">
	</th>
</tr>
</table>
<input type=hidden name=SubmitName value="">
<input type=hidden name=action value=ADMIN::USERS::DoPassword>
<input type=hidden name=is_login value="##TP_TCL {tpGetVar is_login 0}##">
<input type=hidden name=username value="##TP_TCL {tpGetVar username ""}##">
</form>
</body>
</html>
