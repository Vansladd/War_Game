<html>
<!-- $Id: pmt_auth.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>OpenBet Administration</title>
##TP_PLAY JS_WriteSelect.html##
<script>

function doAudit(audit, b) {
	b.form.AuditInfo.value = audit;
	return fs(b, "GoAudit");
}

function fs(b,t)
{
	##TP_IF {[OT_CfgGet FUNC_OVS 0]}##
		##TP_COMMENT {
			/*
				Only allows a user to withdrawal from an AV restricted account if they
				have the correct permissions.
			*/
		}##
		if (t == "DoWtd" && "##TP_av_status##" == "P") {
			##TP_IF {[op_allowed AVWithdrawalAllowed]}##
				if (!confirm("Do you really want to withdrawal from an AV restricted account?")) {
					return false;
				}
			##TP_ELSE##
				alert("Sorry this customer is AV suspended you do not have permision to make a withdrawal.");
				return false;
			##TP_ENDIF##
		}
	##TP_ENDIF##

	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
function popup(url) {
	window.open(url,"redirect","width=600,height=400,status=yes,resizable=yes");
}
</script>
</head>
<body
##TP_IF {[OT_CfgGet FUNC_ONEPAY 0] && [tpGetVar onepay_redirect 0]}##
onload=popup("##TP_REDIRECT_URL##")
##TP_ENDIF##
>
##TP_PLAY msg_rpt.html##
##TP_PLAY error_rpt.html##

<form method=post action="##TP_CGI_URL##">
<table cellspacing=0 cellpadding=2 border=0>
	<tr>
		<th colspan=2 class=title>Customer details</th>
	</tr>
	<!-- show the customers details -->
	##TP_PLAY pmt/pmt_detail_cust.html##

	<tr>
		<th colspan=2 class=title>Payment method details</th>
	</tr>
	<tr>
		<td class=caption>Scheme</td>
		<td>##TP_PM_desc##&nbsp;</td>
	</tr>
	##TP_IF {[tpGetVar NumLinkedMethods 0] > 0}##
	<tr>
		<td class="caption">Linked Methods</td>
		<td>
			##TP_LOOP l_idx {[tpGetVar NumLinkedMethods 0]}##
				<a href="##TP_CGI_URL##?action=ADMIN::PMT::go_pay_mthd_auth&cpm_id=##TP_LinkedCpmId##&CustId=##TP_CustId##&pay_mthd=##TP_LinkedPayMthd##">Linked ##TP_LinkType## Method</a><br/>
			##TP_ENDLOOP##
		</td>
	</tr>
	##TP_ENDIF##


##TP_IF {[tpGetVar pay_mthd ""] == "CHQ"}##

	##TP_PLAY pmt/pmt_detail_CHQ.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "BANK"}##

	##TP_PLAY pmt/pmt_detail_BANK.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "WU"}##

	##TP_PLAY pmt/pmt_detail_WU.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "CC"}##

	##TP_PLAY pmt/pmt_detail_CC.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "PB"}##

	##TP_PLAY pmt/pmt_detail_PB.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "EP"}##

  ##TP_PLAY pmt/pmt_detail_EP.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "BASC"}##

  ##TP_PLAY pmt/pmt_detail_BASC.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "NTLR"}##

  ##TP_PLAY pmt/pmt_detail_NTLR.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "C2P"}##

  ##TP_PLAY pmt/pmt_detail_C2P.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "PPAL"}##

  ##TP_PLAY pmt/pmt_detail_PPAL.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "SHOP"}##

  ##TP_PLAY pmt/pmt_detail_SHOP.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "MB"}##

	##TP_PLAY pmt/pmt_detail_MB.html##

##TP_ELSEIF  {[tpGetVar pay_mthd ""] == "CB"}##
        ##TP_PLAY pmt/pmt_detail_CB.html##

##TP_ELSEIF {[tpGetVar pay_mthd ""] == "ENVO"}##

	##TP_PLAY pmt/pmt_detail_ENVO.html##

##TP_ENDIF##

	<tr>
		<th colspan=2 class=title>Payment Method Balance</th>
	</tr>
	##TP_IF {[op_allowed UpdatePMBExpiryAcc]}##
	<tr>
		<td class=caption>PMB Expiry (days)</td>
		<td><input name="pmb_exp" type="text" size=3 value="##TP_PM_pmb_period##"></td>
	</tr>
	<tr>
		<th colspan=2 class=buttons>

		<input type=button class="btn_def" value="Update" onClick="return fs(this,'UpdPMBExpiry')">
		</th>
	</tr>
	##TP_ELSE##
	<tr>
		<td class=caption>PMB Expiry (days)</td>
		<td>##TP_PM_pmb_period##</td>
	</tr>
	##TP_ENDIF##

##TP_IF {[OT_CfgGet FUNC_CPM_FAILED_ATTEMPTS 0] == 1}##
	<tr>
		<th colspan=2 class=title>Failed Attempted Transactions</th>
	</tr>
	<tr>
		<td class=caption>Number of Attempts</td>
		<td>##TP_PM_num_fails##&nbsp;</td>
	</tr>
	<tr>
		<td class=caption>Last Fail Reason</td>
		<td>##TP_PM_last_fail_reason##&nbsp;</td>
	</tr>
	##TP_IF {[op_allowed ZeroCPMFails]}##
	<tr>
		<th colspan=2 class=buttons>

		<input type=button class="btn_def" value="Zero Failed Attempts" onClick="return fs(this,'ZeroCPMFails')">
		</th>
	</tr>
	##TP_ENDIF##
##TP_ENDIF##
<tr>
	<th colspan=2 class=title>Authorisation</th>
</tr>

<!-- overall status -->
<tr class=subtitle>
	<th colspan=2 align=left>Overall Status</th>
</tr>
<tr>
<tr>
	<td class=caption>Status:</td>
	<td>
		##TP_IF {[tpBindGet PM_status] == "S" && [OT_CfgGet CHECK_PERM_FOR_SUSPENDED_CPM 0] && ![op_allowed UpdSuspendedPayMthds]}##
		Suspended
		<input type="hidden" name="status" value="##TP_PM_status##">
		##TP_ELSE##
		<select name="status">
			<script>
				write_select("##TP_PM_status##","A","Active","S","Suspended","X","Removed")
			</script>
		</select>
		##TP_ENDIF##
		&nbsp;
		<b>Deposit Check</b>

		##TP_IF {[op_allowed UpdDepositCheckAcc]}##
			<select name="deposit_check">
			<script type="text/javascript" language="Javascript">
				write_select("##TP_PM_deposit_check##","Y","Yes","N","No");
			</script>
			</select>
		##TP_ELSE##
			<script type="text/javascript" language="Javascript">
				write_which('##TP_PM_deposit_check##','N','No','Y','Yes');
			</script>
			<input type="hidden" name="deposit_check" value="##TP_PM_deposit_check##"/>
		##TP_ENDIF##

	</td>

</tr>
##TP_IF {[OT_CfgGet FUNC_CPM_NOTES 0]}##
<tr>
	<td class=caption>Notes:</td>
	<td><input name="oper_notes" type="text" size=50 value="##TP_PM_oper_notes##"></td>
</tr>
##TP_ENDIF##


<!-- deposit/withdrawal status -->
<tr class=subtitle>
	<th colspan=2 align=left>Deposit Status</th>
</tr>
<tr>
	<td class=caption>Authorisation</td>
	<td>
		<select name="auth_dep">
			<script>
			write_select("##TP_PM_auth_dep##","Y","Yes","N","No","P","Pending")
			</script>
		</select>
		&nbsp;
		<b>status</b>
		<select name="status_dep">
			<script>
			write_select("##TP_PM_status_dep##","A","Active","S","Suspended");
			</script>
		</select>
	</td>
</tr>
<tr>
	<td class=caption>Comment</td>
	<td><input name="disallow_dep_rsn" type="text" size=50 value="##TP_PM_disallow_dep_rsn##"></td>
</tr>
<tr>
	<td class=caption>Order</td>
	<td><input name="order_dep" type="text" size=2 value="##TP_PM_order_dep##"></td>
</tr>

##TP_IF {[tpGetVar pay_mthd ""] != "GDEP" && [tpGetVar pay_mthd ""] != "PSC"}##
<tr class=subtitle>
	<th colspan=2 align=left>Withdrawal Status</th>
</tr>
<tr>
	<td class=caption>Authorisation</td>
	<td>
		<select name="auth_wtd">
			<script>
			write_select("##TP_PM_auth_wtd##","Y","Yes","N","No","P","Pending")
			</script>
		</select>
		&nbsp;
		<b>status</b>
		<select name="status_wtd">
			<script>
			write_select("##TP_PM_status_wtd##","A","Active","S","Suspended");
			</script>
		</select>
	</td>
</tr>
<tr>
	<td class=caption>Comment</td>
	<td><input name="disallow_wtd_rsn" type="text" size=50 value="##TP_PM_disallow_wtd_rsn##"></td>
</tr>
<tr>
	<td class=caption>Order</td>
	<td><input name="order_wtd" type="text" size=2 value="##TP_PM_order_wtd##"></td>
</tr>

##TP_ELSE##
<input name="disallow_wtd_rsn" type="hidden" value="##TP_PM_disallow_wtd_rsn##">
<input name="auth_wtd" type="hidden" value="##TP_PM_auth_wtd##">
<input name="status_wtd" type="hidden" value="##TP_PM_status_wtd##">
<input name="order_wtd" type="hidden" value="##TP_PM_order_wtd##">
##TP_ENDIF##
##TP_IF {[tpGetVar onepay_options 0]}##
<tr class=subtitle>
	<th colspan="2" align="left">Gateway Status</th>
</tr>
<tr>
	<td class="caption">Use 1-Pay</td>
	<td>
		<input type="checkbox" name="gw" value="1" ##TP_OP_CHECKED## />
	</td>
</tr>
##TP_ENDIF##
<input type=hidden name="cpm_id" value="##TP_cpm_id##">
<input type=hidden name="pay_mthd" value="##TP_pay_mthd##">
<input type=hidden name="desc" value="##TP_PM_desc##">
<input type=hidden name="CustId" value="##TP_CustId##">
<input type=hidden name="SubmitName" value="">
<input type=hidden name="AuditInfo" value="">
<input type=hidden name="from_cust_details" value="##TP_from_cust_details##">
<input type=hidden name="prev_status" value="##TP_PM_status##">
<input type=hidden name="action" value="ADMIN::PMT::do_pay_mthd_auth">
<tr>
	<th colspan=2 class=buttons>
		##TP_IF {[op_allowed UpdPayMethod]}##
		<input type=button class="btn_def" value="Update Payment Method" onClick="return fs(this,'UpdCustPmtMthd')">
		##TP_ENDIF##
		##TP_IF {[tpGetVar from_cust_details 0]}##
			<input type=button class="btn_def" value="Back" onClick="document.location.href='##TP_CGI_URL##?action=ADMIN::CUST::GoCust&CustId=##TP_CustId##'">
		##TP_ELSE##
			<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
		##TP_ENDIF##
		##TP_IF {[tpGetVar PERM_ViewAudit 0]}##
		<input type=button class="btn_def" value="View Audit History" onClick="return doAudit('CustPayMthd', this)">

		##TP_ENDIF##
		<br>
		##TP_IF {[tpGetVar ShowDep] && [op_allowed DoPayMethodPmt]}##
		<input type="button" class="btn_def" value="Make Deposit" onClick="return fs(this,'DoDep')">
		##TP_ENDIF##
		##TP_IF {[tpGetVar ShowWtd] && [op_allowed DoPayMethodPmt]}##
		<input type="button" class="btn_def" value="Make Withdrawal" onClick="return fs(this,'DoWtd')">
		##TP_ENDIF##
	</th>
</tr>
</table>
</form>
<br>

##TP_PLAY -nocache cust_pmt_list.html##


</body>
</html>
