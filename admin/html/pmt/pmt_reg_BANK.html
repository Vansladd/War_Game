<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<!-- $Id: pmt_reg_BANK.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
##TP_PLAY JS_WriteSelect.html##
<script type="text/javascript" src="##TP_OFFICE_STATIC_URL##/js/base.js"></script>
<script language=JavaScript>
##TP_IF {[tpGetVar UseBankTemplates 0] == 1}##
function enable_disable_bank_fields (f) {
	if (f.disable_validation && f.disable_validation.checked)
		display_all_fields(f);
	else
		country_change(f);
}

function display_all_fields (f) {
	document.getElementById("bank_acct_no").disabled=false;
	document.getElementById("swift_code").disabled=false;
	document.getElementById("iban_code").disabled=false;
	document.getElementById("bank_sort_code").disabled=false;

	document.getElementById("bank_acct_no_row").disabled=false;
	document.getElementById("swift_code_row").disabled=false;
	document.getElementById("iban_code_row").disabled=false;
	document.getElementById("bank_sort_code_row").disabled=false;
}

function country_change (f)
{
	// display or hide fields based on country code index
	var selectedIndex = f.bank_country_code.value;
	var req_fields = new Object();
	var test_fields = ["bank_acct_no", "swift_code", "iban_code", "bank_sort_code"];

	switch (selectedIndex) {
		##TP_LOOP country_idx {[tpGetVar num_countries]}##
		case '##TP_country_code##':
			req_fields =  [
				##TP_LOOP field_idx {[tpGetVar num_req_fields]}##
					##TP_IF {[tpGetVar field_idx]}##,##TP_ENDIF## '##TP_req_fields##'
				##TP_ENDLOOP##
			];
			break;
		##TP_ENDLOOP##
	}

	for (var i=0; i<test_fields.length; i++) {
		if (req_fields.indexOf(test_fields[i]) != -1) {
			document.getElementById(test_fields[i] + '_row').disabled=false;
			document.getElementById(test_fields[i]).disabled=false;
		} else {
			document.getElementById(test_fields[i]).value = "";
			document.getElementById(test_fields[i]).disabled=true;
			document.getElementById(test_fields[i] + '_row').disabled=true;
		}
	}

}
function validate(b,t)
{
	if (!b.form.disable_validation || !b.form.disable_validation.checked) {
		var errorList = "";
		var add_err = function (e_str)
		{
			if (errorList.length > 0) {
				errorList += "\n";
			}
			errorList += e_str;
		}

		var country = b.form.bank_country_code.value;
		var field_formats = new Object();

		##TP_LOOP country_idx {[tpGetVar num_countries]}##
		field_formats["##TP_country_code##"] = [
			##TP_LOOP field_idx {[tpGetVar num_req_fields]}##
				##TP_IF {[tpGetVar field_idx]}##,##TP_ENDIF## ['##TP_req_fields##', '##TP_regex##']
			##TP_ENDLOOP##
		];
		##TP_ENDLOOP##

		for (var row = 0; row < field_formats[country].length;  row++) {
			var field_format = field_formats[country][row];
			var re = new RegExp(field_format[1], 'i');
			if (!document.getElementById(field_format[0]).value.match(re)) {
				add_err("Incorrect format in field: " + field_format[0]);
			}
		}
		if (errorList != "") {
			alert(errorList);
			return false;
		}
	}

	fs(b,t);

}
##TP_ENDIF##

function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
</script>

</head>
##TP_IF {[tpGetVar UseBankTemplates 0] == 1}##<body onload="enable_disable_bank_fields(document.getElementById('add_pay_method_form'))">##TP_ENDIF##
##TP_PLAY error_rpt.html##
<form id = "add_pay_method_form" action="##TP_CGI_URL##" method="post">
	<input type="hidden" name="SubmitName" value="">
	<input type="hidden" name="CustId" value="##TP_CustId##">
	<input type="hidden" name="action" value="ADMIN::PMT::do_pay_mthd_add">
	<input type="hidden" name="pay_mthd" value="BANK">
	<input type="hidden" name="Username" value="##TP_Username##">
	<input type="hidden" name="AcctNo" value="##TP_AcctNo##">
	<input type="hidden" name="backAction" value="##TP_backAction##">
<table cellspacing= cellpadding=2 border=0>
	<tr>
	   <th colspan=2 class=title>Add new payment method - (BANK)</th>
	</tr>
	<!-- show the customers details -->
	##TP_PLAY pmt/pmt_detail_cust.html##
	<tr>
		<td colspan=2>&nbsp;</td>
	</tr>
	<tr class=subtitle>
		<th colspan=2 align=left>Bank Account Details</th>
	</tr>
	<tr>
		<td class="caption">Account Name</td>
		<td><input type=text size=20 name=bank_acct_name value="##TP_CustFName## ##TP_CustLName##"></td>
	</tr>
	<tr>
		<td colspan=2>&nbsp;</td>
	</tr>
	<tr id="bank_sort_code_row">
		<td class="caption">Sort Code</td>
		<td><input type=text id = bank_sort_code name=bank_sort_code value="##TP_bank_sort_code##" size=20></td>
	</tr>
	<tr id="bank_acct_no_row">
		<td class="caption">Account Number</td>
		<td><input type=text id = bank_acct_no name=bank_acct_no value="##TP_bank_acct_no##"></td>
	</tr>
	<tr id="iban_code_row">
		<td class="caption">IBAN code</td>
		<td><input type=text id = iban_code name=iban_code value="##TP_iban_code##"></td>
	</tr>
	<tr id="swift_code_row">
		<td class="caption">BIC code (swift)</td>
		<td><input type=text id = swift_code name=swift_code value="##TP_swift_code##"></td>
	</tr>
	<tr>
		<td colspan=2>&nbsp;</td>
	</tr>
	<tr>
		<td class="caption">Bank Name</td>
		<td><input type=text name=bank_name value="##TP_bank_name##" size=32></td>
	</tr>
	<tr>
		<td class="caption">Bank Address</td>
		<td><input type=text name="bank_addr_1" value="##TP_bank_addr_1##" size=32></td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td><input type=text name="bank_addr_2" value="##TP_bank_addr_2##" size=32></td>
	</tr>
	##TP_IF {[OT_CfgGet SHOW_BANK_ADDR3 0]}##
	<tr>
		<td>&nbsp;</td>
		<td><input type=text name="bank_addr_3" value="##TP_bank_addr_3##" size=32></td>
	</tr>
	##TP_ENDIF##

	<tr>
		<td class="caption">County/Region</td>
		<td><input type=text name="bank_addr_4" value="##TP_bank_addr_4##" size=32></td>
	</tr>
	<tr>
		<td class="caption">City/Town</td>
		<td><input type=text name="bank_addr_city" value="##TP_bank_addr_city##" size=32></td>
	</tr>
	<tr>
		<td class="caption">Post Code</td>
		<td><input type=text name="bank_addr_postcode" value="##TP_bank_addr_postcode##" size=20></td>
	</tr>
	<tr>
		<td class="caption">Country</td>
		<td>
		<select id=bank_country_code name=bank_country_code ##TP_IF {[tpGetVar UseBankTemplates 0] == 1}## onchange="enable_disable_bank_fields(this.form)"##TP_ENDIF##>
		##TP_LOOP country_idx {[tpGetVar NumCountrys]}##
		<option value="##TP_CountryCode##" ##TP_CountrySel##>##TP_CountryName##</option>
		##TP_ENDLOOP##
		</select>
		</td>
	</tr>
	<tr>
		<td class="caption">Bank Branch</td>
		<td><input type=text name="bank_branch" value="##TP_bank_branch##" size=20></td>
	</tr>
	<tr>
		<th colspan=3 class="buttons">
			##TP_IF {[tpGetVar UseBankTemplates 0] == 1}##
			<input type="button" class="btn_def" value="Add Payment Method" onClick="return validate(this,'AddMthd')">
			##TP_ELSE##
			<input type="button" class="btn_def" value="Add Payment Method" onClick="fs(this,'AddMthd')">
			##TP_ENDIF##

			<input type="button" class="btn_def" value="Back" onClick="return fs(this,'Back')">

			##TP_IF {[tpGetVar UseBankTemplates 0] == 1  &&  [op_allowed BankDetailsValidOff]}##
			<input type="checkbox" name="disable_validation" onClick="enable_disable_bank_fields(this.form)"##TP_ENDIF##>Disable Validation</input>
			##TP_ENDIF##
		</th>
	</tr>
</table>
</form>

</body>
</html>
