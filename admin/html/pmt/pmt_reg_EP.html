##TP_COMMENT $Id: pmt_reg_EP.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $##
##TP_COMMENT $Name: RC_Training $##
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
    <link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
    ##TP_PLAY JS_WriteSelect.html##
    <script language=JavaScript>
      <!--
      var ccyCode = '##TP_CcyCode##';
function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}
      function clickHandler(evt) {
        //alert(this.name + ': ' + this.value + ' clicked.');
        countryCustomise(this.value);
        
      }        

      function countryCustomise(country) {
      
        if (country=='') {
          country = 'GB';
          document.cardform.Country[0].click();
        }
        
        var ccyField        = document.cardform.disp_ccy;
        var sortField       = document.cardform.BranchSort;
        var bankCodeField   = document.cardform.BankCode;
        var branchCodeField = document.cardform.BranchCode;
        var acNumField      = document.cardform.AccNumber;
        var acNameField     = document.cardform.AccName;
        var bankKeyField	= document.cardform.BankKey;
        var typeField		= document.cardform.Type;
        var routingField	= document.cardform.Routing;
        var countryField	= document.cardform.CountryText;
        
        switch(country) {
          case 'GB':
            ccyField.value='GBP';
            sortField.maxLength = 6;
            acNumField.maxLength = 8;
            acNameField.maxLength= 18;
            enableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'HK':
            ccyField.value='HKD';
            bankCodeField.maxLength = 3;
            branchCodeField.maxLength = 3;
            acNumField.maxLength = 9;
            acNameField.maxLength= 18;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'SE':
            ccyField.value='SEK';
            bankCodeField.maxLength = 4;
            acNumField.maxLength = 12;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'IE':
            ccyField.value='EUR';
            sortField.maxLength = 6;
            acNumField.maxLength = 8;
            acNameField.maxLength= 18;
            enableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'NL':
            ccyField.value='EUR';
            acNumField.maxLength = 10;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'NO':
            ccyField.value='NOK';
            acNumField.maxLength = 11;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'FI':
            ccyField.value='EUR';
            acNumField.maxLength = 14;
            acNameField.maxLength= 30;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'FR':
            ccyField.value='EUR';
            bankCodeField.maxLength = 5;
            branchCodeField.maxLength = 5;
            acNumField.maxLength = 13;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'IT':
            ccyField.value='EUR';
            bankCodeField.maxLength = 12;
            acNumField.maxLength = 12;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'DK':
            ccyField.value='DKK';
            branchCodeField.maxLength = 4;
            acNumField.maxLength = 10;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            enableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'AU':
            ccyField.value='AUD';
            bankCodeField.maxLength = 7;
            acNumField.maxLength = 12;
            acNameField.maxLength= 32;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'ES':
            ccyField.value='EUR';
            bankCodeField.maxLength = 4;
            branchCodeField.maxLength = 4;
            acNumField.maxLength = 14;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'DE':
            ccyField.value='EUR';
            bankCodeField.maxLength = 8;
            acNumField.maxLength = 10;
            acNameField.maxLength= 30;
            disableTextField(sortField);
            enableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'ZA':
            ccyField.value='ZAR';
            branchCodeField.maxLength = 6;
            acNumField.maxLength = 11;
            acNameField.maxLength= 35;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            enableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;          
          case 'BE':
            ccyField.value='EUR';
            acNumField.maxLength = 12;
            acNameField.maxLength= 30;
            disableTextField(sortField);
            disableTextField(bankCodeField);
            disableTextField(branchCodeField);
            disableTextField(bankKeyField);
            disableTextField(typeField);
            disableTextField(routingField);
            disableTextField(countryField);
            break;
          case 'AT':
            ccyField.value='EUR';
            bankCodeField.maxLength = 50;
            branchCodeField.maxLength = 50;
            acNumField.maxLength = 50;
            acNameField.maxLength= 50;
            bankKeyField.maxLength = 50;
            typeField.maxLength = 50;
            routingField.maxLength = 50;
          	enableTextField(ccyField);
            enableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);          	
            enableTextField(bankKeyField);          	
            enableTextField(typeField);          	
            enableTextField(routingField);          	
	        disableTextField(countryField);
			break; 
          case 'TR':
            ccyField.value='TRL';
            bankCodeField.maxLength = 50;
            branchCodeField.maxLength = 50;
            acNumField.maxLength = 50;
            acNameField.maxLength= 50;
            bankKeyField.maxLength = 50;
            typeField.maxLength = 50;
            routingField.maxLength = 50;
          	enableTextField(ccyField);
            enableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);          	
            enableTextField(bankKeyField);          	
            enableTextField(typeField);          	
            enableTextField(routingField);          	
	        disableTextField(countryField);
			break;          
          case 'CA':
            ccyField.value='CAD';
            bankCodeField.maxLength = 50;
            branchCodeField.maxLength = 50;
            acNumField.maxLength = 50;
            acNameField.maxLength= 50;
            bankKeyField.maxLength = 50;
            typeField.maxLength = 50;
            routingField.maxLength = 50;
          	enableTextField(ccyField);
            enableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);          	
            enableTextField(bankKeyField);          	
            enableTextField(typeField);          	
            enableTextField(routingField);          	
	        disableTextField(countryField);
			break;          
          case 'SG':
            ccyField.value='SGD';
            bankCodeField.maxLength = 50;
            branchCodeField.maxLength = 50;
            acNumField.maxLength = 50;
            acNameField.maxLength= 50;
            bankKeyField.maxLength = 50;
            typeField.maxLength = 50;
            routingField.maxLength = 50;
          	enableTextField(ccyField);
            enableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);          	
            enableTextField(bankKeyField);          	
            enableTextField(typeField);          	
            enableTextField(routingField);          	
	        disableTextField(countryField);
			break;          
          default:
            ccyField.value='##TP_CcyCode##';
            countryField.value='##TP_Country##';
            bankCodeField.maxLength = 50;
            branchCodeField.maxLength = 50;
            acNumField.maxLength = 50;
            acNameField.maxLength= 50;
            bankKeyField.maxLength = 50;
            typeField.maxLength = 50;
            routingField.maxLength = 50;
          	enableTextField(ccyField);
            enableTextField(sortField);
            enableTextField(bankCodeField);
            enableTextField(branchCodeField);          	
            enableTextField(bankKeyField);          	
            enableTextField(typeField);          	
            enableTextField(routingField);          	
	        enableTextField(countryField);
        }
        
      }
      
      function regEventHandler() {
        var rbg = document.cardform.Country;
        for (var i = 0; i < rbg.length; i++)
          rbg[i].onclick = clickHandler;
      }
      
      function isNumber(string) {
        var numpattern = /^[0-9]*$/;
        return numpattern.test(string);
      } 
      
      function isFrenchAccount(string) {
        var acpattern = /^[a-zA-Z0-9]*$/;
        return acpattern.test(string);
      }
      
      function testNumbers() {
        //alert("inside testNumbers");
        var error = false;
        var errorlist = '';
        //alert("result of isnumber: "+!isNumber(document.cardform.BranchSort.value));
        if (!isNumber(document.cardform.BranchSort.value)) {
          error = true;
          errorlist = errorlist + '\tBranch Sort Code\n';
        }
        if(!isNumber(document.cardform.BankCode.value)) {
          error = true;
          errorlist = errorlist + '\tBank Code\n';
        }
        if(!isNumber(document.cardform.BranchCode.value)) {
          error = true;
          errorlist = errorlist + '\tBranch Code\n';
        }
        if (getRadioValue(document.cardform.Country)=='FR') {
          if (!isFrenchAccount(document.cardform.AccNumber.value)) {
            error=true;
            errorlist = errorlist +'\tAccount Number\n';
          }
        } else {
          if(!isNumber(document.cardform.AccNumber.value)) {
            error = true;
            errorlist = errorlist + '\tAccount Number\n';
          }
        }
        if (error) {
          alert("please correct the following field(s):-\n" + errorlist);
          return false;
        }
        if (document.cardform.CountryText.value !=null && document.cardform.CountryText.value !="") {
          setRadioValue(document.cardform.Country, document.cardform.CountryText.value);
        }
        document.cardform.epCcy.value = document.cardform.disp_ccy.value;
        var r = true;
        if (ccyCode!=document.cardform.epCcy.value) {
          r = confirm("The users bank account currency differs from their openbet account currency - are you sure you wish to proceed?");
        }
        return r;
      }
      
      function getRadioValue (radioButtonOrGroup) {
        var value = null;
        if (radioButtonOrGroup.length) { // group 
          for (var b = 0; b < radioButtonOrGroup.length; b++)
            if (radioButtonOrGroup[b].checked)
              value = radioButtonOrGroup[b].value;
        }
        else if (radioButtonOrGroup.checked)
          value = radioButtonOrGroup.value;
        return value;
      }

      function setRadioValue (radioButtonOrGroup, value) {
        if (radioButtonOrGroup.length) { // group 
          for (var b = 0; b < radioButtonOrGroup.length; b++)
            if (radioButtonOrGroup[b].checked)
              radioButtonOrGroup[b].value = value;
        }
        else if (radioButtonOrGroup.checked)
          radioButtonOrGroup.value = value;
        return value;
      }

      
      //next three functions allow fields to be disabled in older browsers too (?)
      
      function skip () { this.blur(); }
      
      function disableTextField (field) {
        if (document.all || document.getElementById) {
          field.disabled = true;
          if (field.style) // dynamic style scripting possible
            field.style.backgroundColor = 'rgb(130, 130, 130)';
        }
        else {
          field.oldOnFocus = field.onfocus;
          field.onfocus = skip;
        }
        field.value = '';
      }
      
      function enableTextField (field) {
        if (document.all || document.getElementById) {
          field.disabled = false;
          if (field.style) // dynamic style scripting possible
            field.style.backgroundColor = 'white';
        }
        else {
          field.onfocus = field.oldOnFocus;
        }
      }

	  function validateForm () {
	  	if (testNumbers()) {
	  	
			var error = false;
			var errorlist = '';
			if (document.cardform.BankName.value == "") {
			  error = true;
			  errorlist = errorlist + '\tBank Name\n';
			}
			if(document.cardform.BranchName.value == "") {
			  error = true;
			  errorlist = errorlist + '\tHolding Branch\n';
			}
			if(document.cardform.AccName.value == "") {
			  error = true;
			  errorlist = errorlist + '\tAccount Name\n';
			}
			if(document.cardform.AccountDesc.value == "") {
			  error = true;
			  errorlist = errorlist + '\tAccount Description\n';
			}
			if(document.cardform.AccNumber.value == "") {
			  error = true;
			  errorlist = errorlist + '\tAccount Number\n';
			}
			if (error) {
			  alert("please fill in the following field(s):-\n" + errorlist);
			  return false;
			}
			
			return true;
		}
		
		return false;
	  }
	  	  
      // -->
    </script>
  </head>
  <body onload="regEventHandler(); countryCustomise(##TP_IF {[tpGetVar other]}##'Other'##TP_ELSE##'##TP_Country##'##TP_ENDIF##);">
    ##TP_PLAY error_rpt.html##
    <table cellspacing="0" cellpadding="3" border="0">
      <form name="cardform" action="##TP_CGI_URL##" method="post" onsubmit="return validateForm();">
        <tr>
           <th colspan="2" class="title">Add payment method (Earthport)</th>
        </tr>
        <!-- show the customers details -->
        ##TP_PLAY pmt/pmt_detail_cust.html##
        <tr>
          <td colspan="2">&nbsp;</td>
        </tr>
        <!-- now earthport details -->
        <tr class="subtitle">
          <th colspan="2" align="left">Earthport Details</th>
        </tr>
        <tr>
          <td class="caption" valign="top">Bank Account Country:</td>
          <td>
            <table border="0"><!--<input type="text" name="Country" size="30" />-->
              <tr>
                <td>
					##TP_IF {$ACC(nrows) != 0}##
						##TP_LOOP idx {$ACC(nrows)}##
							<input type="radio" name="Country" value="##TP_cntry_code##" ##TP_IF {$ACC([tpGetVar idx],checked) == 1}##checked ##TP_ENDIF##/> ##TP_cntry_code## - ##TP_country##<br />
							##TP_IF {[tpGetVar idx] == [expr {$ACC(nrows) / 2}]}##
								</td><td>
							##TP_ENDIF##
						##TP_ENDLOOP##
					##TP_ENDIF##
					<input type="radio" name="Country" value="Other"  
					##TP_IF {[tpGetVar other]}##
						checked 
					##TP_ENDIF##
					/> Other&nbsp;
					<input type="text" name="CountryText" size="2" maxlength="2" value="##TP_Country##" />
					<br />
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="caption">Bank Account Currency:</td>
          <td><input type="text" name="disp_ccy" size="4" maxlength="3" value="##TP_epCcy##" disabled /></td>
        </tr>
        <tr>
          <td class="caption">Bank Name:</td>
          <td><input type="text" name="BankName" size="30" value="##TP_BankName##" /></td>
        </tr>
        <tr>
          <td class="caption">Holding Branch:</td>
          <td><input type="text" name="BranchName" size="30" value="##TP_BranchName##" /></td>
        </tr>
        <tr>
          <td class="caption">Bank Account Name:</td>
          <td><input type="text" name="AccName" size="30" value="##TP_AccName##" /></td>
        </tr>
        <tr>
          <td class="caption">Account Description:</td>
          <td><input type="text" name="AccountDesc" size="30" value="##TP_AccountDesc##" /></td>
        </tr>
        <tr>
          <td class="caption">Account Number<sup>*</sup>:</td>
          <td><input type="text" name="AccNumber" size="15" maxlength="14" value="##TP_AccNumber##" /></td>
        </tr>
        <tr>
          <td class="caption">Sort Code<sup>*</sup>:</td>
          <td><input type="text" name="BranchSort" size="7" maxlength="6" value="##TP_BranchSort##" /></td>
        </tr>
        <tr>
          <td class="caption">Branch Code<sup>*</sup>:</td>
          <td><input type="text" name="BranchCode" size="7" maxlength="5" value="##TP_BranchCode##" /></td>
        </tr>
        <tr>
          <td class="caption">Bank Code<sup>*</sup>:</td>
          <td><input type="text" name="BankCode" size="7" maxlength="5" value="##TP_BankCode##" /></td>
        </tr>    
        <tr>
          <td class="caption">Bank Key:</td>
          <td><input type="text" name="BankKey" size="30" maxlength="50" value="##TP_BankKey##" disabled /></td>
        </tr>    
        <tr>
          <td class="caption">Type:</td>
          <td><input type="text" name="Type" size="30" maxlength="50" value="##TP_Type##" disabled /></td>
        </tr>    
        <tr>
          <td class="caption">Routing:</td>
          <td><input type="text" name="Routing" size="30" maxlength="50" value="##TP_Routing##" disabled /></td>
        </tr>    
        <tr>
          <td colspan="2">* Please enter numbers only in these fields, apart from <br />French A/C Number which may also contain A-Z</td>
        </tr> 
        <!-- actions -->
        <tr>
          <th colspan="2" class="buttons">
            <input type="submit" class="btn_def" value="Add Payment Method" />
            <input type="button" class="btn_def" value="Back" onClick="return fs(this,'Back')" />
          </th>
          <input type="hidden" name="SubmitName" value="AddMthd" />
          <input type="hidden" name="CustId" value="##TP_CustId##" />
          <input type="hidden" name="action" value="ADMIN::PMT::do_pay_mthd_add" />
          <input type="hidden" name="pay_mthd" value="EP" />
          <input type="hidden" name="Username" value="##TP_CustUsername##" />
          <input type="hidden" name="AcctNo" value="##TP_AcctNo##" />
          <input type="hidden" name="SettleType" value="##TP_SettleType##" />
          <input type="hidden" name="AcctType" value="##TP_AcctType##" />
          <input type="hidden" name="epCcy" value="" />
          <input type="hidden" name="backAction" value="##TP_backAction##">
        </tr>
      </form>
    </table>
  </body>
</html>
