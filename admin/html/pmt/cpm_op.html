<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
	<title>Customer Payment Method Rule Component</title>
	
	##TP_PLAY JS_WriteSelect.html##
	<script> <!--
		/**
		* Set up the necessary option arrays for building
		* LHS and RHS dropdowns later.
		*/
		var LHSOptionList = new Array();
		var RHSOptionList = new Array();
		##TP_LOOP var_idx {[tpGetVar numVars]}##
			LHSOptionList[LHSOptionList.length] = new Option("##TP_VarName##", "##TP_VarValue##");
			RHSOptionList[RHSOptionList.length] = new Option("##TP_VarName##", "##TP_VarValue##");
		##TP_ENDLOOP##
	
		
		/*
		 * A dropdown has changed
		 */
		function side_dropdown_changed (side) {
		
			// set the objects for left text input and right test input
			var obj_lefttext      = getObj("OpLHSText_section");
			var obj_righttext     = getObj("OpRHSText_section");
			
			
			
			// what side are we dealing with ? - set the 'not' (other) side var
			var not_side = "";
			if (side == "LHS") {
				not_side = "RHS";
			} else {
				not_side = "LHS";
			}
			
			
			
			
			// set the two dropdown object vars
			var obj_changed           = eval("document.opForm.Op"+side+"Select");
			var obj_not_changed       = eval("document.opForm.Op"+not_side+"Select");
			var obj_not_changed_value = obj_not_changed.value;
			
			
			
			// An option's value is of the form :
			// "info type|directive|value"
			// lets now break this up into three variables
			var current_value = obj_changed.value;
			var value_array   = current_value.split("|");
			var info_type     = value_array[0];
			var directive     = value_array[1];
			var value         = value_array[2];
			
			
			// Empty the other dropdown first.
			ClearOptions(obj_not_changed);
			
			
			// Lets go through our JS options array and
			// see which ones we would like to add to our new
			// empty dropdown
			var OptionList = eval(not_side+"OptionList");
			for (i = 0; i < OptionList.length; i++)
			{
				var curr_opt            = OptionList[i];
				var curr_opt_info_type  = curr_opt.value.split("|")[0];
				var curr_opt_directive  = curr_opt.value.split("|")[1];
				var curr_opt_value      = curr_opt.value.split("|")[2];

				// if we have an always show directive 
				// or when the info types match
				// -then add it!
				if (curr_opt_directive == "ALWAYS_SHOW" || curr_opt_info_type == info_type) {
					obj_not_changed[obj_not_changed.length] = curr_opt;
				}
			}
			
			
			
			// Lets set the selected option again in out new drop-down
			update_selected(obj_not_changed,obj_not_changed_value);
			
			
			// Should we be displaying the text boxes for
			// either the LHS or RHS ??
			if (document.opForm.OpLHSSelect.value.split("|")[2] == "-") {
				obj_lefttext.style.display = "block";
			}
			else {
				obj_lefttext.style.display = "none";
			}
			
			if (document.opForm.OpRHSSelect.value.split("|")[2] == "-") {
				obj_righttext.style.display = "block";
			}
			else {
				obj_righttext.style.display = "none";
			}
			
			
			
			
			// Lets now set the two hidden vars with the 'real' values
			// these are the vars we use when submitting the form
			var obj_changed_hidden       = eval("document.opForm.Op"+side);
			var obj_not_changed_hidden   = eval("document.opForm.Op"+not_side);
			
			if (value == "-") {
				var obj_changed_text         = eval("document.opForm.Op"+side+"Text");
				obj_changed_hidden.value     = obj_changed_text.value;
			} else {
				obj_changed_hidden.value     = value;
			}
			
			if (obj_not_changed_value.split("|")[2] == "-") {
				var obj_not_changed_text     = eval("document.opForm.Op"+not_side+"Text");
				obj_not_changed_hidden.value = obj_not_changed_text.value;
			} else {
				obj_not_changed_hidden.value = obj_not_changed_value.split("|")[2];
			}
			
			//alert("obj_changed_hidden="+obj_changed_hidden.value+"   obj_not_changed_hidden="+obj_not_changed_hidden.value);
		}


		/*
		 * When first loading the page we need to set the correct
		 * options as selected. Due to the format of option values
		 * we need a seperate function.
		 */
		function initially_set_selecteds () {
		
			// left hand side
			var the_options = document.opForm.OpLHSSelect.options;
			var found       = false;
		
			for (i = 0; i < the_options.length; i++)
			{
				var curr_opt    = the_options[i];
				if (curr_opt.value.split("|")[2] == document.opForm.OpLHS.value)
				{
					update_selected(document.opForm.OpLHSSelect, curr_opt.value);
					found = true;
				}
			}
			
			if (found) {
				document.opForm.OpLHSText.value = "";
			}
			
			
			// ...and the right hand side
			the_options = document.opForm.OpRHSSelect.options;
			found       = false;
		
			for (i = 0; i < the_options.length; i++)
			{
				var curr_opt    = the_options[i];
				if (curr_opt.value.split("|")[2] == document.opForm.OpRHS.value)
				{
					update_selected(document.opForm.OpRHSSelect, curr_opt.value);
					found = true;
				}
			}
			
			if (found) {
				document.opForm.OpRHSText.value = "";
			}
		}
		 
		/*******************************************************************************
		 *
		 *             HELPER METHODS
		 *
		 *******************************************************************************/
		function getObj(obj) {
			var objRef;

			if(document.all) {
				objRef = eval("document.all." + obj);
			}
			if(document.getElementById) {
				objRef = document.getElementById(obj);
			}

			return objRef;
		}
		
		
		function fs(b,t)
		{
			// somebody may have entered data into the other
			// text boxes and the OpLHS and OpRHS hidden vars 
			// may not have been set. Lets make a dummy call
			// to side_dropdown_changed just to ensure this.
			side_dropdown_changed('LHS');
			
			
			b.form.SubmitName.value=t;
			b.form.submit();
			return true;
		}
		
		
		##TP_COMMENT Clears a select box of all values, important function that needs to be \
                        called before updating a select box.##
		function ClearOptions(OptionList) {
        		##TP_COMMENT Always clear an option list from the last entry to the first.##
			for (x = OptionList.length; x >= 0; x = x - 1) {
				OptionList[x] = null;
			}
		}
		
		
		function update_selected(optionlist, optionvalue){
			for (var i = 0; i < optionlist.options.length;i++){
				if (optionlist.options[i].value == optionvalue){
					optionlist.options[i].selected = true;
				}
			}
		}

	-->
	</script>
</head>
	
<body>
	##TP_PLAY msg_rpt.html##
	##TP_PLAY error_rpt.html##
	
	<form name="opForm" action="##TP_CGI_URL##" method="get">
	<table border="0" cellspacing="0" cellpadding="2">
		<tr>
			<th colspan="3" class="title">
				Customer Payment Method Operation
			</th>
		</tr>
		
		<tr>
			<td class="caption">Sequence</td>
			<td><input name="OpSequence" type="text" size="6" value="##TP_OpSequence##"></td>
			<td>&nbsp;</td>
		</tr>
		
		<tr>
			<td class="caption">Status</td>
			<td colspan="2">
				<select name="OpStatus">
				<script>
					write_select('##TP_OpStatus##'
						,'A','Active'
						,'S','Suspended'
						,'X','Removed'
						)
				</script>
				</select>
			</td>
		</tr>
		
		<tr>
			<td class="caption">Level</td>
			<td><input name="OpLevel" type="text" size="6" value="##TP_OpLevel##"></td>
			<td>&nbsp;</td>
		</tr>
		
		<tr>
			<td class="caption">Left Hand Side</td>
			<td>
				<select name="OpLHSSelect" onChange="javascript:side_dropdown_changed('LHS');">
				<script>
					write_select("##TP_OpLHS##"
						##TP_LOOP var_idx {[tpGetVar numVars]}##
						,"##TP_VarValue##","##TP_VarName##"
						##TP_ENDLOOP##
						)
				</script>
				</select>
				
				
			</td>
			<td>
				<table border="0" cellspacing="0" cellpadding="0"><tr><td>
					<div id="OpLHSText_section" style="display:block;">
						<input name="OpLHSText" type="text" size="20" value="##TP_OpLHS##">
					</div>
				</td></tr></table>
			</td>
		</tr>
		
		<tr>
			<td class="caption">Operator</td>
			<td>
				<select name="OpOperator">
				<script>
					write_select('##TP_OpOperator##'
							,'EQUALS','EQUALS'
							,'NOT_EQUALS','NOT EQUALS'
							,'GT','GREATER THAN'
							,'LT','LESS THAN'
							,'IN','IN'
							,'NOT_IN','NOT IN'
							)
				</script>
				</select>
			</td>
			<td>&nbsp;</td>
		</tr>
		
		<tr>
			<td class="caption">Right Hand Side</td>
			<td>
				<select name="OpRHSSelect" onChange="javascript:side_dropdown_changed('RHS');">
				<script>
					write_select("##TP_OpRHS##"
						##TP_LOOP var_idx {[tpGetVar numVars]}##
						,"##TP_VarValue##","##TP_VarName##"
						##TP_ENDLOOP##
						)
				</script>
				</select>
				
				
			</td>
			<td>
				<table border="0" cellspacing="0" cellpadding="0"><tr><td>
					<div id="OpRHSText_section" style="display:block;">
						<input name="OpRHSText" type="text" size="20" value="##TP_OpRHS##">
					</div>
				</td></tr></table>
			</td>
		</tr>
		
		
		
		<tr>
			<th colspan="3" class="buttons">
			
				<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr>
					<th class="buttons" width="75%">
						
						##TP_IF {[op_allowed EditCPMRules]}##
						##TP_IF {[tpGetVar adding 0]}##
						<input type="button" class="btn_def" value="Add" onClick="return fs(this,'Add');">
						##TP_ENDIF##

						##TP_IF {[tpGetVar editing 0]}##
						<input type="button" class="btn_def" value="Update" onClick="return fs(this,'Update');">
						##TP_ENDIF##
						##TP_ENDIF##
						
						<input type="button" class="btn_def" value="Back"   onClick="return fs(this,'Back')">
					</th>
					
					<th width="25%" class="goaudit">
						##TP_IF {[tpGetVar editing 0]}##
						<input type="button" class="btn_def" value="View Audit History" onclick="return fs(this,'GoAudit')"> 
						##TP_ENDIF##
						<input value="CPMOp" name="AuditInfo" type="hidden">
					</th>
				</tr></table>
				
			</th>
		</tr>
	</table>
	
	<input type="hidden" name="SubmitName" value="" />
	<input type="hidden" name="action" value="ADMIN::CPM_RULES::DoCPMOp" />
	<input type="hidden" name="RuleId" value="##TP_RuleId##" />
	<input type="hidden" name="OpId"   value="##TP_OpId##" />
	<input type="hidden" name="op_id"  value="##TP_OpId##" />
	<input type="hidden" name="CPMRuleType" value="##TP_CPMRuleType##" />
	
	<input type="hidden" name="OpLHS"   value="##TP_OpLHS##" />
	<input type="hidden" name="OpRHS"   value="##TP_OpRHS##" />
	
	<input type="hidden" name="this_action" value="##TP_this_action##" />
	<input type="hidden" name="back_action" value="##TP_back_action##" />
	
	</form>
	
	
	<script language="javascript">
		// now that the both dropdowns have been created ....
		initially_set_selecteds();
		side_dropdown_changed('LHS');
		side_dropdown_changed('RHS');
	</script>
		
</body>
