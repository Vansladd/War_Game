<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
	<title>Event Matching</title>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">

	<!-- $Id: event_choice.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->

<style type="text/css">
	small {font-size: 50%;}
</style>

<script type="text/javascript">


// stores 'source' or 'target' depending on link selected
var event_choice;
var popup;

function go_dd_popup(choice,source_id,source_level) {

	url         = "##TP_CGI_URL##?action=ADMIN::FORM::GoDD&selectable_levels=##TP_IF {[tpGetVar RACE_ID ""] == ""}##EVENT##TP_ELSE##SELN##TP_ENDIF##&choice=";
	url        += choice;
	type        = "popup";
	attributes  = "toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,";
	attributes += "resizable=yes,height=400,width=400";

	popup = window.open(url,type,attributes);
	popup.focus();

	event_choice = choice;

	document.getElementById("source_id").value = source_id;
	document.getElementById("source_level").value = source_level;

}



// interface for the dd popup
function set_vals(level, id, name) {

	document.getElementById(event_choice + "_id").value = id;
	document.getElementById(event_choice + "_level").value = level;

	document.do_manual_links_form.submit();

	return 1;
}


function fs(b,t) {
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function select_form_feed_change (b)
{
	document.location.href = '##TP_CGI_URL##?action=ADMIN::FORM::GoManualLinks&FormProviderId=' + b.value;
}

function delete_link (source_id,source_level)
{

	var ans = window.confirm("Are you sure you want to delete this link?");

	if (!ans) {
		return false;
	}

	document.do_manual_links_form.SubmitName.value="DelLink";
	document.do_manual_links_form.source_id.value = source_id;
	document.do_manual_links_form.source_level.value = source_level;

	document.do_manual_links_form.submit();

	return 1;
}

</script>

##TP_PLAY JS_WriteSelect.html##

</head>

<body>

##TP_PLAY error_rpt.html##
##TP_PLAY msg_rpt.html##

##TP_IF {[op_allowed ManageFormFeeds]}##

##TP_COMMENT header and event selection##
<form name="do_manual_links_form" action="##TP_CGI_URL##">
	<input type="hidden" name="SubmitName" value="InsLink">
	<input type="hidden" name="action"     value="ADMIN::FORM::DoManualLinks">
	<input type="hidden" id="target_id" name="target_id">
	<input type="hidden" id="target_level" name="target_level">
	<input type="hidden" id="source_id" name="source_id">
	<input type="hidden" id="source_level" name="source_level">
	<input type="hidden" name="race_id" value="##TP_RACE_ID##">

<table cellspacing="0" cellpadding="2" border="0">
	<tr>
		<th class="title" colspan="4">Form Feed Matching<br>
		##TP_IF {[tpGetVar RACE_ID ""] == ""}##
			<small><ul><li>Select "Link" to associate a unlinked Form Feed Race with an OpenBet event<li>Select "Re-Link" to replace an existing association with an OpenBet event<li>Linking a form feed race to an OpenBet event will automatically attempt to link all race runners to OpenBet selections</ul></small>
		##TP_ELSE##
			<small><ul><li>Select "Link" to associate a unlinked Form Feed Runner with an OpenBet selection<li>Select "Re-Link" to replace an existing association with an OpenBet selection</ul></small>
		##TP_ENDIF##
		</th>

	</tr>
	##TP_IF {[tpGetVar RACE_ID ""] == ""}##
	<tr class=title>
		<td colspan="4">Form Feed Provider &nbsp;
			<select name="form_provider_id" onchange="select_form_feed_change(this)">
				<script>
					write_select("##TP_SELECTED_FORM_PROVIDER_ID##",
						##TP_LOOP form_idx {[tpGetVar NumFormProviders]}##
						"##TP_FORM_PROVIDER_ID##","##TP_FORM_PROVIDER_NAME##"
						##TP_ENDLOOP##
					);
				</script>
			</select>
		</td>
	</tr>
	##TP_ENDIF##
	##TP_IF {[tpGetVar RACE_ID ""] == ""}##
	<tr>
		<th class=colhead>Form Feed Race</th>
		<th class=colhead>&nbsp;</th>
		<th class=colhead>OpenBet Event</th>
		<th class=colhead>&nbsp;</th>
	</tr>
	##TP_ELSE##
	<tr class=title>
		<td colspan="4">##TP_COURSE_NAME## &#62; ##TP_TITLE## (##TP_RACE_START_TIME##)</td>
	</tr>
	<tr>
		<th class=colhead>Form Feed Runner</th>
		<th class=colhead>&nbsp;</th>
		<th class=colhead>OpenBet Selection</th>
		<th class=colhead>&nbsp;</th>
	</tr>

	##TP_ENDIF##
	##TP_IF {[tpGetVar RACE_ID ""] == ""}##
		##TP_LOOP race_idx {[tpGetVar NumRaces 0]}##
		<tr ##TP_IF {[tpBindGet EV_TYPE_NAME] == ""}## class="inactive" ##TP_ELSE## class="active" ##TP_ENDIF##>
			<td><a href="##TP_CGI_URL##?action=ADMIN::FORM::GoManualLinks&race_id=##TP_RACE_ID##&FormProviderId=##TP_SELECTED_FORM_PROVIDER_ID##">##TP_COURSE_NAME## - ##TP_TITLE## (##TP_RACE_START_TIME##)</a></td>
			<td align="center"><input type="button" name="ev_link_##TP_RACE_ID##" value=##TP_IF {[tpBindGet EV_TYPE_NAME] == ""}##Link##TP_ELSE##Re-Link##TP_ENDIF## onclick="go_dd_popup('target',##TP_RACE_ID##,'RACE')"></td>
			<td>##TP_IF {[tpBindGet EV_TYPE_NAME] != ""}##<a href="##TP_CGI_URL##?action=ADMIN::TYPE::GoType&ClassId=##TP_EV_CLASS_ID##&TypeId=##TP_EV_TYPE_ID##">##TP_EV_TYPE_NAME##</a> - <a href="##TP_CGI_URL##?action=ADMIN::EVENT::GoEv&EvId=##TP_EV_ID##">##TP_DESC## (##TP_EV_START_TIME##)</a>##TP_ENDIF##</td>
			<td>##TP_IF {[tpBindGet EV_TYPE_NAME] != ""}##<input type="button" name="del_link_##TP_RACE_ID##" value="X" onClick="delete_link(##TP_RACE_ID##,'RACE');">##TP_ENDIF##</td>
		</tr>
		##TP_ENDLOOP race_idx##
	##TP_ELSE##
		##TP_LOOP runner_idx {[tpGetVar NumRunners 0]}##
		<tr ##TP_IF {[tpBindGet OC_DESC] == ""}## class="inactive" ##TP_ELSE## class="active" ##TP_ENDIF##>
			<td>##TP_COMP_NAME##(##TP_RUNNER_NUM##)</td>
			<td align="center"><input type="button" name="sel_link_##TP_RUNNER_ID##" value=##TP_IF {[tpBindGet OC_DESC] == ""}##Link##TP_ELSE##Re-Link##TP_ENDIF## onclick="go_dd_popup('target',##TP_RUNNER_ID##,'RUNNER')"></td>
			<td>##TP_IF {[tpBindGet OC_DESC] != ""}##<a href="##TP_CGI_URL##?action=ADMIN::SELN::GoOc&OcId=##TP_OC_ID##">##TP_OC_DESC## (##TP_OC_RUNNER_NUM##)</a>##TP_ENDIF##</td>
			<td>##TP_IF {[tpBindGet OC_DESC] != ""}##<input type="button" name="del_link_##TP_RUNNER_ID##" value="X" onClick="delete_link(##TP_RUNNER_ID##,'RUNNER');">##TP_ENDIF##</td>
		</tr>
		##TP_ENDLOOP runner_idx##
	##TP_ENDIF##

	##TP_IF {[tpGetVar RACE_ID ""] != ""}##
	<tr class=buttons>
		<td colspan="4" align="right"><input type="button" value="Back" name="Back" onClick="javascript:document.location.href = '##TP_CGI_URL##?action=ADMIN::FORM::GoManualLinks&FormProviderId=##TP_SELECTED_FORM_PROVIDER_ID##'"></td>
	</tr>
	##TP_ENDIF##

</table>

</form>

##TP_ENDIF##

</body>
</html>

