<html>
<!-- $Id: missing_xlations.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">

	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">

	<title>
		Missing Translations
	</title>

	##TP_PLAY header_cal.html##
	##TP_PLAY JS_WriteSelect.html##

	<script language=JavaScript>
		function fs(b,t,nameGroup)
		{
			button_id            = nameGroup + t + "Button";
			submit_fied_id       = nameGroup + "SubmitName";
			form_id              = t;
			group_name_field_id  = nameGroup + "langGroupName";

			if (t == "AddGroup") {

				var langs_selected = 0;

				##TP_LOOP no_group_idx {[tpGetVar numNotGroupedLangs]}##

					if (document.getElementById("##TP_NoGroupLangId##").checked == true ) {

						langs_selected = 1;

					}

				##TP_ENDLOOP##

				if (langs_selected == 0) {
					alert("Error creating the group: No languages selected");
					return false;
				}
			}

			if (t == "AddGroup" || t == "UpdGroup" || t == "DeleteGroup") {

				var filename = document.getElementById(group_name_field_id);

				if (checkXlationsFileName(filename.value) == false) {
						// Error already shown in checkXlationsFileName
						return false;
				}

			}

			button_form = document.getElementById(button_id);
			button_form.disabled = true;
			button_form.value = "Busy...";
			button_form.form.SubmitName.value=t;
			button_form.form.submit();
			return true;
		}


		##TP_PLAY upload/JS_CheckFileName.html##
		function checkXlationsFileName(filename)
		{

			if (!checkFileName(filename)) { return false; }

			if (filename.length == 0) {
				alert("The filename must not be empty");
				return false;
			}

			return true;

		}
	</script>
</head>
<body>
	##TP_PLAY error_rpt.html##
	##TP_PLAY msg_rpt.html##
	<div id="error_div"></div>

	<!--
		##TP_COMMENT {
			Form to configure missing translations
		}##
	-->

	##TP_IF {[tpGetVar numNotGroupedLangs] != 0}##
		<form id="missing_translations_conf" method=post action="##TP_CGI_URL##" onsubmit="return checkXlationsFileName(this.filename.value);">
			<input type="hidden" name="action" id="action" value="ADMIN::MISSING_TRANSLATION_TOOL::NextRunConfig"/>
			<input type="hidden" name="SubmitName" id="SubmitName" value=""/>

			<table>

				<tr>

					<th colspan="10" class=title>
						Configure the missing translations tool: Create a group of languages
					</th>

				</tr>

				<tr>

					<th colspan="10">
						One file will be generated per each group. Languages can be part of only one group
					</th>

				</tr>

				<tr>

					<td colspan="2">
						<!-- Create a new group of languages -->
						<label for="langGroupName">
							File Name:
						</label>
					</td>

					<td colspan="8">
						<input type="text" id="langGroupName" name="langGroupName" value="##TP_groupLangName##" size="60"/>
					</td>

				</tr>
				<tr>

					<td colspan="2">
						<label for="fullTranslation">
							Check the box for full Translation:
						</label>
					</td>

					<td colspan="10">
						<input type="checkbox" name="fullTranslation" id="fullTranslation" value="1"/>
					</td>

				</tr>
				<tr>

					<th colspan="10">
						Add languages to the group
					</th>

				</tr>

				##TP_LOOP no_group_idx {[tpGetVar numNotGroupedLangs]}##

					##TP_IF {[tpGetVar no_group_idx]%10 == 0}##

						<tr>

					##TP_ENDIF##

							<td>
								<input type="checkbox" name="##TP_NoGroupLangId##" id="##TP_NoGroupLangId##" value="1"/>
								##TP_NoGroupLangName##
							</td>

					##TP_IF {([tpGetVar no_group_idx]+1)%10 == 0}##

						</tr>

					##TP_ENDIF##

				##TP_ENDLOOP##

				<!--
				Filling the empty columns and closing the last row,
				if the number of languages is not multiple of 10.
				-->
				##TP_IF {(([tpGetVar numNotGroupedLangs] + 1 ) % 10 ) != 0}##

					##TP_TCL {
						tpSetVar EmptyCols [expr 10 - ([tpGetVar numNotGroupedLangs] % 10)]
					}##

					##TP_LOOP i {[tpGetVar EmptyCols]}##
						<td>&nbsp;</td>
					##TP_ENDLOOP##

					</tr>
				##TP_ENDIF##

				<tr>
					<th colspan="10">
						<input type=button class="btn_def" id="AddGroupButton" value="Create file with the selected languages" onClick="return fs(this,'AddGroup','');">
					</th>
				</tr>
			</table>
		</form>

	##TP_ELSE##
		<table>

			<tr>

				<th colspan="10" class=title>
						Configure the missing translations tool: Create a group of languages
				</th>

			</tr>

			<tr>
				<td>
					There is no more languages that can be grouped
				</td>
			</tr>

		</table>
	##TP_ENDIF##


	<!--
		##TP_COMMENT {
			Form to configure the next execution of the tool "missing translations"
		}##
	-->

	<table>

		##TP_IF {[tpGetVar numGroups] != 0}##

			<tr>

				<th colspan="4" class="title">
					Files that will be generated by the missing translations tool
				</th>
				<th colspan="2">

					<form id="reset_missing_translations_conf" method=post action="##TP_CGI_URL##?action=ADMIN::MISSING_TRANSLATION_TOOL::ResetMissingTransCfg">
							<input type="submit" class="btn_def" id="Reset" value="Reset Configuration">
					</form>
				
				</th>

			</tr>

			<tr>

				<th>
					Group Name
				</th>

				<th>
					Full Translation
				</th>

				<th colspan="2">
					Languages
				</th>

				<th colspan="2">
					Actions
				</th>

			</tr>

			##TP_LOOP group_idx {[tpGetVar numGroups]}##

				<tr>
					<form>
						<input type="hidden" name="action" id="action" value="ADMIN::MISSING_TRANSLATION_TOOL::NextRunConfig"/>
						<input type="hidden" name="SubmitName" id="##TP_GroupName##SubmitName" value=""/>
						<input type="hidden" name="groupName" id="##TP_GroupName##groupName" value="##TP_GroupName##"/>
						<input type="hidden" name="isFullXlated" id="##TP_GroupName##isFullXlated" value="##TP_FullTranslated##"/>
						
						<td>
							<input type="text" name="##TP_GroupName##langGroupName" id="##TP_GroupName##langGroupName" value="##TP_GroupName##"/>
						</td>

						<td>
							<input type="checkbox" name="##TP_GroupName##fullTranslation" id="##TP_GroupName##fullTranslation" value="1" ##TP_IF {[tpBindGet FullTranslated] == 1}## checked ##TP_ENDIF##/>
						</td>

						<td colspan="2">
							##TP_LOOP lang_idx {[tpBindGet NumLangs]}##

								<input type="checkbox" name="##TP_GroupName####TP_LangId##" id="##TP_GroupName####TP_LangId##" value = "1" checked/>
								##TP_LangName##

							##TP_ENDLOOP##
						</td>

						<td>
							<input type=button class="btn_def" id="##TP_GroupName##UpdGroupButton" value="Update Group" onClick="return fs(this,'UpdGroup','##TP_GroupName##');">
						</td>

						<td>
							<input type=button class="btn_def" id="##TP_GroupName##DeleteGroupButton" value="Ungroup" onClick="return fs(this,'DeleteGroup','##TP_GroupName##');" ##TP_IF {[tpBindGet NumLangs] == 1}## disabled ##TP_ENDIF##>
						</td>

					</form>	
				</tr>

			##TP_ENDLOOP##

		##TP_ELSE##

			<!--
				 This should never happen 
			-->
			<tr>
				<td>
					There is no groups defined
				</td>
			</tr>

		##TP_ENDIF##
	</table>

	
	<!--
		##TP_COMMENT { 
			Upload files form
		}##
	-->
	<h2>Upload files</h2>
	<form id="files_form" method=post action="##TP_CGI_URL##?action=ADMIN::MISSING_TRANSLATION_TOOL::UploadCSVFile" enctype="multipart/form-data" onsubmit="return checkXlationsFileName(this.filename.value);">
		<input type="hidden" name="returl" value="##TP_CGI_URL##">
		<input type="hidden" name="SubmitName" value="">
	
		<table border=0 cellspacing=0 cellpadding=3>
			<tr>
				<th colspan=2 class=title>
					Upload Translations
				</th>
			</tr>
			<tr>
				<td class=caption>
					Filename
				</td>
				<td>
					<input type="file" name="filename" size=40>
				</td>
			</tr>
			<tr>
				<th colspan=2 class=buttons>
					<input type="submit" class="btn_def" value="Upload File">
				</th>
			</tr>
		</table>
	</form>

	<!--
		##TP_COMMENT { 
			form for list of languages
		}##
	-->
	<h2>List of language files</h2>

	<form action="##TP_CGI_URL##" method="get" name="updated_xlations_list">
		<input type="hidden" name="action" value="ADMIN::MISSING_TRANSLATION_TOOL::GoMissingXlations">
		<input type="hidden" name="SubmitName" value="">

		<table border=0 cellspacing=0 cellpadding=3>
			<tr>
				<th colspan=4 class=title>
					Updated Translations
				</th>
			</tr>
			<tr>
				<td colspan=4>
					&nbsp;Language:
					<select name="Language" onchange="this.form.submit();">
						<script>
							write_select('##TP_Language##'
								##TP_LOOP lang_idx {[tpGetVar NrLangs]}##
									,'##TP_LangCode##',"##TP_LangDesc##"
								##TP_ENDLOOP##);
						</script>
					</select>
				</td>
			</tr>
			<tr>
				<th class=colhead>File created</th>
				<th class=colhead>Click to download file</th>
				<th class=colhead>Process uploaded file</th>
				<th class=colhead>Delete uploaded file</th>
			</tr>

			##TP_IF {[tpGetVar NrFiles]}##
				##TP_LOOP file_idx {[tpGetVar NrFiles]}##
				<tr>
					<td>##TP_FileMtime##</td>
					<td>
						<a href="##TP_CGI_URL##?action=ADMIN::MISSING_TRANSLATION_TOOL::DownloadCSVFile&filename=##TP_FileFullName##">
							##TP_FileName##
						</a>
					</td>
					<td valign=top align=center>
						<a href="##TP_CGI_URL##?action=ADMIN::MISSING_TRANSLATION_TOOL::ProcessCSVFile&filename=##TP_FileFullName##" onclick="return confirm('Do you want to process the file ##TP_Filename##?')">
							[process]
						</a>
					</td>
					<td valign=top align=center>
						<a href="##TP_CGI_URL##?action=ADMIN::MISSING_TRANSLATION_TOOL::DelCSVFile&filename=##TP_FileFullName##" onclick="return confirm('Are you sure you want to delete the file ##TP_FileName##?')">
							[delete]
						</a>
					</td>
				</tr>
				##TP_ENDLOOP##
			##TP_ELSE##
				<tr>
					<td colspan=4>
						No files exist.
					</td>
				</tr>
			##TP_ENDIF##
		</table>
	</form>

	<!--
		##TP_COMMENT { 
			How to use notes
		}##
	-->
	<h2>Notes</h2>
	<b>Notes</b>
	<br>
	Translation files to be uploaded must be in <a href="#CSV">USC-2</a> format.
	The first line of each file must contain the appropriate column names for the file. The types of file are as follows:
	</br>

	<table cellspacing=1 border=0 cellpadding=1>
		<tr>
			<th colspan=5 class=title>
				File Formats
			</th>
		</tr>
		<tr>
			<th class=colhead>
				Translations
			</th>
		</tr>
		<tr>
			<td valign=top align=left>
				<ol>
					<li>CODE</li>
					<li>GROUP</li>
					<li>STATUS</li>
					<li>ENGLISH</li>
					<li>LANG</li>
					<li>TRANS</li>
				</ol>
			</td>
		</tr>
	</table>
	<br><br>
	<a name="CSV">
		<b>USC-2 Files</b>
	</a>
	<br>

	<p>
		A USC-2 file is a tab-separated Unicode CSV file. Fields which themselves contain tab characters need to be enclosed in double quotes.
	</p>
	<br><br>
</body>
</html>
