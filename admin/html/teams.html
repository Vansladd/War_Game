<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<!-- $Id: teams.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
	<title>Teams</title>
	<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
	<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
	<script type="text/javascript" language="JavaScript">
<!--

self.focus();

document.teams = new Object();
##TP_LOOP c_idx {$TEAMS(nrows)}##
	document.teams['##TP_teamID##'] = '##TP_ESC esc_js####TP_teamCode##^##TP_teamName##^##TP_teamSortName####TP_ESC##';
##TP_ENDLOOP##

function _onload()
{
	##TP_IF {[tpBindGet selectedTeamID] != ""}##
		var t = document.team.teamList,
			o = t.options,
			i = 1,
			len = t.length;

		for(; i < len; i++) {
			if(o[i].value == '##TP_selectedTeamID##') {
				showTeam((t.selectedIndex = i));
				return;
			}
		}
	##TP_ENDIF##

	showTeam((document.team.teamList.selectedIndex = 0));
}



function showTeam(_id) {

	var t = document.team,
		id = t.teamList.options[_id].value,
		team = _id == 0 ? null : document.teams[id].split('^');
		id,

	t.teamID.value = !team ? "" : id;
	t.teamCode.value = !team ? "" : team[0];
	t.teamName.value = !team ? "" : team[1];
	t.teamSortName.value = !team ? "" : team[2];

	if(_id == 0) {
		t.teamImage.value = "";
		t.delTeamB.disabled = true;
		if(!parent.blankPlayer) {
			parent.blankPlayer = true;
			parent.players.location.href="##TP_CGI_URL##?action=ADMIN::TEAMPLAYER::doBlank";
		}
	}
	else {
		t.teamImage.value = t.teamCode.value + ".gif";
		t.delTeamB.disabled = false;
		parent.blankPlayer = false;
		parent.players.location.href="##TP_CGI_URL##?action=ADMIN::TEAMPLAYER::doPlayer&SubmitName=show&teamID=" + id;
	}

	##TP_IF {[tpGetVar manageTeamPlayer 0] != 1}##
		t.addUpdTeamB.disabled = true;
		t.delTeamB.disabled = true;
	##TP_ENDIF##
}



function addUpdTeam()
{
	if(!##TP_manage##) {
		alert("You don't have permission to do this sort of thing");
		return;
	}

	var t = document.team;

	if(t.teamName.value.length < 1 || t.teamCode.value.length < 1) {
		alert("Missing team name or code");
		return;
	}

	t.teamCode.value = t.teamCode.value.toUpperCase();

	if(t.teamList.selectedIndex == 0) {
		t.SubmitName.value="add";
		if(!uniqTeamCode(t.teamCode.value)) {
			alert("Team code must be unique");
			return;
		}
	}
	else {
		t.SubmitName.value = "upd";
	}
	parent.players.location.href = "##TP_CGI_URL##?action=ADMIN::TEAMPLAYER::doBlank";
	t.submit();
}



function delTeam()
{
	if(!##TP_manage##) {
		alert("You don't have permission to do this sort of thing");
		return;
	}
	if(!confirm("Are you sure you want to delete this team ?")) {
		return;
	}
	var t = document.team;

	if(t.teamList.selectedIndex == 0) {
		alert("Cannot delete this item");
		return;
	}
	parent.players.location.href = "##TP_CGI_URL##?action=ADMIN::TEAMPLAYER::doBlank";

	t.SubmitName.value = "del";
	t.submit();
}


function uniqTeamCode(inCode)
{
	var i = 1,
		o = document.team.teamList.options,
		teams = document.teams,
		len = o.length;

	for(; i < len; i++) {
		if(teams[o[i].value].indexOf(inCode) == 0) {
			return false;
		}
	}

	return true;
}


function stopImageEdits(textItem) {

	var t = doucument.team,
		value = t.teamCode.value;

	if(value != "") {
		textItem.value = value + ".gif";
	} else {
		textItem.value = "";
	}
	setTimeout("t.teamName.focus()", 1);
}

//-->
</script>
</head>

<body onload="_onload()">
<form name="team" action="##TP_CGI_URL##" method=get>
<input name="action" type="hidden" value="ADMIN::TEAMPLAYER::doTeam">
<input name="SubmitName" type="hidden" value="">

<table border="0" cellpadding="1" cellspacing="0" width="650">
<tr>
	<td width="40%" rowspan="6" valign="top">
		<select style="width:300px" size="12" name="teamList" onchange="showTeam(this.selectedIndex)">
			<option value="-1">New...</option>
				##TP_LOOP c_idx {$TEAMS(nrows)}##
					<option value="##TP_teamID##">##TP_teamMenuName##</option>
				##TP_ENDLOOP##
		</select>
	</td>
	<th class=title colspan="2">Teams</th>
</tr>
<tr>
	<td width="100" class="caption">Name</td>
	<td>
		<input name="teamID" type="hidden" value="" />
		<input name="teamName" type="text" size="25" maxlength="32" onchange="document.team.teamSortName.focus()"/>
	</td>
</tr>
<tr>
	<td class="caption">Sort Name</td>
	<td>
		<input name="teamSortName" type="text" size="25" maxlength="32"/>
	</td>
</tr>
<tr>
	<td class="caption">Code</td>
	<td>
		<input name="teamCode" type="text" size="4" maxlength="3"/>
	</td>
</tr>
<tr>
	<td class="caption">Image</td>
	<td>
		<input name="teamImage" disabled type="text" size="10" onfocus="stopImageEdits(this)"/>
	</td>
</tr>
<tr>
	<th class=buttons colspan="2">
		<input name="addUpdTeamB" type="button" class="btn_def" value="Save" onclick="javascript:addUpdTeam()"/>
		<input name="delTeamB" type="button" class="btn_def" value="Delete" onclick="javascript:delTeam()"/>
	</th>
</tr>
</table>
</form>

</body>
</html>
