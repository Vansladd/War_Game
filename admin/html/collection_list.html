<html>
<!-- $Id: collection_list.html,v 1.1.1.1 2011/10/04 10:54:25 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Collections</title>

##TP_PLAY JS_WriteSelect.html##

<script language="JavaScript">

// Accepts digits only
var regex_NumMktPerCollection = /^[0-9]*$/;
var db_NumMktPerCollection    = ##TP_TCL {tpBufWrite [tpGetVar NumMktPerCollection]} ## ;

function check_valid (b,t)
{	
	if ( b.form.NumMktPerCollection.value == "" || !regex_NumMktPerCollection.test(b.form.NumMktPerCollection.value) ) {
		alert ("Please enter a valid value for the number of displayed markets")
		return false;
	} else if ( b.form.NumMktPerCollection.value == db_NumMktPerCollection ) {
		alert ("Number of markets have not changed")
	} else {

	action = "ADMIN::COLLECTION::GoCollection&SubmitName=" + t + "&NumMktPerCollection=" +  b.form.NumMktPerCollection.value + "&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]}##";

	url = "##TP_CGI_URL##?action=" + action ;

	document.location.href = url ;
	}
}

function fs(b,t)
{
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

function select_change() {
	document.sportFm.action.value="ADMIN::COLLECTION::GoCollectionList";
	document.sportFm.submit();
}

function delete_collections(b) {

	numDelBoxes = b.form.delBoxes.length ;
	delCollectionList = "" ;

	if (!numDelBoxes ) {
		// We only have 1 entry, the delBoxes.length check picks up nothing
		// so access the one field manually
		if ( b.form.delBoxes.checked ) {
			delCollectionList = delCollectionList + b.form.delBoxes.value ;
		}
	} else {
		// deal with multiple check boxes
		for (i = 0; i < numDelBoxes; i++) {
			if ( b.form.delBoxes[i].checked ) {
				delCollectionList = delCollectionList + b.form.delBoxes[i].value + "," ;
			}
		}
	}

	if ( delCollectionList == "" ) {
		alert ("There are no collections selected for delete.") ;
	} else {
		action = "ADMIN::COLLECTION::DelCollection&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##&delCollectionList=" + delCollectionList ;

		url = "##TP_CGI_URL##?action=" + action
		document.location.href = url
	}
}

</script>

</head>
<body>
##TP_PLAY error_rpt.html##


<table border=0 cellspacing=0 cellpadding=3 bgcolor="#10137c">
<tr>
	<th class=title colspan=6>
	Collections
	</th>
</tr>

##TP_IF {[tpGetVar NumSports 0]}##

<tr>
<form method="get" action="##TP_CGI_URL##" name="sportFm">
	<td class="caption">Show Collections Assigned to: </td>

	<td >
		<select name="SportId" onChange="select_change();">

			##TP_IF {[tpGetVar SportId] == ""}##
				<option value="" selected="selected">All</option>
			##TP_ELSE##
				<option value="">All</option>
			##TP_ENDIF##

			##TP_LOOP sport_idx {[tpGetVar NumSports]}##

				##TP_IF {[tpGetVar SelectedIdx] == [tpGetVar sport_idx] } ##
					<option value="##TP_sportId##" selected="selected">##TP_sportName##</option>
				##TP_ELSE##
					<option value="##TP_sportId##">##TP_sportName##</option>
				##TP_ENDIF##

			##TP_ENDLOOP##
			
		</select>
	</td>
</tr>
<tr>
	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
		<td class="caption" >Number of markets displayed per collection ( global )</td>
		<td><input type="text" name="NumMktPerCollection" value="##TP_TCL {tpBufWrite [tpGetVar NumMktPerCollection]} ##" maxlength="3" size=3 />  
		<input type=button class="btn_def" value="Update number" onClick="return check_valid(this,'UpdNumMkts')"></td>
	##TP_ELSE##
		<td class="caption" >Number of markets displayed per collection</td>
		<td><input disabled="true" type="text" name="NumMktPerCollection" value="##TP_TCL {tpBufWrite [tpGetVar NumMktPerCollection]} ##" maxlength="3" size=3 /></td>
	##TP_ENDIF##
</tr>

<tr>
	<td> &nbsp;&nbsp;</td>
	<td colspan="4">	
	</td>
</tr>

##TP_ELSE##
<tr>
	<td colspan=3>
	<b><i>There are no event sports defined</i></b>
	</td>
</tr>

##TP_ENDIF##

##TP_IF {[tpGetVar NumCollections 0]}##
<tr>
	<th class=colhead><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollectionList&order=name&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">Name</A></th>
	<th class=colhead><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollectionList&order=disp&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">Display Order</A></th>
	<th class=colhead><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollectionList&order=exp&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">Expanded</A></th>
	<th class=colhead><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollectionList&order=prim&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">Primary</A></th>
	<th class=colhead><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollectionList&SportId=##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">Sport</A></th>

	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
		<th class=colhead>Select to delete</th>
	##TP_ENDIF##

</tr>
##TP_LOOP collection_idx {[tpGetVar NumCollections]}##

<tr>
	<td><A href="##TP_CGI_URL##?action=ADMIN::COLLECTION::GoCollection&SubmitName=GotoUpd&CollectionId=##TP_collectionId##">##TP_cName##</A></td>
	<td >##TP_cDisporder##</td>
	<td >##TP_cExpanded##</td>
	<td >##TP_cPrimary##</td>
	<td >##TP_sName##</td>

	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
		<td > <input  name="delBoxes" type="checkbox" value="##TP_collectionId##"  > </td>
	##TP_ENDIF##

</tr>
##TP_ENDLOOP##


##TP_ELSE##
<tr>
	<td colspan=3>
	<b><i>There are no market collections defined for your selection</i></b>
	</td>
</tr>

##TP_ENDIF##

<tr>
	<form action="##TP_CGI_URL##" method="get">

	##TP_IF {[OT_CfgGet FUNC_MENU_COLLECTIONS 0] && [op_allowed ManageCollection]}##
	
		##TP_IF {[tpGetVar NumCollections 0]}##
			<th class=buttons colspan=1>
				<input type=button class="btn_def" value="Add" onClick="return fs(this,'GotoAdd')">
			</th>
			<th class=buttons colspan=5>
				<input type=button class="btn_def" value="Delete" onClick="delete_collections(this)">
			</th>
		##TP_ELSE##
			<th class=buttons colspan=6>
				<input type=button class="btn_def" value="Add" onClick="return fs(this,'GotoAdd')">
			</th>
		##TP_ENDIF##
	
	##TP_ENDIF##

	<input type=hidden name=SubmitName value="">
	<input type=hidden name=SelectedSportId value="##TP_TCL {tpBufWrite [tpGetVar SportId]} ##">
	<input type=hidden name=action value="ADMIN::COLLECTION::GoCollection">
	</form>
</tr>


</table>
</body>
</html>
