<script>

	var man_adj_subtype_desc = new Array();
	var man_adj_subtype = new Array();

	/* sub-types */
	##TP_LOOP madj_type_idx {[tpGetVar NumManAdjTypes]}##
		##TP_IF {[tpGetVar MadjNumSubTypes] != 0}##
			man_adj_subtype["t##TP_ManAdjType##"]=new Array(##TP_LOOP madj_subtype_idx {[tpBindGet MadjNumSubTypes]}##"##TP_MadjSubType##"##TP_IF {[tpGetVar madj_subtype_idx]!=[expr {[tpBindGet MadjNumSubTypes]-1}]}##, ##TP_ENDIF####TP_ENDLOOP##);
			man_adj_subtype_desc["t##TP_ManAdjType##"]=new Array(##TP_LOOP madj_subtype_idx {[tpBindGet MadjNumSubTypes]}##"##TP_MadjSubTypeDesc##"##TP_IF {[tpGetVar madj_subtype_idx]!=[expr {[tpBindGet MadjNumSubTypes]-1}]}##, ##TP_ENDIF####TP_ENDLOOP##);
		##TP_ELSE##
			man_adj_subtype["t##TP_ManAdjType##"]=new Array();
			man_adj_subtype_desc["t##TP_ManAdjType##"]=new Array();
		##TP_ENDIF##
	##TP_ENDLOOP##

	function updateMadjSubTypeList(_selected) {

		var c = document.ManAccAdj.Type;
		var opt = document.ManAccAdj.SubType.options;

		var cId = c.options[c.selectedIndex].value;
		var cName = c.options[c.selectedIndex].text;

		// Delete everything
		opt.length=0;

		if (man_adj_subtype["t" + cId] != "") {

			opt[opt.length] = new Option("Choose subtype", "-1");

			var nm = man_adj_subtype_desc["t" + cId];
			var id = man_adj_subtype["t" + cId];

			for (i=0;i<nm.length;i++) {
				if (_selected == id[i]) {
					var sel_opt = i+1
				}

				opt[opt.length] = new Option( nm[i], id[i] );
			}

			document.ManAccAdj.SubType.style.display = "";

		} else {
			opt[opt.length] = new Option("Choose subtype", "");
			document.ManAccAdj.SubType.style.display = "none";
		}

		if (sel_opt) {
			opt.selectedIndex = sel_opt;
		} else {
			opt.selectedIndex = -1;
		}
	}

	function fsManAdj(b,t) {
		switch ("##TP_ManAdj_ref_key##") {
			case "BET":
				var acct_txt = "for bet, bet_id:##TP_ManAdj_ref_id##?";
				break;
			case "POOL":
				var acct_txt = "for bet, bet_id:##TP_ManAdj_ref_id##?";
				break;
			case "XBET":
				var acct_txt = "for bet, bet_id:##TP_ManAdj_ref_id##?";
				break;
			case "PMT":
				var acct_txt = "for payment id:##TP_ManAdj_ref_id##?";
				break;
			default:
				var acct_txt = "for account number ##TP_AcctNo##?";
		}


		if (t == "DoManAdj") {
			if (b.form.Description.value == "") {
				alert("Please enter a description");
				return false;
			}
			if (b.form.MadjOperNotes.value == "") {
				alert("Please enter operator notes");
				return false;
			}
			if (b.form.Amount.value == "") {
				alert("Please enter an amount!");
				return false;
			}
			if (isNaN(b.form.Amount.value)) {
				alert("Amount must be numeric");
				return false;
			} else if (b.form.Amount.value == 0) {
				alert("Can't make a manual adjustment of zero!");
				return false;
			}
			var r = confirm("Make this adjustment " + acct_txt);
			if (r == false) {
				return false;
			}
		}

		b.disabled = true;
		b.value = "Busy...";
		b.form.SubmitName.value=t;
		b.form.submit();
		return true;
	}

</script>
<form name="ManAccAdj" action="##TP_CGI_URL##" method=get>

<table border="0" cellspacing="0" cellpadding="2">
<tr>
	<th class="title" colspan="2">##TP_XL {Admin.Man_Adj.CUST_ACCT_ADJ}##</th>
</tr>
##TP_IF {[tpGetVar NumManAdjTypes] > 0}##

	<tr>
		<td class=caption>##TP_XL {Admin.Man_Adj.TYPE}##</td>
		<td>
			<select name="Type" id="Type" onchange="updateMadjSubTypeList()">
	##TP_LOOP madj_type_idx {[tpGetVar NumManAdjTypes]}##
				<option value="##TP_ManAdjType##">##TP_ManAdjText##</option>
	##TP_ENDLOOP madj_type_idx##
			</select>
			&nbsp;<select name="SubType" id="SubType" style="display:none">
					<option value="-1"> Choose subtype </option>
			</select>
		</td>
	</tr>
	<script type="text/javascript">
		updateMadjSubTypeList("##TP_SubType##");
	</script>

##TP_ENDIF##
<tr>
	<td class="caption">##TP_XL {Admin.Man_Adj.DESCRIPTION}##</td>
	<td>
		<input type="text" size="40" maxlength="80" name="Description" value="##TP_Description##">
	</td>
</tr>
<tr>
	<td class="caption">##TP_XL {Admin.Man_Adj.BOOKMAKER_ACCT}##</td>
	<td>
		<select name="BMAcctType">
			<script>
				write_select(
					'##TP_BMAcctType##'
						,'MAN','##TP_XL {Admin.Man_Adj.MANUAL_ADJUSTMENT}##'
						##TP_IF {[OT_CfgGet FUNC_MAN_ADJ_ALLOW_CSH 1]}##,'CSH','##TP_XL {Admin.Man_Adj.CASH_DEP_WTD}##'##TP_ENDIF##
						##TP_IF {[OT_CfgGet FUNC_MAN_ADJ_ALLOW_BET 1]}##,'BET','##TP_XL {Admin.Man_Adj.BET_STKE}##'##TP_ENDIF##
				);
			</script>
		</select>
	</td>
</tr>
<tr>
	<td class="caption">##TP_XL {Admin.Man_Adj.AMOUNT}## (##TP_AcctCCY##)</td>
	<td nowrap>
		<input type="text" name="Amount" size=14 maxlength=14 value="##TP_Amount##">&nbsp;
		##TP_IF {[OT_CfgGet MAN_ADJ_OPTION_WITHDRAWABLE 1]}##
			<input type=checkbox name=Withdrawable value="Y" checked>&nbsp;<b>##TP_XL {Admin.Man_Adj.WITHDRAWABLE}##</b>
		##TP_ELSE##
			<input type=hidden name=Withdrawable value="Y">
		##TP_ENDIF##
	</td>
</tr>
<tr>
	<td class="caption">##TP_XL {Admin.Man_Adj.DATE_RANGE}##</td>
	<td>
		<input type="text" name="SR_date_1" value="##TP_SR_date_1##" size="19">
		&nbsp;##TP_XL {and}##&nbsp;
		<input type="text" name="SR_date_2" value="##TP_SR_date_2##" size="19">&nbsp;(yyyy-mm-dd hh:mm:ss)
	</td>
</tr>
<tr>
	<td class="caption">##TP_XL {or}##</td>
	<td>
		<select name="SR_date_range">
		##TP_IF {[OT_CfgGet CUST_PREFS_DEFAULT_DATE_NA 0]}##
			<option value="" selected>##TP_XL {N/A}##</option>
			<option value="TD">##TP_XL {Today}##</option>
		##TP_ELSE##
			<option value="">##TP_XL {N/A}##</option>
			<option value="TD" selected>##TP_XL {Today}##</option>
		##TP_ENDIF##
			<option value="YD">##TP_XL {Yesterday}##</option>
			<option value="L3">##TP_XL {Last 3 days}##</option>
			<option value="L7">##TP_XL {Last 7 days}##</option>
			<option value="CM">##TP_XL {Current month}##</option>
		</select>
	</td>
</tr>
<tr>
	<td class="caption">##TP_XL {Admin.Man_Adj.OPERATOR_NOTES}##</td>
	<td>
		<textarea cols=50 rows=4 wrap=virtual name="MadjOperNotes">##TP_MadjOperNotes##</textarea>
	</td>
</tr>
<tr>
	<td>&nbsp;</td>
	<td>
		<font color="green">
			A <b>positive</b> amount will result in
			a <b>credit</b> to the customer's account.
		</font>
	</td>
</tr>
<tr>
	<td colspan=2 class=buttons>
		<input type="button" class="btn_def" value="##TP_XL {Admin.Man_Adj.DO_MAN_ADJ_BUTTON}##" onClick="return fsManAdj(this,'DoManAdj')">
		<input type="button" class="btn_def" value="##TP_XL {Admin.Man_Adj.VIEW_MAN_ADJ_BUTTON}##" onClick="return fsManAdj(this,'ViewManAdj')">
	</td>
</tr>
</table>
<!-- To link ManAdj with a bet or pmt -->
<input type="hidden" name="ManAdj_ref_key"    value="##TP_ManAdj_ref_key##">
<input type="hidden" name="ManAdj_ref_id"     value="##TP_ManAdj_ref_id##">
<input type="hidden" name="ManAdj_group"      value="##TP_ManAdj_group##">
<input type="hidden" name="ReturnLoc"         value="##TP_ReturnLoc##">

<input type="hidden" name="AcctCCY" value="##TP_AcctCCY##">
<input type="hidden" name="CustId" value="##TP_CustId##">
<input type="hidden" name="AcctId" value="##TP_AcctId##">
<input type="hidden" name="current_uid" value="##TP_madjuid##">
<input type="hidden" name="SubmitName" value="">
<input type="hidden" name="action" value="ADMIN::ADJ::DoManAdj">
</form>
