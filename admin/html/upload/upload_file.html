<html>
<!-- $Id: upload_file.html,v 1.1.1.1 2011/10/04 10:54:26 xbourgui Exp $ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=##TP_CHARSET##">
<link rel="stylesheet" type="text/css" href="##TP_CGI_URL##?action=stylesheet">
<title>Openbet Administration - Uploaded File Contents</title>
</head>

<script language="JavaScript">

function confirm_csv_delete(f)
{
	var confirmed = confirm("Delete " + f.Filename.value);
	return confirmed;
}

function fs(b,t)
{
	if (t == 'FileLoad' && !confirm("Upload file?")) {
		return false;
	}
	b.disabled = true;
	b.value = "Busy...";
	b.form.SubmitName.value=t;
	b.form.submit();
	return true;
}

</script>
<body>
##TP_PLAY error_rpt.html##
<table border="0" cellspacing="0" cellpadding="1">
##TP_IF {[tpGetVar UploadFailed 0]}##
	<tr class="infono"><td><b>
	Upload Failed: ##TP_ErrMsg## at line ##TP_ErrLine##
	</b></td>
##TP_ELSEIF {[tpGetVar UploadOK 0]}##
	<tr class="infoyes"><td><b>File uploaded OK</b> ##TP_IF {[tpBindGet BatchRefID] != ""}##(Batch Reference Code: ##TP_BatchRefID##)##TP_ENDIF##</td></tr>
##TP_ENDIF##
</table>
##TP_IF {[tpGetVar num_success ""] != ""}##
<br/>
<table border="0" cellspacing="0" cellpadding="1">
<tr>
	<tr class="##TP_IF {[tpGetVar num_success 0] == 0}##infono##TP_ELSE##infoyes##TP_ENDIF##"><td><b>##TP_TCL {tpGetVar num_success 0}## out of ##TP_TCL {tpGetVar num_total 0}## successfully processed</b></td></tr>
</tr>
</table>
##TP_ENDIF##
<form method=get action="##TP_CGI_URL##" >
##TP_IF {([tpGetVar FileType] == "adjustments" || [tpGetVar FileType] == "man_bets") && [tpGetVar BatchRefReuse] == 1}##
<input type=hidden name=batch_ref_reuse value=1>
<table cellspacing=0 cellpadding=3 border=0>
<tr class=infono>
	<td>&nbsp;&nbsp;
	<b>This batch reference ID has been used previously; if you would still like to add these transactions to batch ##TP_BatchRefID## then please re-submit now</b>
	&nbsp;&nbsp;</td>
</tr>
</table>
##TP_ENDIF##
##TP_IF {[tpGetVar FileType] == "adjustments" || [tpGetVar FileType] == "man_bets"}##
<!--These hidden things are for OnCourse stuff.-->
<input type=hidden name=course value="##TP_CourseKey##">
<input type=hidden name=meeting value="##TP_MeetingKey##">
<input type=hidden name=ocb_id value="##TP_OCBId##">
<table border=0>
<tr>
    <td colspan=##TP_NumColsPlus1##>
    <b>Use Batch Reference:</b><input type=checkbox name=use_batch_ref value=1 ##TP_BatchRefChecked##>
    </td>
</tr>
<tr>
    <td colspan=##TP_NumColsPlus1##>
	##TP_IF {[tpGetVar BatchRefReuse] == 1}##
    <b>Batch Reference Code:</b> ##TP_BatchRefID##
	<input type=hidden name=batch_ref_id value=##TP_BatchRefID##>
	##TP_ELSE##
    <b>Batch Reference Code:</b><input type=text name=batch_ref_id size=10 maxlength=10 value=##TP_BatchRefID##><i>(leave this blank if you wish the system to automatically generate a code)</i>
	##TP_ENDIF##
    </td>
</tr>
<tr>
    <td colspan=##TP_NumColsPlus1##>
    <b>Batch Reference Location:</b><input type=text size=100 maxlength=100 name=batch_ref_location>
    </td>
</tr>
<tr>
    <td colspan=##TP_NumColsPlus1##>
    <b>No balance checks:</b><input type=checkbox name=no_balance_chk value=1 ##TP_BalanceChkChecked##>
    </td>
</tr>
</table>
##TP_ENDIF##
<table border=1 cellspacing=0 cellpadding=1>
<tr>
	<td colspan=##TP_NumColsPlus1##>
	##TP_FileName## (##TP_FileType##)
	</td>
</tr>
##TP_IF {[tpGetVar HeaderOK 0]}##
<tr>
	<th class=colhead>Line</th>
	##TP_LOOP col_idx {[tpGetVar NumCols]}##<th class=colhead nowrap>##TP_FileHeader##</th>##TP_ENDLOOP##
</tr>
##TP_LOOP line_idx {[tpGetVar NumLines]}##
##TP_IF {$FILE([tpGetVar line_idx],OK)}##
<tr>
	<th align=right bgcolor=black><font color=white>##TP_TCL {expr {1+[tpGetVar line_idx]}}##</font></th>
	##TP_LOOP col_idx {[tpGetVar NumCols]}##
	<td nowrap>##TP_FileData##&nbsp;</td>##TP_ENDLOOP##
</tr>
##TP_ELSE##
<tr bgcolor=#993333>
	<th align=right bgcolor=black><font color=white>##TP_TCL {expr {1+[tpGetVar line_idx]}}##</font></th>
	<td colspan=##TP_NumCols## align=left>
	<font color=white>
	##TP_BadData##
	</font>
	</td>
</tr>
##TP_ENDIF##
##TP_ENDLOOP##
##TP_ELSE##
<tr bgcolor=#993333>
	<td align=left nowrap>
	<font color=white>
	##TP_HeaderLine##
	</font>
	</td>
</tr>
<tr bgcolor=#999999>
	<td align=left nowrap>
	<font color=yellow>
	The file header is bad - please check that the
	column names are correct
	</font>
	</td>
</tr>
##TP_ENDIF##
<input type="hidden" name="FileName" value="##TP_FileName##">
<input type="hidden" name="FileType" value="##TP_FileType##">
<input type="hidden" name="FullName" value="##TP_FullName##">
<input type="hidden" name="upload_type" value="##TP_upload_type##">

##TP_IF {[tpGetVar FileOK 0] && [OT_CfgGet FUNC_PER_LINE_TRAN_UPLD 0]}##
<tr>
	<th class="buttons" colspan="##TP_NumColsPlus1##">
		<input type="checkbox" name="per_line_trans" value=1 ##TP_per_line_tran_chkd##>Per-line Transaction
	</th>
</tr>
##TP_ENDIF##
##TP_IF {[OT_CfgGet UPLOAD_DRIPFEED_ENABLED 0]}##
<tr>
	<th class=buttons colspan=##TP_NumColsPlus1##>
		<input type=checkbox name=drip_feed_enabled value=1 checked onClick="this.value=(this.value == 1) ? '' : 1;"/>Pause when replication queue is high (recommended for non-urgent uploads)
	</th>
</tr>
##TP_ENDIF##

##TP_IF {[tpGetVar FileOK 0] && [tpGetVar FileType] == "selections"}##
<tr>
	<th class="buttons" colspan="##TP_NumColsPlus1##">
		<input type="checkbox" name="do_update_seln" value="1">Update Existing Selections
	</th>
</tr>
##TP_ENDIF##

##TP_IF {[tpGetVar FileOK 0] && [tpGetVar FileType] == "markets"}##
<tr>
	<th class="buttons" colspan="##TP_NumColsPlus1##">
		<input type="checkbox" name="do_update_seln" value="1">Update Market Handicap Only
	</th>
</tr>
##TP_ENDIF##

<tr>
	<th class=buttons colspan=##TP_NumColsPlus1##>
	##TP_IF {[tpGetVar FileOK 0]}##
	<input type="submit" class="btn_def" name="SetResult" value="Load File" onClick="return fs(this,'FileLoad')">
	##TP_ENDIF##
	<input type=button class="btn_def" value="Delete File" onClick="return fs(this,'FileDel')">
	<input type=button class="btn_def" value="Back" onClick="return fs(this,'Back')">
	<input type=hidden name=SubmitName value="">
	<input type=hidden name=action value="ADMIN::UPLOAD::DoUploadFile">
	</th>
</tr>
</form>
</table>
</body>
</html>
